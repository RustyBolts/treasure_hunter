System.register("chunks:///_virtual/AbilityTable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AttributeAllocation.ts","./AttributeComponent.ts","./Attribute.ts","./GameManager.ts"],(function(t){var i,e,n,o,a,r,l,c,s,u,h,b,v,f,p;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.createClass},function(t){r=t.cclegacy,l=t._decorator,c=t.Node,s=t.Button,u=t.instantiate,h=t.Component},function(t){b=t.AttributeAllocation},function(t){v=t.AttributeComponent},function(t){f=t.AbilityScoreName},function(t){p=t.GameManager}],execute:function(){var y,d,A,g,C,m,_;r._RF.push({},"7d1f6Z0Nz9Eg4kPEdgh3cx0","AbilityTable",void 0);var S=l.ccclass,w=l.property;t("AbilityTable",(y=S("AbilityTable"),d=w(c),A=w(s),y((m=i((C=function(t){function i(){for(var i,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return i=t.call.apply(t,[this].concat(a))||this,n(i,"attributeContainer",m,o(i)),n(i,"saveButton",_,o(i)),i._hero=void 0,i}e(i,t);var r=i.prototype;return r.allocateNewHeroAbility=function(t,i,e){void 0===e&&(e=0),this._hero=t,this._hero.savingThrowProficiencies=i;var n=this._hero.abilityScore;this.allocateAbilityScore(e,i,n,8,15),this.show()},r.showHeroAbility=function(t){this.allocateHeroAbility(t),this.node.getComponentsInChildren(s).forEach((function(t){return t.node.active=!1})),this.show()},r.allocateHeroAbility=function(t,i){void 0===i&&(i=0),this._hero=t;var e=this._hero,n=e.savingThrowProficiencies,o=e.abilityScore;console.log("abilityScore:",o),this.allocateAbilityScore(i,n,o,0,20)},r.show=function(t){void 0===t&&(t=!0),this.node.active=t,t||(this._hero=null)},r.allocateAbilityScore=function(t,i,e,n,o){var a=this,r=this.attributeContainer.getComponent(b),l=this.attributeContainer.getComponentsInChildren(v);if(r&&l.length>0){this.attributeContainer.active=!0,l.forEach((function(t){t.node.active=!1}));var c=0;Object.keys(e).forEach((function(r,s){var h=e[r],b=l[s];if(!b){var p=u(l[0].node);p.parent=a.attributeContainer,b=p.getComponent(v)}b.node.active=!0,b.Name=r,b.DisplayName=f[r],b.Value=h,c+=h,b.max=o,b.min=n||b.Value,b.Tag=!1,i.forEach((function(t){t===r&&(b.Tag=!0)})),b.activeAllocation(t>0)})),r.pointsUsed=c,r.totalPoints=t+c,r.updatePointsAvailableLabel()}this.saveButton.node.active=t>0},r.getAbilityScoreFromUI=function(){var t=this.attributeContainer.getComponentsInChildren(v),i={};return t.forEach((function(t){var e=t.Name,n=t.Value;i[e]=n})),i},r.onSaveClicked=function(){var t=this.getAbilityScoreFromUI();t&&(this._hero.abilityScore=t,this._hero.saveData()),p.instance.CharacterRaidData.AvaliableAbilityPoints=this.avaliablePoints,p.instance.CharacterRaidData.write()},r.onDelClicked=function(){this._hero.delData()},a(i,[{key:"avaliablePoints",get:function(){var t=this.attributeContainer.getComponent(b);return(null==t?void 0:t.availablePoints)||0}}]),i}(h)).prototype,"attributeContainer",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=i(C.prototype,"saveButton",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=C))||g));r._RF.pop()}}}));

System.register("chunks:///_virtual/AdvenceSkillTable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AttributeAllocation.ts","./Adventure.ts","./SkillComponent.ts"],(function(e){var t,n,i,o,r,a,l,c,u,s,h,v,f,d,p,b,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.createClass,a=e.asyncToGenerator,l=e.regeneratorRuntime},function(e){c=e.cclegacy,u=e._decorator,s=e.Node,h=e.Label,v=e.Button,f=e.instantiate,d=e.Component},function(e){p=e.AttributeAllocation},function(e){b=e.Adventure},function(e){m=e.SkillComponent}],execute:function(){var C,A,g,k,y,S,_,P,w;c._RF.push({},"f8e54QXMmNG+b3nVmXOY5i+","AdvenceSkillTable",void 0);var L=u.ccclass,R=u.property;e("AdvenceSkillTable",(C=L("AdvenceSkillTable"),A=R(s),g=R(h),k=R(v),C((_=t((S=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,i(t,"attributeContainer",_,o(t)),i(t,"modifierPointsLabel",P,o(t)),i(t,"saveButton",w,o(t)),t._hero=null,t}n(t,e);var c=t.prototype;return c.showHeroAdvence=function(e){this.allocateHeroAdvenceModifier(e),this.node.getComponentsInChildren(v).forEach((function(e){return e.node.active=!1})),this.show()},c.allocateHeroAdvenceModifier=function(e,t){void 0===t&&(t=0),this._hero=e,this.allocateAdvenceScore(t,this._hero.adventureScore,0,4)},c.show=function(e){void 0===e&&(e=!0),this.node.active=e,e||(this._hero=null)},c.allocateAdvenceScore=function(e,t,n,i){var o=this,r=this.attributeContainer.getComponent(p),a=this.attributeContainer.getComponentsInChildren(m);if(r&&a.length>0){this.attributeContainer.active=!0,a.forEach((function(e){e.node.active=!1}));var l=[],c=0;Object.keys(t).forEach((function(r,u){if(o.isAdventure(r)){var s=t[r],h=s.Modifier;l.push(h>=0?"+"+h:""+h);var v=a[u];if(!v){var d=f(a[0].node);d.parent=o.attributeContainer,v=d.getComponent(m)}v.node.active=!0,v.Skill=s,c+=s.Rank,v.max=i,v.min=n||s.Rank,v.Tag=s.Rank>0,v.activeAllocation(e>0)}else console.log("不符合",r)})),r.pointsUsed=c,r.totalPoints=e+c,r.updatePointsAvailableLabel(),this.modifierPointsLabel.string=l.join("\n")}this.saveButton.node.active=e>0},c.isAdventure=function(e){return Object.values(b).includes(e)},c.onAllocateClicked=function(){var e=a(l().mark((function e(){var t,n,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return i.scheduleOnce(e,0)}));case 2:t=this._hero.adventureScore,n=[],Object.keys(t).forEach((function(e,i){var o=t[e].Modifier;n.push(o>=0?"+"+o:""+o)})),this.modifierPointsLabel.string=n.join("\n");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.onSaveClicked=function(){var e=this.attributeContainer.getComponentsInChildren(m),t=this._hero.adventureSkillRank;e.forEach((function(e){var n=e.Name;t[n]=e.Value})),this._hero.saveData()},c.onDelClicked=function(){this._hero.delData()},r(t,[{key:"avaliablePoints",get:function(){var e=this.attributeContainer.getComponent(p);return(null==e?void 0:e.availablePoints)||0}}]),t}(d)).prototype,"attributeContainer",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(S.prototype,"modifierPointsLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(S.prototype,"saveButton",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=S))||y));c._RF.pop()}}}));

System.register("chunks:///_virtual/Adventure.ts",["cc","./Attribute.ts","./AdventureSkill.ts"],(function(e){var i,t,n;return{setters:[function(e){i=e.cclegacy},function(e){t=e.Attribute},function(e){n=e.AdventureSkill}],execute:function(){var s,r,o,a,h,u,l,v,d,c,g,p,w,S,m,x,f,A,P,y,R,E,I,N,b,k,D,G,K,O,T,F,W,C,_,M,B,J,U,j;i._RF.push({},"fd27eRGspJIFaBKv6EeUI+a","Adventure",void 0);var q=e("Adventure",function(e){return e.Stunts="stunts",e.Stealth="stealth",e.Dexterity="dexterity",e.Knowledge="knowledge",e.Experience="experience",e.Nature="nature",e.Religion="religion",e.Explore="explore",e.Nursing="nursing",e.Awareness="awareness",e.Taming="taming",e.Survival="survival",e.Observation="observation",e.Performance="performance",e.Persuasion="persuasion",e.Intimidation="intimidation",e.Shove="shove",e.Grapple="grapple",e}({}));s=q.Stunts,r=q.Stealth,o=q.Dexterity,a=q.Knowledge,h=q.Experience,u=q.Nature,l=q.Religion,v=q.Explore,d=q.Nursing,c=q.Awareness,g=q.Taming,p=q.Survival,w=q.Observation,S=q.Performance,m=q.Persuasion,x=q.Intimidation,f=q.Shove,A=q.Grapple;e("AdventureSkillRank",(function(){this[s]=0,this[r]=0,this[o]=0,this[a]=0,this[h]=0,this[u]=0,this[l]=0,this[v]=0,this[d]=0,this[c]=0,this[g]=0,this[p]=0,this[w]=0,this[S]=0,this[m]=0,this[x]=0,this[f]=0,this[A]=0}));P=q.Stunts,y=q.Stealth,R=q.Dexterity,E=q.Knowledge,I=q.Experience,N=q.Nature,b=q.Religion,k=q.Explore,D=q.Nursing,G=q.Awareness,K=q.Taming,O=q.Survival,T=q.Observation,F=q.Performance,W=q.Persuasion,C=q.Intimidation,_=q.Shove,M=q.Grapple;e("AdventureScore",function(){function e(e){this[P]=void 0,this[y]=void 0,this[R]=void 0,this[E]=void 0,this[I]=void 0,this[N]=void 0,this[b]=void 0,this[k]=void 0,this[D]=void 0,this[G]=void 0,this[K]=void 0,this[O]=void 0,this[T]=void 0,this[F]=void 0,this[W]=void 0,this[C]=void 0,this[_]=void 0,this[M]=void 0,this[q.Stunts]=new n(q.Stunts,t.Dexterity,"特技","肢體動作能演繹出超乎常人的巧妙",e[q.Stunts]),this[q.Stealth]=new n(q.Stealth,t.Dexterity,"隱匿","身形藏於目標的眼光之外而被忽視",e[q.Stealth]),this[q.Dexterity]=new n(q.Dexterity,t.Dexterity,"巧手","細微且冷靜地靈活運用手腕乃至手指",e[q.Dexterity]),this[q.Knowledge]=new n(q.Knowledge,t.Intelligence,"知識","常鑽研書中的事物而獲得深厚的學問",e[q.Knowledge]),this[q.Experience]=new n(q.Experience,t.Intelligence,"閱歷","長期冒險時得到的經驗與觀察力",e[q.Experience]),this[q.Nature]=new n(q.Nature,t.Intelligence,"自然","遵循萬物平衡真理而存留下的軌跡",e[q.Nature]),this[q.Religion]=new n(q.Religion,t.Intelligence,"宗教","從信仰的神明到儀式的文化有所認識",e[q.Religion]),this[q.Explore]=new n(q.Explore,t.Intelligence,"探索","從調查細節乃搜索區域而得到訊息",e[q.Explore]),this[q.Nursing]=new n(q.Nursing,t.Wisdom,"護理","發現生理結構的徴結而掌握的救護",e[q.Nursing]),this[q.Awareness]=new n(q.Awareness,t.Wisdom,"覺察","藉由察顏觀色而獲得行動先機",e[q.Awareness]),this[q.Taming]=new n(q.Taming,t.Wisdom,"馴服","理解並能受到動物的認同而接受指令",e[q.Taming]),this[q.Survival]=new n(q.Survival,t.Wisdom,"生存","在野外生存或遭受意外的判斷與技巧",e[q.Survival]),this[q.Observation]=new n(q.Observation,t.Wisdom,"觀察","敏銳抓出細節差異或感受違和的發展",e[q.Observation]),this[q.Performance]=new n(q.Performance,t.Charisma,"表演","將肢體化為語言來傳達的藝術表現",e[q.Performance]),this[q.Persuasion]=new n(q.Persuasion,t.Charisma,"說服","藉由靈活的口才令聞者動搖心智",e[q.Persuasion]),this[q.Intimidation]=new n(q.Intimidation,t.Charisma,"威嚇","以言語或動作表情傳達出脅迫之意",e[q.Intimidation]),this[q.Shove]=new n(q.Shove,t.Strength,"推撞","以自身的力量推撞對手而使其退開",e[q.Shove]),this[q.Grapple]=new n(q.Grapple,t.Strength,"擒拿","以自身的力量束縛對手而使其難以動彈",e[q.Grapple])}var i=e.prototype;return i.upgradeSkill=function(e){var i=this[e];null==i||i.upgrade()},i.getModilier=function(e){return this[e].Modifier},i.getRank=function(e){return this[e].Rank},e}());B=t.Athletics,J=t.Perception,U=t.Response,j=t.Figurative;e("PassiveAttribute",function(){function e(){this[B]=void 0,this[J]=void 0,this[U]=void 0,this[j]=void 0}return e.prototype.calculate=function(e,i,n,s,r){this[t.Athletics]=10+e+i,this[t.Perception]=10+n,this[t.Response]=10+s,this[t.Figurative]=10+r},e}());i._RF.pop()}}}));

System.register("chunks:///_virtual/AdventureSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Skill.ts"],(function(i){var t,e,r,n,s;return{setters:[function(i){t=i.inheritsLoose,e=i.createClass},function(i){r=i.cclegacy},function(i){n=i.SkillRank,s=i.Skill}],execute:function(){r._RF.push({},"320ab3l3sdAUpsDjIfSbtJg","AdventureSkill",void 0);i("AdventureSkill",function(i){function r(t,e,r,s,a){var o;return void 0===s&&(s=""),void 0===a&&(a=n.Novice),(o=i.call(this,t,r,a)||this).ability=void 0,o._description=void 0,o.ability=e,o._description=s,o}t(r,i);var s=r.prototype;return s.upgrade=function(){return this.rank!==n.Master&&(this.rank++,!0)},s.tooltip=function(){return this.displayName+" ("+this.Modifier+")\n"+this._description},e(r,[{key:"Modifier",get:function(){var i=0;switch(this.rank){case n.Novice:i=2;break;case n.Adept:i=4;break;case n.Expert:i=6;break;case n.Master:i=10}return i}},{key:"DisplayName",get:function(){return this.displayName}}]),r}(s));r._RF.pop()}}}));

System.register("chunks:///_virtual/AiIntentData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,i;return{setters:[function(t){n=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"44b8cpbU6hA/53MuLEUTRN4","AiIntentData",void 0);t("AiIntentData",function(){function t(t,n){this._id=void 0,this._intents=void 0,this._id=t,this._intents=n}return t.fromCSV=function(n){var i=n.intents.map((function(t){return t.split(" ")}));return new t(n.id,i)},n(t,[{key:"id",get:function(){return this._id}},{key:"intents",get:function(){return this._intents}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/Armor.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Item.ts"],(function(e){var t,r,a,i;return{setters:[function(e){t=e.inheritsLoose,r=e.createClass},function(e){a=e.cclegacy},function(e){i=e.Item}],execute:function(){a._RF.push({},"e9232ucOdFK3q1sHt4TR+KC","Armor",void 0);e("ArmorStyle",function(e){return e.AllLightArmors="AllLightArmors",e.Padded="Padded",e.Leather="Leather",e.StuddedLeather="StuddedLeather",e.AllMediumArmors="AllMediumArmors",e.Hide="Hide",e.ChainShirt="ChainShirt",e.ScaleMail="ScaleMail",e.Breastplate="Breastplate",e.HalfPlate="HalfPlate",e.AllHeavyArmors="AllHeavyArmors",e.RingMail="RingMail",e.ChainMail="ChainMail",e.Splint="Splint",e.Plate="Plate",e}({})),e("Armor",function(e){function a(t,r,a,i,s,n,l,o,u,c,h){var d;return(d=e.call(this,t,r,a,s,n)||this).armorClassBase=void 0,d.strengthRequirement=void 0,d.stealthDisadvantage=void 0,d.armorType=void 0,d.icon=void 0,d.icon=i,d.armorClassBase=l,d.strengthRequirement=o,d.stealthDisadvantage=u,d.armorType=c,d.description=h,d}t(a,e);var i=a.prototype;return i.calculateArmorClass=function(e){var t=this.getDexterityBonus(e),r=null!==t?Math.min(e,t):e;return this.armorClassBase+r},i.getDexterityBonus=function(e){switch(this.armorType){case"Light":return e;case"Medium":return 2;case"Heavy":default:return 0}},r(a,[{key:"tooltip",get:function(){var t=e.prototype.tooltip;return t+="<br/>護甲類型: "+this.armorType,t+="<br/>基礎護甲等級: "+this.armorClassBase,t+="<br/>最低需求力量: "+this.strengthRequirement}}]),a}(i));a._RF.pop()}}}));

System.register("chunks:///_virtual/ArmorDraggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EquipmentDropZone.ts","./Draggable.ts","./PixelImage.ts","./DraggableDetail.ts"],(function(e){var t,n,r,o,i,a,l,s,u;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){r=e.cclegacy,o=e._decorator},function(e){i=e.EquipmentDropZone,a=e.EquipmentDropZoneType},function(e){l=e.Draggable},function(e){s=e.PixelImage},function(e){u=e.DraggableDetail}],execute:function(){var c;r._RF.push({},"47b056lZsJImI5+vts2KNpl","ArmorDraggable",void 0);var p=o.ccclass;o.property,e("ArmorDraggable",p("ArmorDraggable")(c=function(e){function r(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this).equipmentType=a.None,t._item=null,t}return t(r,e),r.prototype.setParent=function(t){return!(t instanceof i&&t.equipmentType!==this.equipmentType)&&(e.prototype.setParent.call(this,t),!0)},n(r,[{key:"Item",get:function(){return this._item},set:function(e){var t,n;console.log("Armor = ",e),this._item=e,null==(t=this.node.getComponent(u))||t.setDetail(e.name,this._item.amount),null==(n=this.node.getComponent(s))||n.setSpriteFrame(e.icon)}}]),r}(l))||c);r._RF.pop()}}}));

System.register("chunks:///_virtual/Attribute.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e;return{setters:[function(i){t=i.createForOfIteratorHelperLoose},function(i){e=i.cclegacy}],execute:function(){var n,o,r,s,h,l,c,a,u,d,v,g,p,f,m,y,S,x,C,R,W;e._RF.push({},"71c49yIqflE+YTMpxLgRoi0","Attribute",void 0);var I=i("Attribute",function(i){return i.Strength="strength",i.Dexterity="dexterity",i.Intelligence="intelligence",i.Wisdom="wisdom",i.Charisma="charisma",i.Resilience="resilience",i.Constitution="constitution",i.Spirit="spirit",i.Willpower="willpower",i.Athletics="athletics",i.Perception="perception",i.Response="response",i.Figurative="figurative",i}({}));n=I.Strength,o=I.Dexterity,r=I.Intelligence,s=I.Wisdom,h=I.Charisma,l=I.Resilience;i("AbilityScore",(function(){this[n]=void 0,this[o]=void 0,this[r]=void 0,this[s]=void 0,this[h]=void 0,this[l]=void 0})),i("AbilityScoreName",function(i){return i.strength="力量",i.dexterity="敏捷",i.intelligence="智力",i.wisdom="睿知",i.charisma="魅力",i.resilience="韌性",i}({}));c=I.Strength,a=I.Dexterity,u=I.Intelligence,d=I.Wisdom,v=I.Charisma,g=I.Resilience;i("AbilityScoreModifier",function(){function i(){this[c]=void 0,this[a]=void 0,this[u]=void 0,this[d]=void 0,this[v]=void 0,this[g]=void 0}return i.prototype.calculate=function(i){var t=function(t){return Math.floor(i[t]/2)-5};this[I.Strength]=t(I.Strength),this[I.Dexterity]=t(I.Dexterity),this[I.Intelligence]=t(I.Intelligence),this[I.Wisdom]=t(I.Wisdom),this[I.Charisma]=t(I.Charisma),this[I.Resilience]=t(I.Resilience)},i}());p=I.Constitution,f=I.Spirit,m=I.Willpower;i("CompositeAttribute",function(){function i(){this[p]=void 0,this[f]=void 0,this[m]=void 0}return i.prototype.calculate=function(i){var t=i.strength,e=i.dexterity,n=i.intelligence,o=i.wisdom,r=i.charisma,s=i.resilience,h=2*t+e+s,l=2*n+o,c=2*s+r;this[I.Constitution]=Math.floor(h/2)+10,this[I.Spirit]=Math.floor(l/2)+10,this[I.Willpower]=Math.floor(c/2)+10},i}());y=I.Strength,S=I.Dexterity,x=I.Intelligence,C=I.Wisdom,R=I.Charisma,W=I.Resilience;i("SavingThrowAttribute",function(){function i(){this[y]=void 0,this[S]=void 0,this[x]=void 0,this[C]=void 0,this[R]=void 0,this[W]=void 0}return i.prototype.calculate=function(i,e,n){this[I.Strength]=i[I.Strength],this[I.Dexterity]=i[I.Dexterity],this[I.Intelligence]=i[I.Intelligence],this[I.Wisdom]=i[I.Wisdom],this[I.Charisma]=i[I.Charisma],this[I.Resilience]=i[I.Resilience];for(var o,r=t(e);!(o=r()).done;){this[o.value]+=n}},i}());e._RF.pop()}}}));

System.register("chunks:///_virtual/AttributeAllocation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,a,l,o,r,s,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized,l=t.createClass},function(t){o=t.cclegacy,r=t._decorator,s=t.Label,c=t.Component}],execute:function(){var u,b,p,h,v,A;o._RF.push({},"a6892FtqTNF+KzvQU2/Wz9A","AttributeAllocation",void 0);var f=r.ccclass,P=r.property;t("AttributeAllocation",(u=f("AttributeAllocation"),b=P(s),u((v=e((h=function(t){function e(){for(var e,i=arguments.length,l=new Array(i),o=0;o<i;o++)l[o]=arguments[o];return e=t.call.apply(t,[this].concat(l))||this,n(e,"pointsAvailableLabel",v,a(e)),n(e,"tableText",A,a(e)),e.totalPoints=0,e.pointsUsed=0,e}i(e,t);var o=e.prototype;return o.checkAvailablePoints=function(t){return this.pointsUsed+t<=this.totalPoints},o.allocatePoints=function(t){return!!this.checkAvailablePoints(t)&&(this.pointsUsed+=t,this.updatePointsAvailableLabel(),!0)},o.freePoints=function(t){this.pointsUsed-=t,this.updatePointsAvailableLabel()},o.updatePointsAvailableLabel=function(){this.pointsAvailableLabel.string=this.tableText+" "+this.availablePoints},l(e,[{key:"availablePoints",get:function(){return this.totalPoints-this.pointsUsed}}]),e}(c)).prototype,"pointsAvailableLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(h.prototype,"tableText",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Available Points:"}}),p=h))||p));o._RF.pop()}}}));

System.register("chunks:///_virtual/AttributeComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AttributeAllocation.ts"],(function(t){var e,i,n,a,l,o,r,u,s,c,h,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized,l=t.createClass},function(t){o=t.cclegacy,r=t._decorator,u=t.Label,s=t.Button,c=t.Node,h=t.Component},function(t){b=t.AttributeAllocation}],execute:function(){var f,p,m,y,d,g,A,V,v,B,L,C,_,D,I;o._RF.push({},"74c4bjC7XBJ9ahF/aQsrG5o","AttributeComponent",void 0);var z=r.ccclass,w=r.property;t("AttributeComponent",(f=z("AttributeComponent"),p=w(u),m=w(u),y=w(s),d=w(s),g=w(b),A=w(c),f((B=e((v=function(t){function e(){for(var e,i=arguments.length,l=new Array(i),o=0;o<i;o++)l[o]=arguments[o];return e=t.call.apply(t,[this].concat(l))||this,n(e,"nameLabel",B,a(e)),n(e,"valueLabel",L,a(e)),n(e,"increaseButton",C,a(e)),n(e,"decreaseButton",_,a(e)),n(e,"attributeAllocation",D,a(e)),n(e,"highlight",I,a(e)),e.max=100,e.min=0,e._attributeName="",e._attributeDisplay="",e._attributeValue=0,e}i(e,t);var o=e.prototype;return o.onLoad=function(){this.Tag=!1},o.activeAllocation=function(t){this.increaseButton.node.active=t,this.enableIncreaseAllocation(this.Value<this.max),this.decreaseButton&&(this.decreaseButton.node.active=t,this.enableDecreaseAllocation(this.Value>this.min))},o.enableIncreaseAllocation=function(t){this.increaseButton.interactable=t},o.enableDecreaseAllocation=function(t){this.decreaseButton&&(this.decreaseButton.interactable=t)},o.onEnable=function(){var t;this.increaseButton.node.on(s.EventType.CLICK,this.increaseValue,this),null==(t=this.decreaseButton)||t.node.on(s.EventType.CLICK,this.decreaseValue,this)},o.onDisable=function(){var t;this.increaseButton.node.off(s.EventType.CLICK,this.increaseValue,this),null==(t=this.decreaseButton)||t.node.off(s.EventType.CLICK,this.decreaseValue,this)},o.increaseValue=function(){this.Value<this.max&&this.attributeAllocation.allocatePoints(1)&&(this.Value++,this.enableIncreaseAllocation(this.Value<this.max),this.enableDecreaseAllocation(this.Value>this.min))},o.decreaseValue=function(){this.Value>this.min&&this._attributeValue>0&&(this.attributeAllocation.freePoints(1),this.Value--,this.enableIncreaseAllocation(this.Value<this.max),this.enableDecreaseAllocation(this.Value>this.min))},l(e,[{key:"Value",get:function(){return this._attributeValue},set:function(t){this._attributeValue=t,this.valueLabel&&(this.valueLabel.string=this._attributeValue.toString())}},{key:"Name",get:function(){return this._attributeName},set:function(t){this._attributeName=t}},{key:"DisplayName",set:function(t){this._attributeDisplay=t,this.nameLabel&&(this.nameLabel.string=t)}},{key:"Tag",set:function(t){this.highlight.active=t}}]),e}(h)).prototype,"nameLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(v.prototype,"valueLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(v.prototype,"increaseButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(v.prototype,"decreaseButton",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(v.prototype,"attributeAllocation",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(v.prototype,"highlight",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=v))||V));o._RF.pop()}}}));

System.register("chunks:///_virtual/AudioHelper.ts",["cc","./AudioManager.ts"],(function(n){var u,i,o;return{setters:[function(n){u=n.cclegacy,i=n._decorator},function(n){o=n.AudioManager}],execute:function(){var a,c;u._RF.push({},"b4896iudoVCNYcBglAhYLkq","AudioHelper",void 0);var t=i.ccclass;n("AudioHelper",t("AudioHelper")(((c=function(){function n(){}return n.playMusic=function(n){var u=this.getPath(n);o.instance.playBackgroundMusic(u)},n.playSound=function(n){var u=this.getPath(n);o.instance.playSoundEffect(u)},n.getPath=function(n){return this.audioMap[n]||""},n}()).audioMap={backgroundMusic:"audio/dancing_on_table",clickSound:"audio/click",winSound:"audio/win",loseSound:"audio/lose"},a=c))||a);u._RF.pop()}}}));

System.register("chunks:///_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,i,o,u,a,s,c,r,l,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,u=e.createClass},function(e){a=e.cclegacy,s=e._decorator,c=e.AudioSource,r=e.resources,l=e.AudioClip,d=e.Component}],execute:function(){var f,p,h,b,S,y,g,m;a._RF.push({},"c714bqcI0FN4Y+9uQVoTRJe","AudioManager",void 0);var M=s.ccclass,E=s.property;e("AudioManager",(f=M("AudioManager"),p=E(c),h=E(c),f(((m=function(e){function t(){for(var t,n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return t=e.call.apply(e,[this].concat(u))||this,i(t,"bgmSource",y,o(t)),i(t,"sfxSource",g,o(t)),t.isMusicEnabled=!0,t.isSoundEffectsEnabled=!0,t}n(t,e);var a=t.prototype;return a.onLoad=function(){t._instance?this.destroy():t._instance=this},a.playBackgroundMusic=function(e){this.isMusicEnabled&&this.loadAndPlay(this.bgmSource,e,!0)},a.playSoundEffect=function(e){this.isSoundEffectsEnabled&&this.loadAndPlay(this.sfxSource,e,!1)},a.loadAndPlay=function(e,t,n){r.load(t,l,(function(t,i){t?console.error("Failed to load audio: "+t):(e.clip=i,e.loop=n,e.play())}))},a.setMusicEnabled=function(e){this.isMusicEnabled=e,this.updateAudioState(this.bgmSource,e)},a.setSoundEffectsEnabled=function(e){this.isSoundEffectsEnabled=e,this.updateAudioState(this.sfxSource,e)},a.updateAudioState=function(e,t){t?e.playing||e.play():e.stop()},a.setMusicVolume=function(e){this.bgmSource.volume=Math.max(0,Math.min(1,e))},a.setSoundEffectVolume=function(e){this.sfxSource.volume=Math.max(0,Math.min(1,e))},u(t,null,[{key:"instance",get:function(){return this._instance}}]),t}(d))._instance=null,y=t((S=m).prototype,"bgmSource",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=t(S.prototype,"sfxSource",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=S))||b));a._RF.pop()}}}));

System.register("chunks:///_virtual/BackpackDropZone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DropZone.ts","./Draggable.ts","./Inventory.ts"],(function(t){var e,n,o,i,r,a,c,p,s,m,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.createClass},function(t){a=t.cclegacy,c=t._decorator,p=t.EventHandler},function(t){s=t.DropZone},function(t){m=t.Draggable},function(t){u=t.InventoryEvent}],execute:function(){var l,f,I,h,d,g,k;a._RF.push({},"ceac8xS9KtMIqrb8OIJjoz0","BackpackDropZone",void 0);var v=c.ccclass,D=c.property;t("BackpackDropZone",(l=v("BackpackDropZone"),f=D(p),I=D(p),l((g=e((d=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,o(e,"backpackDropIn",g,i(e)),o(e,"backpackDropOut",k,i(e)),e._itemTipCard=void 0,e}n(e,t);var a=e.prototype;return a.init=function(){var t=this.item;this.ItemTipCard={string:t.name,coping:t.id,type:t.type,value:this.item.amount.toString()}},a.onDrop=function(t){var n=this,o=t.draggableItem,i=t.dropZone,r=0,a=!1,c=this.slot.getComponentInChildren(m);if(c){var p=o.Amount+c.Amount;if(o.isSameItem(c.Item)&&p<=o.Item.stackLimit)o.mergeItems(c.node),o.zone instanceof e&&this.node.dispatchEvent(new u("removeItem",!0,{item:this.item,amount:0})),r=c.Amount,a=!0,console.log("合併道具數量:",o.Amount,"+",r,"=",o.Amount+r);else{if(!c.setParent(i))return o.resetPosition();console.log("道具已存在，交换位置",o.Item.name,"取代",c.Item.name)}}var s=o.Item;s.amount+=r,o.zone instanceof e||(console.log("外部道具移入背包"),this.node.dispatchEvent(new u("moveItem",!0,{item:s,amount:s.amount,isMerge:a}))),o.setParent(this),console.log(o.Item.name,"道具已放置"),i.dropOut(o),this.backpackDropIn.forEach((function(t){return t.emit([n.item,n.item.amount])}))},a.onBackbackDropIn=function(t,e){this.ItemTipCard={string:t.name,coping:t.id,type:t.type,value:e.toString()}},a.onBackbackDropOut=function(t,e){this.ItemTipCard=null},a.dropOut=function(t){this.backpackDropOut.forEach((function(e){return e.emit([t.Item,t.Item.amount])})),t.zone instanceof e||(this.node.dispatchEvent(new u("removeItem",!0,{item:t.Item,amount:t.Item.amount})),console.log("道具已移出背包"))},r(e,[{key:"ItemTipCard",get:function(){return this._itemTipCard},set:function(t){this._itemTipCard=t}}]),e}(s)).prototype,"backpackDropIn",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),k=e(d.prototype,"backpackDropOut",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h=d))||h));a._RF.pop()}}}));

System.register("chunks:///_virtual/BattleManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HandCards.ts","./CombatCardComponent.ts","./CombatCardManager.ts","./GameManager.ts","./CombatEffectManager.ts","./CombatEffectComponent.ts","./CombatCard.ts","./PopupWindowComponent.ts","./HitTag.ts","./CardMover.ts","./CameraCenterMover.ts","./CardPreview.ts","./CardComponent.ts","./CharacterInfo.ts","./EmpowerCombatCardList.ts","./CombatTeachTool.ts","./BeltDropZone.ts","./InventoryCollection.ts","./ToolTipManager.ts","./TooltipComponent.ts","./Debug.ts"],(function(t){var e,n,a,r,i,o,s,c,u,d,l,f,h,m,p,C,b,g,y,v,_,E,I,w,T,B,x,D,k,P,L,O,U,M,R,z,A,N,S,H,j;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,a=t.initializerDefineProperty,r=t.assertThisInitialized,i=t.asyncToGenerator,o=t.regeneratorRuntime,s=t.createClass},function(t){c=t.cclegacy,u=t._decorator,d=t.Node,l=t.Layout,f=t.Label,h=t.ProgressBar,m=t.EventHandler,p=t.UITransform,C=t.randomRangeInt,b=t.instantiate,g=t.Component,y=t.v3},function(t){v=t.HandCards},function(t){_=t.CombatCardComponent},function(t){E=t.CombatCardManager},function(t){I=t.GameManager},function(t){w=t.CombatEffectManager},function(t){T=t.CombatEffectComponent},function(t){B=t.CombatCard},function(t){x=t.PopupWindowComponent},function(t){D=t.HitTag},function(t){k=t.CardMover},function(t){P=t.CameraCenterMover},function(t){L=t.CardPreview},function(t){O=t.CardComponent},function(t){U=t.CharacterInfo},function(t){M=t.EmpowerCombatCardList},function(t){R=t.CombatTeachTool},function(t){z=t.BeltDropZone},function(t){A=t.InventoryCollection},function(t){N=t.ToolTipManager},function(t){S=t.ToolTipStyle,H=t.ToolTipSize},function(t){j=t.Debug}],execute:function(){var F,V,q,W,G,Z,J,K,Q,X,Y,$,tt,et,nt,at,rt,it,ot,st,ct,ut,dt,lt,ft,ht,mt,pt,Ct,bt,gt,yt,vt,_t,Et,It,wt,Tt,Bt,xt,Dt,kt,Pt,Lt,Ot,Ut;c._RF.push({},"75f1fvy7CZE6IJPWLrjCF5k","BattleManager",void 0);var Mt=u.ccclass,Rt=u.property;t("BattleManager",(F=Mt("BattleManager"),V=Rt(d),q=Rt(d),W=Rt(v),G=Rt(T),Z=Rt(T),J=Rt(l),K=Rt(d),Q=Rt(x),X=Rt(P),Y=Rt(f),$=Rt(f),tt=Rt(d),et=Rt(L),nt=Rt(O),at=Rt(h),rt=Rt(U),it=Rt(A),ot=Rt(d),st=Rt(m),ct=Rt(m),ut=Rt(d),F(((Ut=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,a(e,"combatNode",ft,r(e)),a(e,"cardPrefab",ht,r(e)),a(e,"handCards",mt,r(e)),a(e,"myCombatEffectStatus",pt,r(e)),a(e,"enemyCombatEffectStatus",Ct,r(e)),a(e,"enemyFrontLayout",bt,r(e)),a(e,"endTurnButton",gt,r(e)),a(e,"popupWindow",yt,r(e)),a(e,"cameraCenterMover",vt,r(e)),a(e,"energyLabel",_t,r(e)),a(e,"countdownLabel",Et,r(e)),a(e,"useItemBoard",It,r(e)),a(e,"cardPreview",wt,r(e)),a(e,"rewardIcon",Tt,r(e)),a(e,"expProgressBar",Bt,r(e)),a(e,"characterInfo",xt,r(e)),a(e,"beltInventoryCollection",Dt,r(e)),a(e,"combatTeach",kt,r(e)),a(e,"battleVictoryEvent",Pt,r(e)),a(e,"battleDefeatEvent",Lt,r(e)),a(e,"inventoryOptions",Ot,r(e)),e.onBattleVictoryEvent=null,e.onBattleDefeatEvent=null,e._currentTurnIndex=0,e._playerUnitId="",e._enemyUnitIds=[],e._unitEnemyIds=[],e._combatCardDataList=void 0,e._recordEffects=[],e._turnOrder=[],e._hittingEnemyId="",e._roundCount=0,e._isBattleEnd=!0,e._itemCard=null,e._curEnemyTeamData=null,e._enemyId="",e._isEscape=!1,e._itemCombatCard=null,e._usingItem="",e}n(e,t);var c=e.prototype;return c.onLoad=function(){e._instance?this.destroy():e._instance=this,this.combatNode.active=!1,this.showEndTurnButton(!1)},c.start=function(){this.expProgressBar.totalLength=this.expProgressBar.getComponent(p).width,this.expProgressBar.progress=I.instance.CharacterRaidData.CombatParam.curExp/I.instance.CharacterRaidData.CombatParam.maxExp},c.getRandomInitiative=function(){return Math.floor(100*Math.random())},c.startBattle=function(){var t=this;this.inventoryOptions.active=!1,this._roundCount=0,this._isBattleEnd&&(this._isBattleEnd=!1,this._isEscape=!1,this.cameraCenterMover.moveToBorder(-700),this.combatNode.active=!0,this.beltInventoryCollection.inventory.clear(),this.beltInventoryCollection.getComponentsInChildren(z).forEach((function(t){t.clear()})),this.scheduleOnce(i(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I.instance.CharacterRaidData.getBelt().forEach((function(e){j.Log("腰帶道具:",e.string),t.beltInventoryCollection.collect(e)})),t.beltInventoryCollection.getComponentsInChildren(z).forEach((function(t){t.lockDraggable()})),j.Log("鎖住腰帶拖拽"),j.Log("設定戰鬥牌組"),t.setCombatCards(),j.Log("設定戰鬥的互動介面"),t.setCombatEffectStatus(),"newbie_killer"===t._enemyId?w.instance.onBeginBattle(1,4):w.instance.onBeginBattle(),e.next=11,new Promise((function(e){return t.scheduleOnce(e,2)}));case 11:t._currentTurnIndex=0,t.startNextUnitTurn();case 13:case"end":return e.stop()}}),e)})))))},c.startNextUnitTurn=function(){var t=i(o().mark((function t(){var e,n,a,r=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this._turnOrder[this._currentTurnIndex],!w.instance.isStun(e)){t.next=5;break}return console.log("狀態影響，回合提前結束"),this.processEndTurn(),t.abrupt("return");case 5:if(e!==this._playerUnitId){t.next=11;break}w.instance.onTurnBegin(this._playerUnitId,this._enemyUnitIds),this.cameraCenterMover.moveToCenter(this.enemyFrontLayout.node),this.startPlayerTurn(),t.next=24;break;case 11:if(!((null==(n=this.combatTeach.getComponent(R))?void 0:n.BattleRoundMax)<=this._roundCount)){t.next=16;break}return this._isBattleEnd=!0,this._isEscape=!0,this.endBattle(),t.abrupt("return");case 16:return(a=w.instance.units[e]).isHurt?this.combatTeach.emit("enemyAttacked",{detail:{injured:!0}}):a.isUnscathed&&this.combatTeach.emit("enemyAttacked",{detail:{injured:!1}}),w.instance.onTurnBegin(e,[this._playerUnitId]),console.log("開始AI行動，等骰命中後護甲動畫跑完"),this.cameraCenterMover.moveToCenter(a.status.node),t.next=23,new Promise((function(t){return r.scheduleOnce(t,1)}));case 23:this.startAiTurn(e);case 24:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.startPlayerTurn=function(){var t=i(o().mark((function t(){var e,n,a,r=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.showEndTurnButton(),!(this._roundCount>0)||"original_survivor"!==this._enemyId&&"older_stalker"!==this._enemyId){t.next=3;break}return t.abrupt("return");case 3:if(this._recordEffects.length=0,this.onPlayerTurn(),e=w.instance.takeDiscardCount(this._playerUnitId),j.Log("開始玩家行動，手牌數量:",this.handCards.cards.length,"要丟棄:",e),!(e>0)){t.next=12;break}return n=this.handCards.cards.slice(0,e),E.instance.discardCards(n),t.next=12,new Promise((function(t){return r.scheduleOnce(t,2)}));case 12:(a=w.instance.getCountdown(this._playerUnitId))>0?this.startTurnTimer(a):this.countdownLabel.string="";case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.startTurnTimer=function(t){var e=this,n=t;this.schedule((function t(){n--,e.updateTurnTimerUI(n),n<=0&&(e.unschedule(t),e.endPlayerTurn())}),1,t)},c.endPlayerTurn=function(){this.handCards.disableCards(),this.showEndTurnButton(!1),this.processEndTurn()},c.showEndTurnButton=function(t){void 0===t&&(t=!0),this.endTurnButton.active=t},c.updateTurnTimerUI=function(t){this.countdownLabel.string=t.toString()},c.processEndTurn=function(){var t=i(o().mark((function t(){var e,n=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isBattleOver()){t.next=3;break}return this.endBattle(),t.abrupt("return");case 3:if(e=this._turnOrder[this._currentTurnIndex],w.instance.onTurnEnd(e),this._currentTurnIndex++,!(this._currentTurnIndex>=this._turnOrder.length)){t.next=19;break}if(this._currentTurnIndex=0,w.instance.onRoundEnd(),this._roundCount++,this.handCards.cards.forEach((function(t){var e=t.getComponent(_);e.CombatCard.reset(),e.nameLabel.string=e.CombatCard.Name,e.updateEffects()})),console.log("回合結束後處理debuff，檢查死亡"),!this.isBattleOver()){t.next=15;break}return this.endBattle(),t.abrupt("return");case 15:return this.combatTeach.emit("roundBegin"),"newbie_killer"===this._enemyId?w.instance.onRoundBegin(1,4):w.instance.onRoundBegin(),t.next=19,new Promise((function(t){return n.scheduleOnce(t,2)}));case 19:this.startNextUnitTurn();case 20:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.startAiTurn=function(){var t=i(o().mark((function t(e){var n,a=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getAiIntention(e),t.next=3,this.executeAiIntention(e,n);case 3:if(console.log("AI行動結束",n),!this.isBattleOver()){t.next=7;break}return this.endBattle(),t.abrupt("return");case 7:return t.next=9,new Promise((function(t){return a.scheduleOnce(t,1)}));case 9:this.handCards.enableCards(),this.processEndTurn();case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),c.getAiIntention=function(t){var e=this._unitEnemyIds[t],n=I.instance.database.aiIntentDatabase.find((function(t){return t.id===e}));return n?n.intents:(console.error("找不到AI的意圖資料",e),[["defense_1","defense_1","attack_1"],["attack_1","attack_1"],["hit_1","hit_1","puncture_1"]])},c.executeAiIntention=function(){var t=i(o().mark((function t(e,n){var a,r,i,s,c,u,d,l,f,h,m,p,C,g,v,T=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=I.instance.database.combatCardDatabase,r=this._roundCount%n.length,i=[],s=[],n[r].forEach((function(t){console.log(T._unitEnemyIds[e],"敵人施放:",t);var n=!1;t.indexOf("send")>-1&&(n=!0,t=t.replace("send_",""),console.log("送出卡牌 cardId:",t));var r=a.find((function(e){return e.cardId===t}));r&&(n?s.push(r):i.push(r))})),c=2.5,u=this.parseCombatCards(s,!0);case 7:if(!(u.length>0)){t.next=18;break}return d=u.shift(),E.instance.previewCard(d,1.5,0,c),t.next=12,new Promise((function(t){return T.scheduleOnce(t,c)}));case 12:E.instance.unshiftCardsToDraw([d]),E.instance.drawCards(1),w.instance.intentionHandsTip(e,u.length+i.length),this.handCards.disableCards(),t.next=7;break;case 18:return w.instance.intentionHandsTip(e,i.length),t.next=21,new Promise((function(t){return T.scheduleOnce(t,1)}));case 21:for(l=w.instance.takeDiscardCount(e),f=0;f<l;f++)i.shift();w.instance.intentionHandsTip(e,i.length),console.log("提示敵人棄牌"),i.forEach((function(t,e){t||(console.error("combatCardDataList 中有undefined:",i),i.splice(e,1))})),h=!1,m=1.5;case 28:if(!(i.length>0)){t.next=53;break}if(p=i.shift()){t.next=34;break}return console.error("combatCardData 沒有資料:",p),i.length=0,t.abrupt("break",53);case 34:return console.log("AI行動:",null==p?void 0:p.cardName),C=this.parseCombatCard(p),g=new B(p,C,h),t.next=39,w.instance.intentionHandsTip(e,i.length);case 39:return(v=b(this.cardPrefab)).parent=this.node,v.active=!0,v.getComponent(_).setup(g),t.next=45,k.moveCard(v,this.node,y(-150,150,0),m,1);case 45:return w.instance.onCardPlayed(g.Effects,e,[this._playerUnitId]),w.instance.onAttackAnimation(g.Id,e),t.next=49,new Promise((function(t){return T.scheduleOnce(t,1)}));case 49:v.destroy(),w.instance.isAlive(e)||(i.length=0),t.next=28;break;case 53:return t.next=56,new Promise((function(t){return T.scheduleOnce(t,.1)}));case 56:return t.abrupt("return",t.sent);case 57:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),c.checkForDeaths=function(){this._turnOrder=this._turnOrder.filter((function(t){return w.instance.isAlive(t)}))},c.isBattleOver=function(){var t=this;this.checkForDeaths();var e=w.instance.isAlive(this._playerUnitId),n=!1;return[].concat(this._enemyUnitIds).forEach((function(e){w.instance.isAlive(e)?n=!0:(console.log("敵人死亡",t._unitEnemyIds[e]),t.handCards.removeTag(e),t._enemyUnitIds.splice(t._enemyUnitIds.indexOf(e),1),delete t._unitEnemyIds[e],w.instance.quit(e))})),this._isBattleEnd=!e||!n,this._isBattleEnd},c.escapeBattle=function(){},c.endBattle=function(){var t=i(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.inventoryOptions.active=!0,this.handCards.clear(),this.showEndTurnButton(!1),null!=(e=this.combatTeach.getComponent(R))&&e.conversationId?this._isEscape?this.combatTeach.emit("battleEscape",{detail:{callback:this.finishBattle.bind(this)}}):this.combatTeach.emit("battleEnd",{detail:{callback:this.finishBattle.bind(this)}}):this.finishBattle();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.finishBattle=function(){var t=i(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.enemyFrontLayout.node.removeAllChildren(),this._enemyUnitIds.length=0,this._hittingEnemyId="",w.instance.isAlive(this._playerUnitId)?(this.showVictoryMessage(),this.playVictoryAnimation(),I.instance.CharacterRaidData.CombatParam.curHP=w.instance.units[this._playerUnitId].HP):this.showDefeatMessage(),w.instance.onEndBattle(),this.combatNode.active=!1,I.instance.CharacterRaidData.write();case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.showDefeatMessage=function(){var t=this;this.battleDefeatEvent.forEach((function(e){return e.emit([t.onBattleDefeatEvent])}))},c.showVictoryMessage=function(){var t=this;this.battleVictoryEvent.forEach((function(e){return e.emit([function(){t.onBattleVictoryEvent();var e={id:"dialog_002",name:"戰鬥勝利獎勵",img:"npc_maze_merchant",dialogue:"獎勵由勝利者全拿！",rewards:[{id:"exp_1",name:"經驗值",img:"experience_point",amount:t._curEnemyTeamData.cr},{id:"money_1",name:"金幣",img:"money",amount:C(5,12)}]};if(console.log("this._curEnemyTeamData.escapeReward:",t._curEnemyTeamData.escapeReward),console.log("this._curEnemyTeamData.endReward:",t._curEnemyTeamData.endReward),t._isEscape){var n=t._curEnemyTeamData.escapeReward;Object.keys(n).forEach((function(t){console.log("rewardId:",t),"tourniquet_1"===t?e.rewards.push({id:t,name:"止血帶",img:"tourniquet",amount:n[t]}):"health_potion_1"===t?e.rewards.push({id:t,name:"生命藥水",img:"health_potion",amount:n[t]}):"medical_1"===t?(console.log("開賦能!!!"),I.instance.characterCombatData.tryIncreaseEmpowerCardRank("survivor",1)):"stealth_2"===t&&(console.log("開賦能!!!"),I.instance.characterCombatData.tryIncreaseEmpowerCardRank("stalker",1))}))}else{var a=t._curEnemyTeamData.endReward;Object.keys(a).forEach((function(t){"tourniquet_1"===t?e.rewards.push({id:t,name:"止血帶",img:"tourniquet",amount:a[t]}):"health_potion_1"===t&&e.rewards.push({id:t,name:"生命藥水",img:"health_potion",amount:a[t]})}))}var r=b(t.rewardIcon.node);r.active=!0;var i=r.getComponent(O);i._cardId=e.id,i._cardName=e.name,i._cardIcon=e.img,i.description=e.dialogue,t.cardPreview.refresh(r),console.log("data.rewards:",e.rewards),t.cardPreview.listReward(e.rewards,{money_1:I.instance.CharacterRaidData.Money})}])}))},c.playVictoryAnimation=function(){},c.parseCombatCard=function(t){var e=I.instance.database.combatEffectDatabase,n=[];return t.combatEffects.forEach((function(t){var a=e.find((function(e){return e.effectId===t.id}));a?n.push(w.instance.getCombatEffect(a)):console.log("卡片抽光了")})),n},c.setEnemyData=function(t){j.Log("設定敵人:",t),this._curEnemyTeamData=I.instance.database.enemyTeamDatabase.find((function(e){return e.id===t}))},c.setCombatCards=function(){var t=this,e=M.instance.empowerCombatCards;this._combatCardDataList=Object.values(e).map((function(t){return t.cards})).flat(),j.Log("可用牌庫",this._combatCardDataList.map((function(t){return t.cardName})));var n=[];this._combatCardDataList.forEach((function(e){var a=b(t.cardPrefab);a.parent=t.cardPrefab.parent,a.active=!0;var r=t.parseCombatCard(e),i=new B(e,r,!1);a.getComponent(_).setup(i),n.push(a)})),j.Log("可用牌組張數",n.length),E.instance.clear(),E.instance.addCardsToDeck(n),E.instance.shuffleDeck()},c.setCombatEffectStatus=function(){var t=I.instance.CharacterRaidData.CombatParam,e=[t.curHP,t.maxHP],n=t.ac,a=I.instance.CharacterRaidData.Hero.modifier,r=a.strength,i=a.wisdom,o=a.resilience,s=a.dexterity,c=3+s;this._playerUnitId=w.instance.join(this.myCombatEffectStatus,"玩家",e,n,c,r,s,i,o),j.Log("玩家",this._playerUnitId),this.loadEnemyData(),this._turnOrder=[this._playerUnitId].concat(this._enemyUnitIds),j.Log("順序",this._turnOrder)},c.loadEnemyData=function(){var t=this,e=I.instance.database.enemyDatabase;this._curEnemyTeamData.enemies.forEach((function(n){var a=e.find((function(t){return t.id===n}));j.Log("載入敵人:",a.name);var r=b(t.enemyCombatEffectStatus.node);r.parent=t.enemyFrontLayout.node,r.active=!0;var i=r.getComponent(T);i.Image=a.img;var o=w.instance.join(i,a.name,[a.hp,a.hp],a.ac,3,0,a.dexterity,a.wisdom,a.resilience);t._enemyUnitIds.push(o),t._unitEnemyIds[o]=n,r.getComponentInChildren(D).tagID=o,t._enemyId=n,t.combatTeach.emit("teachBegin",{detail:{id:t._enemyId,enabled:!0}})})),this.handCards.catchTag()},c.onPlayerTurn=function(){var t=i(o().mark((function t(){var e,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._playerUnitId,this.energyLabel.string=w.instance.getEnergy(e),this.equipments(),n=w.instance.getDrawCount(e),t.next=6,E.instance.drawCards(n);case 6:this.evolutionCombatCard();case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.onTurnEndClicked=function(){this.endPlayerTurn(),N.instance.hide()},c.onTouchedCardEvent=function(t){var e=t.getComponent(_).CombatCard;this.handCards.setNeedTarget(e.NeedTarget)},c.onPlayCardCheckEvent=function(t,e){var n=t.getComponent(_).CombatCard,a=this._playerUnitId;if(n){if(!w.instance.tryCostFee(a,n))return console.log("沒有足夠的能量"),void this.handCards.cancelSelect();this._hittingEnemyId="",n.NeedTarget&&(this._hittingEnemyId=e.getComponent(D).tagID,this._hittingEnemyId||console.error("!!!!!!!!!!!!!!!!!!!!!沒有選擇目標!!!!!!!!!!!!!!!!!!!!")),E.instance.playCard(t)}else console.error("沒有選擇卡牌")},c.onPlayCardEvent=function(t){var e=this,n=t.Effects,a=this._playerUnitId,r=this._hittingEnemyId,i=[].concat(n);if(t.Evolutions.forEach((function(t){return i.push(t.effect)})),r||!t.NeedTarget){if(r)i.some((function(t){return"cleave"===t.effectType}))?w.instance.onCardPlayed(i,a,this._enemyUnitIds):w.instance.onCardPlayed(i,a,[r]);else w.instance.onCardPlayed(i,a,this._enemyUnitIds);this.energyLabel.string=w.instance.getEnergy(a),i.forEach((function(t){return e._recordEffects.push(t)})),this.evolutionCombatCard();var o=w.instance.takeDiscardCount(this._playerUnitId);if(console.log("出牌時受棄牌效果影響，手牌數量:",this.handCards.cards.length,"要丟棄:",o),o>0){var s=this.handCards.cards.slice(0,o);E.instance.discardCards(s)}}else console.error("沒有選擇目標",r)},c.evolutionCombatCard=function(){var t=this._recordEffects.map((function(t){return t.effectType}));this.handCards.cards.forEach((function(e,n){var a=e.getComponent(_),r=a.CombatCard;t.length>0&&r.tryEvolutions(t)&&(a.nameLabel.string=r.Evolutions[r.Evolutions.length-1].name,a.updateEffects())}))},c.onPlayedCardEvent=function(t){var e=this;if(!this._isBattleEnd){var n=this._playerUnitId;if(t.CombatCard.reset(),t.nameLabel.string=t.CombatCard.Name,t.updateEffects(),this.isBattleOver())this.endBattle();else{var a=M.instance.empowerCombatCards,r=w.instance.getExtraDraw(n);Object.keys(r).forEach((function(t){var i=r[t],o=[],s=!1;switch(t){case"atk":w.instance.tryExtraDraw(n,t)&&(o=Object.values(a).map((function(t){return t.cards})).flat().filter((function(t){return t.cardId.indexOf("attack")>-1})),s=!0);break;case"def":w.instance.tryExtraDraw(n,t)&&(o=Object.values(a).map((function(t){return t.cards})).flat().filter((function(t){return t.cardId.indexOf("defense")>-1})),s=!0);break;case"ran":if(w.instance.tryExtraDraw(n,t))return void E.instance.drawCards(i);break;case"steal":if(console.log("extra steal:",r[t]),w.instance.tryExtraDraw(n,t))return E.instance.drawCards(i),void console.warn("steal 效果尚未實作")}o=o.sort((function(){return Math.random()-.5})).slice(0,i);var c=e.parseCombatCards(o,s);E.instance.unshiftCardsToDraw(c),E.instance.drawCards(i)}))}}},c.onCombatCardInfoEvent=function(t){t||j.Log("沒有node但進來了");var e=null==t?void 0:t.getComponent(_);if(e){var n=e.CombatCard.Evolutions[e.CombatCard.Evolutions.length-1],a=e.CombatCard.Effects.map((function(t){return"效果 - "+t.effectName+":<br/>"+t.description})),r=I.instance.database.combatEffectDatabase;a.push.apply(a,e.CombatCard.Evolutions.map((function(t){var e=r.find((function(e){return e.effectId===t.effect.effectId}));return"效果"+e.effectName+":<br/>"+e.description})));var i=[];i=n?["卡牌 - "+n.name+":<br/>"+e.CombatCard.Description].concat(a):["卡牌 - "+e.Name+":<br/>"+e.CombatCard.Description].concat(a),N.instance.show(i,t,S.FromTop,H.Normal),N.instance.enableBlock()}else j.Log("no component")},c.parseCombatCards=function(t,e){var n=this;void 0===e&&(e=!1);var a=[];return t.forEach((function(t){var r=b(n.cardPrefab);r.parent=n.cardPrefab.parent,r.active=!0;var i=n.parseCombatCard(t),o=new B(t,i,e);r.getComponent(_).setup(o),a.push(r)})),a},c.onEnermyAttackClicked=function(){var t=i(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=[]).length=0,e.push(this.parseCombatEffect("burning_5")),w.instance.onCardPlayed(e,this._playerUnitId,[this._enemyUnitIds[0]]);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.parseCombatEffect=function(t){var e=I.instance.database.combatEffectDatabase.find((function(e){return e.effectId===t}));return console.log(t," - combatEffectData:",e),w.instance.getCombatEffect(e)},c.equipments=function(){var t=this,e=I.instance.database.combatCardDatabase;I.instance.CharacterRaidData.getWeaponEffectIds().forEach((function(n){if(""!==n){var a="";"Slashing"===n?(a="slash",t._recordEffects.push(t.parseCombatEffect("Slashing"))):"Bludgeoning"===n?(a="blunt_blow",console.log(JSON.stringify(t.parseCombatEffect("Bludgeoning"))),t._recordEffects.push(t.parseCombatEffect("Bludgeoning"))):"Piercing"===n&&(a="thrust",t._recordEffects.push(t.parseCombatEffect("Piercing")));var r=Object.values(e).find((function(t){return t.cardId.indexOf(a)>-1})),i=t.parseCombatCards([r],true);E.instance.unshiftCardsToDraw(i)}})),console.log("this._recordEffects:",this._recordEffects)},c.item=function(t,e){var n=I.instance.database.combatCardDatabase.find((function(t){return t.cardId===e})),a=this.parseCombatCards([n],true);this._itemCard=a[0],this._itemCombatCard=new B(n,this.parseCombatCard(n),true);var r=this.node.getComponent(p).convertToNodeSpaceAR(this.useItemBoard.worldPosition);E.instance.previewCard(this._itemCard,1.5,0,1,this.useItemBoard,r.add3f(0,20,0)),this.useItemBoard.active=!0,this._usingItem=t,console.log("this._recordEffects:",this._recordEffects)},c.onUseItemButtonClicked=function(){var t=this;(this.useItemBoard.active=!1,w.instance.tryCostFee(this._playerUnitId,this._itemCombatCard))?this.characterInfo.usetItem(this._usingItem)&&(E.instance.consumeCard(this._itemCard),this.beltInventoryCollection.inventory.clear(),this.beltInventoryCollection.getComponentsInChildren(z).forEach((function(t){t.clear()})),I.instance.CharacterRaidData.getBelt().forEach((function(e){t.beltInventoryCollection.collect(e)}))):this.onCancelItemButtonClicked()},c.onCancelItemButtonClicked=function(){this.useItemBoard.active=!1,this._itemCard.destroy(),this._itemCard=null,this._itemCombatCard=null},s(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(g))._instance=null,ft=e((lt=Ut).prototype,"combatNode",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ht=e(lt.prototype,"cardPrefab",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mt=e(lt.prototype,"handCards",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(lt.prototype,"myCombatEffectStatus",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ct=e(lt.prototype,"enemyCombatEffectStatus",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bt=e(lt.prototype,"enemyFrontLayout",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gt=e(lt.prototype,"endTurnButton",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yt=e(lt.prototype,"popupWindow",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vt=e(lt.prototype,"cameraCenterMover",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_t=e(lt.prototype,"energyLabel",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Et=e(lt.prototype,"countdownLabel",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),It=e(lt.prototype,"useItemBoard",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wt=e(lt.prototype,"cardPreview",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tt=e(lt.prototype,"rewardIcon",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bt=e(lt.prototype,"expProgressBar",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xt=e(lt.prototype,"characterInfo",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dt=e(lt.prototype,"beltInventoryCollection",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kt=e(lt.prototype,"combatTeach",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pt=e(lt.prototype,"battleVictoryEvent",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Lt=e(lt.prototype,"battleDefeatEvent",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ot=e(lt.prototype,"inventoryOptions",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=lt))||dt));c._RF.pop()}}}));

System.register("chunks:///_virtual/BeltDropZone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DropZone.ts","./Draggable.ts","./Inventory.ts","./BattleManager.ts","./GroceriesDraggable.ts"],(function(t){var e,n,o,i,r,a,s,l,m,u,c,p,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.createClass},function(t){a=t.cclegacy,s=t._decorator,l=t.EventHandler},function(t){m=t.DropZone},function(t){u=t.Draggable},function(t){c=t.InventoryEvent},function(t){p=t.BattleManager},function(t){f=t.GroceriesDraggable}],execute:function(){var g,h,d,v,I,D,y;a._RF.push({},"2f3e9t32vtI4YTOLf1VCZyO","BeltDropZone",void 0);var b=s.ccclass,C=s.property;t("BeltDropZone",(g=b("BeltDropZone"),h=C(l),d=C(l),g((D=e((I=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,o(e,"beltDropInEvent",D,i(e)),o(e,"beltDropOutEvnet",y,i(e)),e._itemTipCard=void 0,e}n(e,t);var a=e.prototype;return a.init=function(){var t=this.item;this.ItemTipCard={string:t.name,coping:t.id,type:t.type,value:t.amount.toString()}},a.lockDraggable=function(t){void 0===t&&(t=!0);var e=this.slot.getComponentInChildren(u);e&&(e.isLocked=t)},a.onDrop=function(t){var n=this,o=t.draggableItem,i=t.dropZone,r=0,a=!1,s=this.slot.getComponentInChildren(u);if(s){var l=o.Amount+s.Amount;if(o.isSameItem(s.Item)&&l<=o.Item.stackLimit)o.mergeItems(s.node),o.zone instanceof e&&this.node.dispatchEvent(new c("removeItem",!0,{item:this.item,amount:0})),r=s.Amount,a=!0,console.log("合併道具數量:",o.Amount,"+",r,"=",o.Amount+r);else{if(!s.setParent(i))return o.resetPosition();console.log("道具已存在，交换位置",o.Item.name,"取代",s.Item.name)}}var m=o.Item;m.amount+=r,o.zone instanceof e||(console.log("外部道具移入背包"),this.node.dispatchEvent(new c("moveItem",!0,{item:m,amount:m.amount,isMerge:a}))),o.setParent(this),console.log(o.Item.name,"道具已放置"),i.dropOut(o),this.beltDropInEvent.forEach((function(t){return t.emit([n.item,n.item.amount])}))},a.onBeltDropInEvent=function(t,e){this.ItemTipCard={string:t.name,coping:t.id,type:t.type,value:e.toString()}},a.onBeltDropOutEvent=function(t,e){this.ItemTipCard=null},a.dropOut=function(t){this.beltDropOutEvnet.forEach((function(e){return e.emit([t.Item,t.Item.amount])})),t.zone instanceof e||(this.node.dispatchEvent(new c("removeItem",!0,{item:t.Item,amount:t.Item.amount})),console.log("道具已移出背包"))},a.clear=function(){this.slot.removeAllChildren()},a.useItem=function(){var t,e=this.item;this.ItemTipCard={string:e.name,coping:e.id,type:e.type,value:e.amount.toString()},null==(t=this.slot.getComponentInChildren(f))||t.updateDisplay()},a.onClicked=function(){var t;console.log("背包被點擊",this.item,null==(t=this.item)?void 0:t.amount),this.item&&p.instance.item(this.item.id,this.item.effectId)},r(e,[{key:"ItemTipCard",get:function(){return this._itemTipCard},set:function(t){this._itemTipCard=t}}]),e}(m)).prototype,"beltDropInEvent",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),y=e(I.prototype,"beltDropOutEvnet",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=I))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/BiteAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,r,i,o,a,c,s,u,h,l,p,f,v,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){c=t.cclegacy,s=t._decorator,u=t.Node,h=t.Component,l=t.Tween,p=t.randomRangeInt,f=t.v3,v=t.tween,m=t.UITransform}],execute:function(){var y,w,g,b,d,T,P,_,A;c._RF.push({},"648f0RJGtJBvb9fvgpkjah5","BiteAnimation",void 0);var R=s.ccclass,x=s.property;t("BiteAnimation",(y=R("BiteAnimation"),w=x(u),g=x(u),b=x(u),y((P=e((T=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,r(e,"teethRoot",P,i(e)),r(e,"teeth0",_,i(e)),r(e,"teeth1",A,i(e)),e._oriTeeth1Pos=[],e}n(e,t);var c=e.prototype;return c.onLoad=function(){this.teeth0.active=!1,this.teeth1.forEach((function(t){t.active=!1})),this._oriTeeth1Pos=[this.teeth1[0].position.clone(),this.teeth1[1].position.clone()]},c.startAnimation=function(){var t=o(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l.stopAllByTarget(this.teeth0),this.teethRoot.angle=p(-45,45),this.teethRoot.scale=f(1,1,1),v(this.teethRoot).to(.1,{scale:f(2,2)}).start(),t.next=6,this.playScaleAnimation();case 6:this.moveSprites();case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.playScaleAnimation=function(){var t=o(a().mark((function t(){var e=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.teeth0.scale.y,r=e.teeth0.getComponent(m).height;e.teeth0.active=!0,v(e.teeth0).to(.15,{scale:f(1,n+60/r,1)},{easing:"cubicOut"}).delay(.1).call((function(){t(),e.teeth0.scale=f(1,1,1),e.teeth0.active=!1})).start()})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),c.moveSprites=function(){var t=o(a().mark((function t(){var e=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.teeth1.forEach((function(t){return t.active=!0})),v(e.teeth1[0]).to(.05,{position:f(e._oriTeeth1Pos[0].x,e._oriTeeth1Pos[0].y-45)}).start(),v(e.teeth1[1]).to(.05,{position:f(e._oriTeeth1Pos[1].x,e._oriTeeth1Pos[1].y+45)}).delay(.15).call((function(){t(),e.teeth1.forEach((function(t,n){t.position=e._oriTeeth1Pos[n].clone(),t.active=!1}))})).start()})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),c.onButtonClick=function(){var t=o(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.startAnimation();case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(h)).prototype,"teethRoot",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(T.prototype,"teeth0",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(T.prototype,"teeth1",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),d=T))||d));c._RF.pop()}}}));

System.register("chunks:///_virtual/CameraCenterMover.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var e,r,n,t,i,a,u,c,d,s,f,l,p;return{setters:[function(o){e=o.applyDecoratedDescriptor,r=o.inheritsLoose,n=o.initializerDefineProperty,t=o.assertThisInitialized},function(o){i=o.cclegacy,a=o._decorator,u=o.Node,c=o.v3,d=o.Vec3,s=o.view,f=o.UITransform,l=o.tween,p=o.Component}],execute:function(){var g,m,v,h,b,y,N,w,z,F,C,k,E,T,M,x;i._RF.push({},"26e98L2djNEAIefDtGVZOdA","CameraCenterMover",void 0);var O=a.ccclass,B=a.property;o("CameraCenterMover",(g=O("CameraCenterMover"),m=B(u),v=B([u]),h=B([u]),b=B([u]),g((w=e((N=function(o){function e(){for(var e,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i))||this,n(e,"touchPanel",w,t(e)),n(e,"moveX",z,t(e)),n(e,"moveY",F,t(e)),n(e,"foregroundNodes",C,t(e)),n(e,"midgroundNodes",k,t(e)),n(e,"backgroundNodes",E,t(e)),n(e,"foregroundFactor",T,t(e)),n(e,"midgroundFactor",M,t(e)),n(e,"backgroundFactor",x,t(e)),e}r(e,o);var i=e.prototype;return i.onLoad=function(){this.touchPanel.on(u.EventType.TOUCH_MOVE,this.onTouchMove,this)},i.onTouchMove=function(o){var e=o.getDelta();this.moveByOffset(c(e.x,e.y,0))},i.moveByOffset=function(o){var e=this;o=new d(this.moveX?o.x:0,this.moveY?o.y:0,0),this.foregroundNodes.forEach((function(r){e.positionNode(r,o,e.foregroundFactor)})),this.midgroundNodes.forEach((function(r){e.positionNode(r,o,e.midgroundFactor)})),this.backgroundNodes.forEach((function(r){e.positionNode(r,o,e.backgroundFactor)}))},i.positionNode=function(o,e,r){var n=new d(e.x*r,e.y*r,e.z);o.position=o.position.clone().add(n)},i.moveToBorder=function(o){this.moveByOffset(c(o,0,0))},i.moveToCenter=function(o){var e=this,r=s.getVisibleSize(),n=new d(r.width/2,r.height/2,0),t=o.getComponent(f).convertToWorldSpaceAR(new d(0,0,0)),i=new d(this.moveX?n.x-t.x:0,this.moveY?n.y-t.y:0,0);this.foregroundNodes.forEach((function(o){e.moveNode(o,i,e.foregroundFactor)})),this.midgroundNodes.forEach((function(o){e.moveNode(o,i,e.midgroundFactor)})),this.backgroundNodes.forEach((function(o){e.moveNode(o,i,e.backgroundFactor)}))},i.moveNode=function(o,e,r){var n=new d(e.x*r,e.y*r,e.z),t=o.position.clone().add(n);l(o).to(1,{position:t},{easing:"quadInOut"}).start()},e}(p)).prototype,"touchPanel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(N.prototype,"moveX",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),F=e(N.prototype,"moveY",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),C=e(N.prototype,"foregroundNodes",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),k=e(N.prototype,"midgroundNodes",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),E=e(N.prototype,"backgroundNodes",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),T=e(N.prototype,"foregroundFactor",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),M=e(N.prototype,"midgroundFactor",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),x=e(N.prototype,"backgroundFactor",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),y=N))||y));i._RF.pop()}}}));

System.register("chunks:///_virtual/CardComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PixelImage.ts"],(function(e){var t,n,o,r,c,i,a,s;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){o=e.cclegacy,r=e._decorator,c=e.Sprite,i=e.v3,a=e.Component},function(e){s=e.PixelImage}],execute:function(){var d;o._RF.push({},"fb275fVietK178DsZ4xC8/t","CardComponent",void 0);var p=r.ccclass;r.property,e("CardComponent",p("CardComponent")(d=function(e){function o(){for(var t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))||this)._cardId="",t._cardName="",t._cardIcon="",t.isFliped=!1,t.description="",t}return t(o,e),o.prototype.setIcon=function(e){var t;this._cardIcon=e,null==(t=this.getComponent(s))||t.setSpriteFrame(e),this.node.getComponent(c).sizeMode=c.SizeMode.RAW,this.node.scale=i(2,2,2),this.node.active=!0},n(o,[{key:"cardId",get:function(){return this._cardId}},{key:"cardName",get:function(){return this._cardName}}]),o}(a))||d);o._RF.pop()}}}));

System.register("chunks:///_virtual/CardMover.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,o,r,a,i,s,c;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,o=n._decorator,r=n.UITransform,a=n.tween,i=n.v3,s=n.Vec3,c=n.Component}],execute:function(){var u;e._RF.push({},"84f9242HqlIxoYCUsq4N1ow","CardMover",void 0);var d=o.ccclass;n("CardMover",d("CardMover")(u=function(n){function e(){return n.apply(this,arguments)||this}return t(e,n),e.moveCard=function(n,t,e,o,a,i){void 0===o&&(o=1),void 0===a&&(a=.02),void 0===i&&(i=.25);var s=n.parent.getComponent(r),c=t.getComponent(r);if(!s||!c)return Promise.reject(new Error("UITransform component is missing"));var u=s.convertToWorldSpaceAR(n.position);n.removeFromParent(),n.parent=t;var d=c.convertToNodeSpaceAR(u);return n.setPosition(d),this.animateCardMovement(n,e,o,a,i)},e.animateCardMovement=function(n,t,e,o,r){return new Promise((function(s){var c=a().delay(o).call((function(){return s()})),u=a(n).delay(r/2).to(r/4,{scale:i(e,e,1)},{easing:"quadInOut"}),d=a(n).to(r,{position:t},{easing:"quadInOut"});a(n).parallel(d,u,c).start()}))},e.scatterCards=function(n,t,e,o){return new Promise((function(r){n.forEach((function(n){var i=e[0],c=e[1],u=2*Math.random()*Math.PI,d=i+Math.random()*(c-i),v=new s(Math.cos(u),Math.sin(u),0),l=s.scaleAndAdd(new s,t.position,v,d);a(n).to(o,{position:l},{easing:"cubicOut"}).call((function(){return r()})).start()}))}))},e}(c))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/CardPreview.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CardComponent.ts","./QuestInteraction.ts","./RewardInteraction.ts","./GameManager.ts"],(function(e){var t,n,i,r,a,o,l,s,c,u,C,p,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Node,s=e.Label,c=e.Component},function(e){u=e.CardComponent},function(e){C=e.QuestInteraction},function(e){p=e.RewardInteraction},function(e){d=e.GameManager}],execute:function(){var h,f,m,w,g,v,b,P,y,_,L;a._RF.push({},"6d5ealQPgFJwL+MefBf+Ms3","CardPreview",void 0);var R=o.ccclass,k=o.property;e("CardPreview",(h=R("CardPreview"),f=k(l),m=k(l),w=k(l),g=k(s),h((P=t((b=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"mainContainer",P,r(t)),i(t,"questContainer",y,r(t)),i(t,"rewardContainer",_,r(t)),i(t,"descriptionLabel",L,r(t)),t._card=null,t._oriParent=null,t.nextPathCallback=null,t}n(t,e);var a=t.prototype;return a.refresh=function(e){var t,n;this.node.active=!0,this._card=e,this._oriParent=e.parent,e.parent=this.mainContainer;var i=e.getComponent(u);this.descriptionLabel.string=i.description,null==(t=this.questContainer.getComponent(C))||t.reset(),null==(n=this.rewardContainer.getComponent(p))||n.setDescription(i.description)},a.close=function(){var e,t,n;this.node.active=!1,this._card.parent=this._oriParent,this.descriptionLabel.string="",this._card.getComponent(u).isFliped=!1,null==(e=this.questContainer.getComponent(C))||e.close(),null==(t=this.rewardContainer.getComponent(p))||t.close(),this.questContainer.active=!1,this.rewardContainer.active=!1,d.instance.characterCombatData.write(),d.instance.CharacterRaidData.write(),d.instance.CharacterRaidData.CombatParam.write(),null==(n=this.nextPathCallback)||n.call(this)},a.listQuest=function(e){var t;this.questContainer.active=!0,null==(t=this.questContainer.getComponent(C))||t.listQuest(e)},a.listReward=function(e,t){var n;this.rewardContainer.active=!0,null==(n=this.rewardContainer.getComponent(p))||n.listReward(e,t)},a.onCloseClicked=function(){var e;console.log("onCloseClicked"),null!=(e=this.rewardContainer.getComponent(p))&&e.isBlocked()||this.close()},a.onCloseButtonClicked=function(){this.close()},t}(c)).prototype,"mainContainer",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(b.prototype,"questContainer",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(b.prototype,"rewardContainer",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(b.prototype,"descriptionLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=b))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/Character.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Attribute.ts"],(function(i){var t,e,o,r,c;return{setters:[function(i){t=i.createClass},function(i){e=i.cclegacy},function(i){o=i.CompositeAttribute,r=i.AbilityScoreModifier,c=i.SavingThrowAttribute}],execute:function(){e._RF.push({},"9885cx4bRFDN7nQix0M2Gy1","Character",void 0);i("Character",function(){function i(i){this.name=void 0,this.level=0,this._abilityScore=void 0,this._compositeAttribute=new o,this._abilityScoreModifier=new r,this._savingThrowAttribute=new c,this.savingThrowProficiencies=[],i&&this.loadData(i)}var e=i.prototype;return e.loadData=function(i){this.name=i.name,this.level=i.level,this.abilityScore=i.abilityScore,this.savingThrowProficiencies=i.savingThrowProficiencies},e.calculateClassProficiencyBonus=function(){return this.level>=17?6:this.level>=13?5:this.level>=9?4:this.level>=5?3:2},e.updateSavingThrow=function(i){this.savingThrowProficiencies=i,this._savingThrowAttribute.calculate(this._abilityScoreModifier,this.savingThrowProficiencies,this.calculateClassProficiencyBonus())},t(i,[{key:"abilityScore",get:function(){return this._abilityScore},set:function(i){this._abilityScore=i,this._compositeAttribute.calculate(i),this._abilityScoreModifier.calculate(i)}},{key:"modifier",get:function(){return this._abilityScoreModifier}},{key:"composite",get:function(){return this._compositeAttribute}}]),i}());e._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterCombatData.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NotificationManager.ts","./StorageTool.ts"],(function(t){var e,r,i,o,n;return{setters:[function(t){e=t.createClass},function(t){r=t.cclegacy,i=t.randomRangeInt},function(t){o=t.NotificationManager},function(t){n=t.StorageTool}],execute:function(){r._RF.push({},"b0052CXTd5Og7XDST/d9g4h","CharacterCombatData",void 0);t("CharacterCombatParams",function(){var t=r.prototype;function r(){this._hitPiont=[6,6],this._armorClass=8,this._experience=[0,2],this.read()||this.reset()}return t.updagteArmorClass=function(t){void 0===t&&(t=0),this._armorClass=t||8},t.write=function(){n.saveToFile("character_combat_params",{hp0:this._hitPiont[0],hp1:this._hitPiont[1],ac:this._armorClass,exp0:this._experience[0],exp1:this._experience[1]})},t.read=function(){var t=n.loadFromFile("character_combat_params");return!!t&&(this._hitPiont[0]=t.hp0,this._hitPiont[1]=t.hp1,this._armorClass=t.ac,this._experience[0]=t.exp0,this._experience[1]=t.exp1,!0)},t.reset=function(){n.deleteFile("character_combat_params"),this._hitPiont[1]=6,this.refillHP(),this._experience[1]=2,this._experience[0]=0,this.write()},t.refillHP=function(){this._hitPiont[0]=this._hitPiont[1]},t.upgradeHP=function(t){this._hitPiont[1]+=t},t.resultExperience=function(){this._experience[0]%=this._experience[1]},t.accumulateExperience=function(t){this._experience[0]+=t},t.upgradeExperiece=function(t){this._experience[1]=Math.pow(2,t)},e(r,[{key:"curHP",get:function(){return this._hitPiont[0]},set:function(t){this._hitPiont[0]=Math.min(t,this._hitPiont[1])}},{key:"maxHP",get:function(){return this._hitPiont[1]}},{key:"ac",get:function(){return this._armorClass}},{key:"curExp",get:function(){return this._experience[0]}},{key:"maxExp",get:function(){return this._experience[1]}}]),r}()),t("CharacterCombatData",function(){function t(){this._empowerCardRanks={},this.empowerCardDatabase=[],this._empowerPoints=0,this._empowerCombatCardIds={},this._lottery=[15,9,4,2,1],this._comboList={}}var r=t.prototype;return r.addEmpowerPoints=function(t){this._empowerPoints+=t,this.notifyEmpowerPoints()},r.notifyEmpowerPoints=function(){console.log("this._empowerPoints:",this._empowerPoints),o.instance.updateNotificationCount("EmpowerBadge",this._empowerPoints)},r.updateEmpowerCombatCardIds=function(t,e){this._empowerCombatCardIds[t]=e},r.getEmpowerCombatCardIds=function(t){return this._empowerCombatCardIds[t]||[]},r.reset=function(){var t;t="character_empower_card_ranks",n.deleteFile(t),this._empowerCardRanks={},t="character_empower_combat_cards",n.deleteFile(t),this._empowerCombatCardIds={},this.empowerPoints=1},r.read=function(){var t,e;this._empowerCardRanks=n.loadFromFile("character_empower_card_ranks"),this._empowerCombatCardIds=n.loadFromFile("character_empower_combat_cards"),this._empowerCombatCardIds||(this._empowerCombatCardIds={}),null!=(t=e=n.loadFromFile("character_data"))&&t.empowerPoints&&(this.empowerPoints=e.empowerPoints),this._comboList=n.loadFromFile("combat_card_combo_list")||{}},r.write=function(){n.saveToFile("character_empower_card_ranks",this._empowerCardRanks),n.saveToFile("character_empower_combat_cards",this._empowerCombatCardIds);var t={empowerPoints:this.empowerPoints};n.saveToFile("character_data",t)},r.getEmpowerCardRank=function(t){return this._empowerCardRanks[t]||0},r.getEmpowerCardRanks=function(){return this._empowerCardRanks},r.nextPath=function(){},r.tryIncreaseEmpowerCardRank=function(t,e,r){var i=this;if(void 0===e&&(e=1),void 0===r&&(r=1),r>this.empowerPoints)return console.warn("Not enough empower points to rank up",this.empowerPoints,"/",r),!1;var o=this.getEmpowerCardRank(t)+e;return this.empowerCardDatabase.some((function(e){return e.regimentation===t&&e.regimentationRank===o&&(i._empowerCardRanks[t]=o,!0)}))},r.getRewardOption=function(){var t=this,e="",r=this._lottery.length-1,o=this.empowerCardDatabase.slice().sort((function(){return Math.random()-.5})).find((function(o){var n=o.regimentation,a=t.getEmpowerCardRank(n)+1;return!(a!=o.regimentationRank||a>r)&&(t._lottery[a]>i(0,20)||void(e=n))}));return o||this.empowerCardDatabase.find((function(i){var o=i.regimentation;return t.getEmpowerCardRank(o)<=r&&o===e}))},r.getRewardOptionList=function(){for(var t=50,e=[];e.length<3;){var r=this.getRewardOption();if(e.includes(r)||e.push(r),--t<=0)break}return e},r.triggerCombo=function(t,e){console.log("this._comboList[",t,"]:",this._comboList[t]),console.log("觸發連攜，卡片ID:",t,"條件:",e),this._comboList[t]=e,n.saveToFile("combat_card_combo_list",this._comboList)},r.getComboListByCardName=function(t){return this._comboList[t]||[]},e(t,[{key:"empowerPoints",get:function(){return this._empowerPoints},set:function(t){this._empowerPoints=t,this.notifyEmpowerPoints()}}]),t}());r._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterInfo.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AbilityTable.ts","./AdvenceSkillTable.ts","./InventoryCollection.ts","./Inventory.ts","./FloatingTextComponent.ts","./GameManager.ts","./NotificationManager.ts","./BeltDropZone.ts","./Weapon.ts","./DropZone.ts","./Armor.ts"],(function(e){var t,n,i,a,o,r,l,c,s,u,b,p,h,d,f,v,y,m,C,I,g,k,w,A;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.createForOfIteratorHelperLoose,r=e.createClass},function(e){l=e.cclegacy,c=e._decorator,s=e.Node,u=e.Label,b=e.Vec3,p=e.Button,h=e.Component},function(e){d=e.AbilityTable},function(e){f=e.AdvenceSkillTable},function(e){v=e.InventoryCollection},function(e){y=e.Inventory},function(e){m=e.FloatingTextComponent},function(e){C=e.GameManager},function(e){I=e.NotificationManager},function(e){g=e.BeltDropZone},function(e){k=e.Weapon},function(e){w=e.DropZone},function(e){A=e.Armor}],execute:function(){var D,T,R,_,E,S,M,L,P,q,z,B,W,Z,F,H,x,O,N,G,Q,U,j,V,J,K,X,Y,$,ee,te;l._RF.push({},"08f1a8aAp9CvplC0lZztiip","CharacterInfo",void 0);var ne=c.ccclass,ie=c.property;e("CharacterInfo",(D=ne("CharacterInfo"),T=ie(s),R=ie(d),_=ie(u),E=ie(f),S=ie(s),M=ie(s),L=ie(s),P=ie(s),q=ie(s),z=ie(u),B=ie(m),W=ie(y),Z=ie(w),F=ie(w),D((O=t((x=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return t=e.call.apply(e,[this].concat(o))||this,i(t,"block",O,a(t)),i(t,"abilityTable",N,a(t)),i(t,"abilityTableModifierLabel",G,a(t)),i(t,"advenceSkillTable",Q,a(t)),i(t,"backpackInventoryContainer",U,a(t)),i(t,"beltInventoryContainer",j,a(t)),i(t,"combatBeltInventoryContainer",V,a(t)),i(t,"storeInventoryContainer",J,a(t)),i(t,"equipmentsContainer",K,a(t)),i(t,"moneyLabel",X,a(t)),i(t,"moneyFloatingText",Y,a(t)),i(t,"equippedInventory",$,a(t)),i(t,"armorDropZone",ee,a(t)),i(t,"weaponDropZone",te,a(t)),t._hero=void 0,t._options=[],t._avaliableAbilityPoints=0,t}n(t,e);var l=t.prototype;return l.updateMoney=function(e){var t=this;e?(this.moneyFloatingText.startPoint=new b(0,e<=0?20:-20,0),this.moneyFloatingText.showNumber(e,(function(){t.moneyLabel.string=C.instance.CharacterRaidData.Money.toString()}))):this.moneyLabel.string=C.instance.CharacterRaidData.Money.toString()},l.updateAbilityTableModifierLabel=function(){var e=Object.values(C.instance.CharacterRaidData.Hero.modifier).map((function(e){return(e>0?"+":"")+e}));this.abilityTableModifierLabel.string="("+e.join(")\n(")+")"},l.onLoad=function(){this.abilityTableModifierLabel.node.active=!1},l.start=function(){var e=this;this.scheduleOnce((function(){C.instance.CharacterRaidData.getWeaponIds().forEach((function(t,n){t&&e.equippedInventory.create(e.weaponItem(t),e.weaponDropZone[n],1)}));var t=C.instance.CharacterRaidData.getArmorId();t&&e.equippedInventory.create(e.armorItem(t),e.armorDropZone,1),C.instance.CharacterRaidData.refreshWeaponEffectIds(),C.instance.CharacterRaidData.refreshArmorClass(),e.updateStatus()}),1)},l.updateStatus=function(){this._hero=C.instance.CharacterRaidData.Hero,this._avaliableAbilityPoints=this._hero.AvaliablePoints,C.instance.CharacterRaidData.AvaliableAbilityPoints=this._avaliableAbilityPoints},l.cropQuestReward=function(e){e.forEach((function(e){var t=e.split(" "),n=t[0];switch(t[1]){case"gold":C.instance.CharacterRaidData.addMoney(parseInt(n));break;case"prestige":C.instance.CharacterRaidData.raisePrestige(parseInt(n))}})),this.updateStatus()},l.releaseOtherButton=function(e){e.interactable=!1;for(var t,n=o(this._options);!(t=n()).done;){var i=t.value;i!==e&&(i.interactable=!0)}!this._options.includes(e)&&this._options.push(e)},l.onShowAbilityClicked=function(e){var t=e.target.getComponent(p);this.releaseOtherButton(t),this.block.active=!0,this.abilityTable.show(),this.abilityTableModifierLabel.node.active=!0,this._hero.IsCreated?this._avaliableAbilityPoints?this.abilityTable.allocateHeroAbility(this._hero,this._avaliableAbilityPoints):this.abilityTable.showHeroAbility(this._hero):this.abilityTable.allocateHeroAbility(this._hero,this._avaliableAbilityPoints),this.updateAbilityTableModifierLabel()},l.onShowAdvenceSkillClicked=function(e){},l.onUICloseClicked=function(){this.block.active=!1,this._avaliableAbilityPoints=this.abilityTable.avaliablePoints,C.instance.CharacterRaidData.CombatParam.write(),this.abilityTable.onSaveClicked(),this.abilityTable.node.active=!1,this.abilityTableModifierLabel.node.active=!1,this._options.forEach((function(e){return e.interactable=!0})),this.showBackpackAndEquipments(!1),this.storeInventoryContainer.active=!1},l.showBackpackAndEquipments=function(e){void 0===e&&(e=!0),this.backpackInventoryContainer.active=e,this.equipmentsContainer.active=e,this.beltInventoryContainer.active=e},l.addQuestGoal=function(e,t,n){var i=this.backpackInventoryContainer.getComponent(v);if(i){var a=this.backpackInventoryContainer.getComponent(y),o=a.listItems().find((function(t){return t.id===e&&a.getItemCount(t)<t.stackLimit}));if(o)i.addCount(o,1);else{var r={id:e,string:t,type:"groceries",value:"1",pic:n};i.collect(r)}}},l.checkQuestGoal=function(e,t){if(this.backpackInventoryContainer.getComponent(v)){var n=this.backpackInventoryContainer.getComponent(y),i=n.listItems().filter((function(i){return console.log("檢查item:",i,"amount:",n.getItemCount(i)),i.id===e&&n.getItemCount(i)>=t}));return console.log("檢查goalId:",e,"items:",i),i.length>0}return!1},l.completeQuest=function(e,t){var n=this.backpackInventoryContainer.getComponent(v);n&&this.backpackInventoryContainer.getComponent(y).listItems().filter((function(t){return t.id===e})).forEach((function(e){n.deleteItem(e,t),console.log("完成任務，移除背包的item:",e)}))},l.usetItem=function(e){var t=!1,n=this.beltInventoryContainer.getComponent(v);if(n){console.log("cardId:",e);var i=this.beltInventoryContainer.getComponent(y).listItems().find((function(t){return t.id===e}));if(!i)return!1;console.log("item:",i),n.deleteItem(i,1),t=!0;var a=[];this.beltInventoryContainer.getComponentsInChildren(g).forEach((function(t){var n=t.item;if(!n)return null;n.id===e&&(console.log("使用物品:",n.name,n.amount),t.useItem()),console.log("dropZone.ItemTipCard:",t.ItemTipCard),a.push(t.ItemTipCard)})),C.instance.CharacterRaidData.updateBelt(a)}return t},l.onShowBackpackClicked=function(e){var t=!this.beltInventoryContainer.active;this.showBackpackAndEquipments(t),this.storeInventoryContainer.active=!1,this.block.active=t},l.armorItem=function(e){var t=C.instance.database.armorDatabase.find((function(t){return t.id===e}));if(!t)return null;t.dex;var n=t.str,i=parseInt(t.weight.split(" lb")[0],10);return new A(t.id,"armor",t.name,t.id,t.value,i,t.ac,n,t.stealth,t.armor_type,t.description)},l.weaponItem=function(e){var t=C.instance.database.weaponDatabase.find((function(t){return t.id===e}));if(!t)return null;var n=parseInt(t.weight.split(" lb")[0],10);return new k(t.id,"weapon",t.name,t.value,n,t.type,t.id,{dice:t.damage1,dice2:t.damage2,type:t.damage_type},["Versatile"],"Melee",t.description)},l.onShowStoreClicked=function(e){var t=!this.storeInventoryContainer.active;this.storeInventoryContainer.active=t,this.backpackInventoryContainer.active=t,this.block.active=t,this.beltInventoryContainer.active=!1},l.onEquipArmorEvent=function(e){console.log("onEquipArmorEvent:",e),C.instance.CharacterRaidData.setArmorId(e.id),C.instance.CharacterRaidData.write(),C.instance.CharacterRaidData.refreshArmorClass()},l.onUnequipArmorEvent=function(e){console.log("onUnequipArmorEvent:",e),C.instance.CharacterRaidData.setArmorId(""),C.instance.CharacterRaidData.write(),C.instance.CharacterRaidData.refreshArmorClass()},l.onEquipMainWeaponOrShieldEvent=function(e){console.log("主手裝備:",e),C.instance.CharacterRaidData.setWeaponIds(e.id),C.instance.CharacterRaidData.write(),C.instance.CharacterRaidData.refreshWeaponEffectIds()},l.onEquipSecondaryWeaponOrShieldEvent=function(e){console.log("副手裝備:",e),C.instance.CharacterRaidData.setWeaponIds("",e.id),C.instance.CharacterRaidData.write(),C.instance.CharacterRaidData.refreshWeaponEffectIds()},l.onUnequipWeaponOrShieldEvent=function(e){console.log("卸除武裝:",e),C.instance.CharacterRaidData.removeWeaponId(e.id),C.instance.CharacterRaidData.write(),C.instance.CharacterRaidData.refreshWeaponEffectIds()},r(t,[{key:"avaliableAbilityPoints",set:function(e){this._avaliableAbilityPoints=e,I.instance.updateNotificationCount("AbilityBadge",this._avaliableAbilityPoints),this.abilityTable.allocateHeroAbility(C.instance.CharacterRaidData.Hero,this._avaliableAbilityPoints),this.updateAbilityTableModifierLabel()}}]),t}(h)).prototype,"block",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(x.prototype,"abilityTable",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(x.prototype,"abilityTableModifierLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(x.prototype,"advenceSkillTable",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(x.prototype,"backpackInventoryContainer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(x.prototype,"beltInventoryContainer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(x.prototype,"combatBeltInventoryContainer",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(x.prototype,"storeInventoryContainer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(x.prototype,"equipmentsContainer",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(x.prototype,"moneyLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(x.prototype,"moneyFloatingText",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(x.prototype,"equippedInventory",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(x.prototype,"armorDropZone",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(x.prototype,"weaponDropZone",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),H=x))||H));l._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterRaidData.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Hero.ts","./CharacterCombatData.ts","./StorageTool.ts","./NotificationManager.ts","./GameManager.ts"],(function(t){var e,a,i,n,o,r,s;return{setters:[function(t){e=t.createClass},function(t){a=t.cclegacy},function(t){i=t.Hero},function(t){n=t.CharacterCombatParams},function(t){o=t.StorageTool},function(t){r=t.NotificationManager},function(t){s=t.GameManager}],execute:function(){a._RF.push({},"7fbc3EwfsdKooedTZRu1v6U","CharacterRaidData",void 0);t("CharacterRaidData",function(){function t(){this._prestige=0,this._money=0,this._hero=null,this._combat=null,this._avaliableAbilityPoints=0,this._backpack=[],this._belt=[],this._weaponIds=["",""],this._weaponEffectIds=["",""],this._armorId="";this.createHero("Hero"),this.read()}var a=t.prototype;return a.write=function(){o.saveToFile("avaliable_points",{ability:this._avaliableAbilityPoints}),o.saveToFile("character_assets",{ownMoney:this._money,backpack:this._backpack,belt:this._belt,weapons:this._weaponIds,armor:this._armorId})},a.read=function(){var t=o.loadFromFile("avaliable_points");t&&(this.AvaliableAbilityPoints=t.ability||0),(t=o.loadFromFile("character_assets"))&&(this._money=t.ownMoney||0,this._backpack=t.backpack||[],this._belt=t.belt||[],this._weaponIds=t.weapons||["",""],this._armorId=t.armor||"")},a.reset=function(){this._hero.delData(),this.CombatParam.reset(),this._money=0,this.createHero("Hero")},a.createHero=function(t){this._hero=new i(t)},a.upgradeAdventureRank=function(t){this._hero.upgradeAdventureRank(t)},a.addMoney=function(t){this._money+=t},a.spendMoney=function(t){this._money-=t},a.raisePrestige=function(t){this._prestige+=t},a.tryLevelUp=function(){this._combat.curExp>=this._combat.maxExp&&(this._hero.levelUp(),this._combat.upgradeHP(2*this._hero.Level),this._combat.refillHP(),this._combat.resultExperience(),this._combat.upgradeExperiece(this._hero.Level),this._combat.write())},a.updateBackpack=function(t){this._backpack=t},a.getBackpack=function(){return this._backpack},a.updateBelt=function(t){this._belt=t.filter((function(t){return"0"!==t.value}))},a.getBelt=function(){return this._belt},a.setWeaponIds=function(t,e){this._weaponIds=[t||this._weaponIds[0],e||this._weaponIds[1]]},a.getWeaponIds=function(){return this._weaponIds},a.removeWeaponId=function(t){var e=this;this._weaponIds.find((function(a,i){return a===t&&(e._weaponIds[i]="",!0)}))},a.refreshWeaponEffectIds=function(){this._weaponEffectIds=this._weaponIds.map((function(t){return""===t?"":s.instance.database.weaponDatabase.find((function(e){return e.id===t})).damage_type})),console.log("this._weaponEffectIds:",this._weaponEffectIds)},a.getWeaponEffectIds=function(){return this._weaponEffectIds},a.setArmorId=function(t){this._armorId=t},a.getArmorId=function(){return this._armorId},a.refreshArmorClass=function(){var t=this,e=s.instance.database.armorDatabase.find((function(e){return e.id===t._armorId}));if(e){var a=parseInt(e.dex,10),i=parseInt(e.ac,10);i+=Math.min(a,this._hero.abilityScore.dexterity),s.instance.CharacterRaidData.CombatParam.updagteArmorClass(i)}else s.instance.CharacterRaidData.CombatParam.updagteArmorClass()},e(t,[{key:"Prestige",get:function(){return this._prestige}},{key:"Money",get:function(){return this._money}},{key:"Hero",get:function(){return this._hero}},{key:"AbilityScore",get:function(){return this._hero.abilityScore}},{key:"AdventureSkillRank",get:function(){return this._hero.adventureSkillRank}},{key:"Passive",get:function(){return this._hero.passive}},{key:"CombatParam",get:function(){return this._combat||(this._combat=new n),this._combat}},{key:"AvaliableAbilityPoints",get:function(){return this._avaliableAbilityPoints},set:function(t){this._avaliableAbilityPoints=t,r.instance.updateNotificationCount("AbilityBadge",t)}}]),t}());a._RF.pop()}}}));

System.register("chunks:///_virtual/CheckBoxComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,c,n,o,r,s,a,h;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,c=e.initializerDefineProperty,n=e.assertThisInitialized,o=e.createClass},function(e){r=e.cclegacy,s=e._decorator,a=e.Node,h=e.Component}],execute:function(){var u,k,l,p,d,C;r._RF.push({},"9182cS2L5BPUIFExtxBBEUL","CheckBoxComponent",void 0);var f=s.ccclass,m=s.property;e("CheckBoxComponent",(u=f("CheckBoxComponent"),k=m(a),u((d=i((p=function(e){function i(){for(var i,t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return i=e.call.apply(e,[this].concat(o))||this,c(i,"checkmark",d,n(i)),c(i,"isRadio",C,n(i)),i._isChecked=!1,i}t(i,e);var r=i.prototype;return r.onLoad=function(){this.checkmark.active=this._isChecked},r.check=function(){this._isChecked=!0,this.checkmark.active=!0},r.cancel=function(){this._isChecked=!1,this.checkmark.active=!1},r.onClicked=function(){this.isRadio&&!this._isChecked&&this.node.parent.getComponentsInChildren(i).forEach((function(e){return e.cancel()})),this._isChecked=!this._isChecked,this.checkmark.active=this._isChecked},o(i,[{key:"isChecked",get:function(){return this._isChecked}}]),i}(h)).prototype,"checkmark",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(p.prototype,"isRadio",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l=p))||l));r._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCard.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./CombatEffectManager.ts"],(function(e){var t,n,a,i;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy},function(e){a=e.GameManager},function(e){i=e.CombatEffectManager}],execute:function(){n._RF.push({},"7ca924FaMxPpJUAkJlPtpzg","CombatCard",void 0);e("CombatCard",function(){var e=n.prototype;function n(e,t,n){this._data=null,this._effects=[],this._evolutions=[],this._feeType=void 0,this._fee=void 0,this._consumable=void 0,this._range=void 0,e?(this._data=e,this._feeType=e.feeType,this._fee=e.fee,this._range=e.range,this._effects=t,this._consumable=n):console.error("CombatCardData is null")}return e.tryEvolutions=function(e){var t=this;this._evolutions.length=0;var n=a.instance.database.combatEffectDatabase,s=!1;return this._data.evolutions.forEach((function(o){var r=o.conditions.split(" ").every((function(t){return e.includes(t)}));if(r){console.log("觸發條件："+o.name,o.conditions),a.instance.characterCombatData.triggerCombo(o.name,o.conditions.split(" "));var f=n.find((function(e){return e.effectId===o.effectId}));t._evolutions.push({name:o.name,feeType:o.feeType,fee:parseInt(o.fee,10),range:o.range,effect:i.instance.getCombatEffect(f)}),s=!0}return r})),s},e.changeFee=function(e,t){this._feeType=e,this._fee=t},e.changeRange=function(e){this._range=e},e.reset=function(){this._evolutions.length=0,this._feeType=this._data.feeType,this._fee=this._data.fee,this._range=this._data.range},t(n,[{key:"Id",get:function(){return this._data.cardId}},{key:"Name",get:function(){return this._data.cardName}},{key:"Effects",get:function(){return this._effects}},{key:"Evolutions",get:function(){return this._evolutions}},{key:"Description",get:function(){return this._data.getDescription("\n")}},{key:"FeeType",get:function(){return this._feeType}},{key:"Fee",get:function(){return this._fee}},{key:"Consumable",get:function(){return this._consumable}},{key:"Range",get:function(){return this._range}},{key:"NeedTarget",get:function(){return"None"!=this.Range&&"reaction"!=this._feeType}}]),n}());n._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCardComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,a,n,i,r,o,l,f,c,u,s;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,r=e.createClass},function(e){o=e.cclegacy,l=e._decorator,f=e.Label,c=e.Sprite,u=e.Color,s=e.Component}],execute:function(){var b,m,p,d,h,C,g,y,v,L,T,V,F;o._RF.push({},"7a72cWn7flKx465/nIaH80W","CombatCardComponent",void 0);var E=l.ccclass,S=l.property;e("CombatCardComponent",(b=E("CombatCardComponent"),m=S(f),p=S(f),d=S(f),h=S(f),C=S(f),b((v=t((y=function(e){function t(){for(var t,a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,n(t,"nameLabel",v,i(t)),n(t,"feeLabel",L,i(t)),n(t,"mainValueLabel",T,i(t)),n(t,"secondaryValueLabel",V,i(t)),n(t,"effectsLabel",F,i(t)),t._combatCard=null,t}a(t,e);var o=t.prototype;return o.setup=function(e){this._combatCard=e,this.nameLabel.string=e.Name,this.updateFee(e);var t=0,a=[];this.CombatCard.Effects.forEach((function(e){"damage"===e.effectType&&(t+=e.value),a.push(e.effectName)})),this.mainValueLabel.string=t?t.toString():"",this.effectsLabel.string=a.join("\n"),this.updateEffects()},o.updateEffects=function(){var e=this,t=0,a=0,n=0,i=0,r=[],o=[];this.CombatCard.Effects.forEach((function(e){var l;"damage"===e.effectType?t+=e.value:"defense"===e.effectType?n+=e.value:"heal"===e.effectType?i+=e.value:(null==(l=e.diceInfo)?void 0:l.indexOf("d"))>-1&&(r.push(e.diceInfo),a=e.value),o.push(e.effectName)})),this.CombatCard.Evolutions.forEach((function(l){"damage"===l.effect.effectType?t+=l.effect.value:"defense"===l.effect.effectType?n+=l.effect.value:"heal"===l.effect.effectType?i+=l.effect.value:l.effect.diceInfo.indexOf("d")>-1&&(r.push(l.effect.diceInfo),a=l.effect.value),o.includes(l.effect.effectName)||o.push(l.effect.effectName),e.CombatCard.changeFee(l.feeType,l.fee),e.CombatCard.changeRange(l.range)})),this.effectsLabel.string=o.join("\n"),this.mainValueLabel.string="",this.secondaryValueLabel.string="",t>0?this.mainValueLabel.string=t.toString():a>0?(this.mainValueLabel.string=a.toString(),this.secondaryValueLabel.string=r.join("\n")):n>0?this.mainValueLabel.string=n.toString():i>0&&(this.mainValueLabel.string=i.toString()),this.updateFee(this.CombatCard)},o.updateFee=function(e){var t="";"action"===e.FeeType?t="動作":"reaction"===e.FeeType?t="反應":"bonus"===e.FeeType&&(t="備戰"),this.feeLabel.string=t?e.Fee+"\t\t\t\t\t\t"+t:e.Fee.toString()},o.isConsumable=function(){var e;return(null==(e=this.CombatCard)?void 0:e.Consumable)||!1},o.onNormalStatus=function(){this.isConsumable()?this.getComponent(c).color=new u(255,255,0):this.getComponent(c).color=new u(0,255,0)},o.onPlayedCardStatus=function(){this.isConsumable()||(this.getComponent(c).color=new u(0,255,255))},r(t,[{key:"Name",get:function(){var e;return null==(e=this._combatCard)?void 0:e.Name}},{key:"CombatCard",get:function(){return this._combatCard}},{key:"Effects",get:function(){var e;return null==(e=this._combatCard)?void 0:e.Effects}}]),t}(s)).prototype,"nameLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(y.prototype,"feeLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(y.prototype,"mainValueLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(y.prototype,"secondaryValueLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(y.prototype,"effectsLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=y))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCardData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"6281cLfjNxAfZ27Gtcn5Q+M","CombatCardData",void 0);t("CombatCardData",function(){function t(t,e,i,n,r,o,s,c){this._cardId=void 0,this._cardName=void 0,this._combatEffects=[],this._range=void 0,this._evolutions=[],this._description=[],this._feeType=void 0,this._fee=void 0,this._cardId=t,this._cardName=e,this._range=i,this._feeType=n,this._fee=r,this._combatEffects=o,this._evolutions=s,this._description=c}return t.prototype.getDescription=function(t){return this._description.join(t)},t.fromCSV=function(e){var i=parseInt(e.fee,10);return new t(e.id,e.name,e.range,e.feeType,i,e.effects,e.evolutions,e.description)},e(t,[{key:"cardId",get:function(){return this._cardId}},{key:"cardName",get:function(){return this._cardName}},{key:"combatEffects",get:function(){return this._combatEffects}},{key:"range",get:function(){return this._range}},{key:"evolutions",get:function(){return this._evolutions}},{key:"feeType",get:function(){return this._feeType}},{key:"fee",get:function(){return this._fee}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatCardManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CombatCardComponent.ts","./CardMover.ts","./HandCards.ts"],(function(e){var n,t,i,r,o,a,s,c,l,d,h,u,p,f,C,v,w,m,g,y,P,b;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime,s=e.createClass},function(e){c=e.cclegacy,l=e._decorator,d=e.Node,h=e.ScrollView,u=e.EventHandler,p=e.instantiate,f=e.Label,C=e.Vec3,v=e.Component,w=e.v3,m=e.Sprite,g=e.Color},function(e){y=e.CombatCardComponent},function(e){P=e.CardMover},function(e){b=e.HandCards}],execute:function(){var I,k,E,S,_,V,x,L,D,O,z,M,R,T,Z,H,B,N,F,j,A,G;c._RF.push({},"e3c4eMhBghL4LVTn4lhrJcB","CombatCardManager",void 0);var J=l.ccclass,q=l.property;e("CombatCardManager",(I=J("CombatCardManager"),k=q(d),E=q(d),S=q(d),_=q(d),V=q(d),x=q(b),L=q(h),D=q(u),O=q(u),I(((G=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,i(n,"cardPrefab",R,r(n)),i(n,"deckIcon",T,r(n)),i(n,"drawIcon",Z,r(n)),i(n,"playedIcon",H,r(n)),i(n,"consumedIcon",B,r(n)),i(n,"handCards",N,r(n)),i(n,"cardsScrollView",F,r(n)),i(n,"playCardEvent",j,r(n)),i(n,"playedCardEvent",A,r(n)),n.deck=[],n.hand=[],n.playedPile=[],n.consumedPile=[],n.drawPile=[],n._prviewIcon=null,n._prviewPile=[],n}t(n,e);var c=n.prototype;return c.onLoad=function(){n._instance?this.destroy():n._instance=this},c.sample=function(){for(var e=[],n=0;n<15;n++){var t=p(this.cardPrefab);t.parent=this.cardPrefab.parent,t.active=!0,e.push(t),t.getComponent(y).nameLabel.string="card"+(n+1)}this.addCardsToDeck(e),this.shuffleDeck()},c.clear=function(){console.log("this.deck:",this.deck),this.deck.forEach((function(e){return e.isValid&&e.destroy()})),console.log("this.drawPile:",this.drawPile),this.drawPile.forEach((function(e){return e.isValid&&e.destroy()})),console.log("this.playedPile:",this.playedPile.length,this.playedPile),this.playedPile.forEach((function(e){return e.isValid&&e.destroy()})),console.log("this.consumedPile:",this.consumedPile.length,this.consumedPile),this.consumedPile.forEach((function(e){return e.isValid&&e.destroy()})),this.deck.length=0,this.hand.length=0,this.drawPile.length=0,this.playedPile.length=0,this.consumedPile.length=0,this.deckIcon.getComponentInChildren(f).string="0",this.drawIcon.getComponentInChildren(f).string="0",this.playedIcon.getComponentInChildren(f).string="0",this.consumedIcon.getComponentInChildren(f).string="0"},c.hide=function(e){this.scheduleOnce((function(){e.forEach((function(e){e.active=!1}))}),.6)},c.remove=function(e){e.forEach((function(e){e.destroy()}))},c.addCardsToDeck=function(e){var n,t=this;(n=this.deck).push.apply(n,e),e.forEach((function(e){P.moveCard(e,t.deckIcon,C.ZERO,.2);var n=e.getComponent(y),i=p(e);i.parent=t.drawIcon,i.active=!1,i.getComponent(y).setup(n.CombatCard),t.drawPile.push(i)})),this.hide(e)},c.unshiftCardsToDraw=function(e){var n,t=this;(n=this.drawPile).unshift.apply(n,e),e.forEach((function(e){P.moveCard(e,t.drawIcon,C.ZERO,.2)}))},c.shuffleDeck=function(){for(var e=this.drawPile.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),t=[this.drawPile[n],this.drawPile[e]];this.drawPile[e]=t[0],this.drawPile[n]=t[1]}console.log("this.drawPile;",this.drawPile)},c.drawCards=function(){var e=o(a().mark((function e(n){var t,i,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[];n>0&&this.drawPile.length>0;)(r=this.drawPile.shift()).getComponent(y).onNormalStatus(),i.push(r),n--;if((t=this.hand).push.apply(t,i),!(n>0)){e.next=9;break}return e.next=6,this.recyclePlayedCards();case 6:return this.shuffleDeck(),0===this.drawPile.length&&(n=0,console.log("牌堆與抽牌堆的牌都抽完了，只能結束")),e.abrupt("return",this.drawCards(n));case 9:return this.handCards.drawCard(this.hand),this.drawIcon.getComponentInChildren(f).string=this.drawPile.length.toString(),e.abrupt("return",this.hand);case 12:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}(),c.previewCard=function(e,n,t,i,r,s){var c=this;void 0===n&&(n=1),void 0===t&&(t=0),void 0===i&&(i=1),void 0===r&&(r=null),void 0===s&&(s=null),console.log("展示",e),this.scheduleOnce(o(a().mark((function o(){return a().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e.isValid){o.next=3;break}return console.log("卡牌已被移除"),o.abrupt("return");case 3:if(e.scale=w(n,n,1),e.getComponent(y).onPlayedCardStatus(),!r||!s){o.next=10;break}return o.next=8,P.moveCard(e,c.node,s,n,i-t);case 8:o.next=12;break;case 10:return o.next=12,P.moveCard(e,c.node,w(0,150,0),n,i-t);case 12:case"end":return o.stop()}}),o)}))),t)},c.discardCards=function(e){var n=this;e.forEach((function(e){var t=n.hand.indexOf(e);if(t<0&&t>=n.hand.length)console.log("卡牌不存在或超出手牌範圍",t);else{console.log("棄牌",t),n.handCards.discardCard(e),n.handCards.tipLabel.string="棄牌";n.previewCard(e,1.5,0,.8),n.hand.splice(t,1),n.isConsumable(e)?(n.consumedPile.push(e),n.displayCard(e,n.consumedIcon,n.consumedPile.length,.8)):(n.playedPile.push(e),n.displayCard(e,n.playedIcon,n.playedPile.length,.8))}}))},c.playCard=function(e){var n=this.hand.indexOf(e);if(n<0||n>=this.hand.length)console.log("卡牌不存在或超出手牌範圍",n);else{console.log("出牌",n),this.handCards.playCard();this.previewCard(e,1.5,0,.8),this.hand.splice(n,1),this.isConsumable(e)?(this.consumedPile.push(e),this.displayCard(e,this.consumedIcon,this.consumedPile.length,.8)):(this.playedPile.push(e),this.displayCard(e,this.playedIcon,this.playedPile.length,.8))}},c.consumeCard=function(e){this.previewCard(e,1.5,0,.8),this.consumedPile.push(e),this.displayCard(e,this.consumedIcon,this.consumedPile.length,.8)},c.isConsumable=function(e){var n;return(null==(n=e.getComponent(y))?void 0:n.isConsumable())||!1},c.recyclePlayedCards=function(){var e=o(a().mark((function e(){var n,t=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=this.drawPile).push.apply(n,this.playedPile),this.drawIcon.getComponentInChildren(f).string=this.drawPile.length.toString(),this.playedPile.forEach((function(e){e.getComponent(m).color=new g(255,255,255,255),P.moveCard(e,t.drawIcon,C.ZERO,.2)})),e.next=5,this.delaySeconds(.5);case 5:this.playedPile.length=0,this.playedIcon.getComponentInChildren(f).string="0";case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.showDeckList=function(e){void 0===e&&(e=!0),this._prviewIcon=this.deckIcon,this._prviewPile=this.deck,this.showScrollview(e)},c.showDrawList=function(e){void 0===e&&(e=!0),this._prviewIcon=this.drawIcon,this._prviewPile=this.drawPile,this.showScrollview(e)},c.showPlayedList=function(e){void 0===e&&(e=!0),this._prviewIcon=this.playedIcon,this._prviewPile=this.playedPile,this.showScrollview(e)},c.showConsumedList=function(e){void 0===e&&(e=!0),this._prviewIcon=this.consumedIcon,this._prviewPile=this.consumedPile,this.showScrollview(e)},c.showScrollview=function(e){void 0===e&&(e=!0);for(var n=this._prviewIcon,t=this._prviewPile,i=this.cardsScrollView.content.children,r=i.length;r<t.length;r++){var o=p(i[0]);o.parent=this.cardsScrollView.content,o.active=!0}this.cardsScrollView.node.active=e,e?i.forEach((function(e,n){var i=t[n];i?(i.active=e.active=!0,P.moveCard(i,e,C.ZERO,1)):e.active=!1})):(i.forEach((function(e,i){var r=t[i];r?(r.active=e.active=!0,P.moveCard(r,n,C.ZERO,.2)):e.active=!1})),this.hide(t))},c.displayCard=function(e,n,t,i){var r=this;void 0===i&&(i=0),this.scheduleOnce(o(a().mark((function i(){var o;return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e.isValid){i.next=3;break}return console.log("卡牌已被移除"),i.abrupt("return");case 3:return o=e.getComponent(y),r.playCardEvent.forEach((function(e){return e.emit([o.CombatCard])})),i.next=7,P.moveCard(e,n,C.ZERO,.2,.25);case 7:e.active=!1,e.scale=C.ONE,r.handCards.tipLabel.string="",r.playedCardEvent.forEach((function(e){return e.emit([o])})),n.getComponentInChildren(f).string=t.toString();case 12:case"end":return i.stop()}}),i)}))),i)},c.delaySeconds=function(e){var n=this;return new Promise((function(t){return n.scheduleOnce((function(){return t()}),e)}))},c.onDeckIconClick=function(){this.showDeckList(!this.cardsScrollView.node.active)},c.onDrawIconClick=function(){this.showDrawList(!this.cardsScrollView.node.active)},c.onPlayedIconClick=function(){this.showPlayedList(!this.cardsScrollView.node.active)},c.onConsumedIconClick=function(){this.showConsumedList(!this.cardsScrollView.node.active)},c.onClosePrivewClick=function(){this.showScrollview(!1)},s(n,null,[{key:"instance",get:function(){return this._instance}}]),n}(v))._instance=null,R=n((M=G).prototype,"cardPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(M.prototype,"deckIcon",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=n(M.prototype,"drawIcon",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=n(M.prototype,"playedIcon",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(M.prototype,"consumedIcon",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(M.prototype,"handCards",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(M.prototype,"cardsScrollView",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=n(M.prototype,"playCardEvent",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A=n(M.prototype,"playedCardEvent",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),z=M))||z));c._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEffect.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"afe14JRpy1EaoVaSRoNni5X","CombatEffect",void 0);t("CombatEffect",function(){function t(t,e,i,n,c,f,o){this._effectId=void 0,this._effectName=void 0,this._effectType=void 0,this._value=void 0,this._diceInfo="",this._dc=void 0,this._description=void 0,this.adjustmentValue=0,this._effectId=t,this._effectName=e,this._effectType=i,this._value=n,this._diceInfo=c,this._dc=f,this._description=o}return t.prototype.tooltop=function(){return this._description},e(t,[{key:"effectId",get:function(){return this._effectId}},{key:"effectName",get:function(){return this._effectName}},{key:"effectType",get:function(){return this._effectType}},{key:"value",get:function(){return this._value}},{key:"diceInfo",get:function(){return this._diceInfo}},{key:"dc",get:function(){return this._dc}},{key:"description",get:function(){return this._description}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEffectComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HitPointsBarComponent.ts","./ShakeAnimation.ts","./DodgeAnimation.ts","./DiceAnimation.ts","./DefenseAnimation.ts","./HideAnimation.ts","./StunAnimation.ts","./HitCheckAnimation.ts","./FloatingTextComponent.ts","./PixelImage.ts","./BiteAnimation.ts"],(function(t){var n,e,i,o,a,r,s,c,u,f,l,p,h,m,d,g,y,v,b,C,w,A,k,D,T,x,B,E;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.asyncToGenerator,r=t.regeneratorRuntime,s=t.createClass},function(t){c=t.cclegacy,u=t._decorator,f=t.Node,l=t.Label,p=t.randomRangeInt,h=t.tween,m=t.UIOpacity,d=t.Vec3,g=t.Component,y=t.instantiate},function(t){v=t.HitPointsBarComponent},function(t){b=t.default},function(t){C=t.DodgeAnimation},function(t){w=t.default},function(t){A=t.DefenseAnimation},function(t){k=t.HideAnimation},function(t){D=t.StunAnimation},function(t){T=t.HitCheckAnimation},function(t){x=t.FloatingTextComponent},function(t){B=t.PixelImage},function(t){E=t.BiteAnimation}],execute:function(){var P,H,S,_,z,N,O,I,L,F,M,R,V,U,j,q,G,X,J;c._RF.push({},"48a24wcO/NEgaUXiL0qFeIA","CombatEffectComponent",void 0);var K=u.ccclass,Q=u.property;t("CombatEffectComponent",(P=K("CombatEffectComponent"),H=Q(f),S=Q(f),_=Q(f),z=Q(v),N=Q(l),O=Q(f),I=Q(f),L=Q(x),P((R=n((M=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return n=t.call.apply(t,[this].concat(a))||this,i(n,"iconContainer",R,o(n)),i(n,"displayContainer",V,o(n)),i(n,"entity",U,o(n)),i(n,"hitPointsBar",j,o(n)),i(n,"NameLabel",q,o(n)),i(n,"dice",G,o(n)),i(n,"handCardTip",X,o(n)),i(n,"tip",J,o(n)),n._combatEffects=new Map,n._isDefenseBroken=!1,n}e(n,t);var c=n.prototype;return c.onLoad=function(){this.iconContainer.children.forEach((function(t){return t.active=!1}))},c.refreshHP=function(t,n){this.hitPointsBar.setHP(t,n)},c.showTip=function(t){this.tip.showText(t)},c.rollHitDice=function(t,n){var e=this;return void 0===t&&(t="normal"),new Promise(a(r().mark((function i(o){var a,s,c,u,f,l,h,m;return r().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=null==(a=e.dice)?void 0:a.getComponent(w)){i.next=8;break}if(!n){i.next=6;break}return console.log("不骰:",n),o(n),i.abrupt("return");case 6:return o("advantage"===t?Math.max(p(1,20),p(1,20)):"disadvantage"===t?Math.min(p(1,20),p(1,20)):p(1,20)),i.abrupt("return");case 8:for(c="",u=[],f=1;f<=20;f++)u.push(f);if("advantage"===t)for(c="優勢",l=11;l<=20;l++)u.push(l);else if("disadvantage"===t)for(c="劣勢",h=1;h<=10;h++)u.push(h);return s.setTipText(c),u.sort((function(){return Math.random()-.5})),i.next=16,s.starAnimation(1,u,n);case 16:m=i.sent,o(m);case 18:case"end":return i.stop()}}),i)}))))},c.rollHitCheck=function(){var t=a(r().mark((function t(n){var e;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.entity.getComponent(T),t.abrupt("return",new Promise(a(r().mark((function t(i){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=5;break}return e.stopAnimation(),t.next=4,e.startAnimation();case 4:20===n?e.setValue(n,2,"\n爆擊"):e.setValue(n,1.5);case 5:i();case 6:case"end":return t.stop()}}),t)})))));case 2:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),c.hitBonus=function(t,n,e){var i=this.entity.getComponent(T);i&&i.addBonus(t,n,e)},c.changeArmor=function(t,n){var e=this.entity.getComponent(A);e&&(t>0?e.increaseDefense(t,n):e.decreaseDefense(-t,n))},c.breakDefense=function(t){if(!this._isDefenseBroken){var n=this.entity.getComponent(A);n&&(n.defenseBroken(t),this.tip.showText("破防"),this._isDefenseBroken=!0)}},c.dodge=function(t){if(t){var n=this.entity.getComponent(C);n&&(n.stopAnimation(),n.startAnimation(),this.tip.showText("閃避"))}else this.tip.showText("閃避失敗")},c.hiding=function(t){void 0===t&&(t=!0);var n=this.entity.getComponent(k);n&&(n.stopAnimation(),t?(n.startAnimation(),this.tip.showText("隱匿中")):this.tip.showText("解除隱匿"))},c.stun=function(t){void 0===t&&(t=!0);var n=this.entity.getComponent(D);n&&(t?(n.startAnimation(),this.tip.showText("暈眩")):(n.stopAnimation(),this.tip.showText("解除眩暈")))},c.bite=function(){var t=this.entity.getComponent(E);t&&t.startAnimation()},c.death=function(){var t=this;h(this.entity.getComponent(m)).to(.5,{opacity:0},{easing:"cubicOut"}).call((function(){t.entity.getComponent(B).clearSpriteFrame(),t.node.destroy()})).start(),this.tip.showText("死亡")},c.onTurnEnd=function(){var t=this.entity.getComponent(T);t&&t.hide()},c.handCount=function(t){var n=this;return new Promise((function(e){var i=n.handCardTip.children,o=i.filter((function(t){return t.active})).length,a=t-o,r=[];if(a>0)for(var s=function(t){if((u=i[t])||((u=y(i[0])).parent=n.handCardTip),u.active=!0,t>=o-a){var s=32*t;u.position=new d(s,-30,0),r.push(h(u).delay(.1*t).to(.2,{position:new d(s,0,0)},{easing:"cubicOut"}).call((function(){t===o-1&&e()}))),u.getComponent(m).opacity=0,r.push(h(u.getComponent(m)).delay(.1*t).to(.2,{opacity:255},{easing:"cubicOut"}))}},c=0;c<t;c++){var u;s(c)}else a<0?n.handCardTip.children.forEach((function(t,n){if(n>=o+a){var i=32*n;t.position=new d(i,0,0),r.push(h(t).delay(.1*n).to(.2,{position:new d(i,30,0)},{easing:"cubicOut"}).call((function(){t.active=!1,n===o-1&&e()})))}})):r.push(h(n.node).call((function(){return e()})));n.scheduleOnce((function(){r.forEach((function(t){return t.start()}))}),.1)}))},c.setEffectStatus=function(t){var n=this._combatEffects.get(t.effectType);n||(n={name:t.effectName,stack:0},this._combatEffects.set(t.effectType,n)),this.updateStatusDisplay(t.effectType,t.value)},c.updateStatusDisplay=function(t,n){var e=this,i=this._combatEffects.get(t);if(console.log(t,i),i){var o=this.iconContainer.getChildByName(t);if(o){o.active=!0;var a=o.parent,r=o.getComponentInChildren(l);r.string=i.stack.toString(),h(o).delay(0).call((function(){return o.parent=e.displayContainer})).to(.1,{scale:new d(1.5,1.5)},{easing:"cubicOut"}).call((function(){i.stack+=n,r.string=i.name+"\n"+i.stack,console.log(i.name,"數值變化",n)})).to(.25,{scale:d.ONE},{easing:"cubicIn"}).call((function(){o.parent=a,i.stack<=0&&e.removeStatusDisplay(t)})).start()}}},c.removeStatusDisplay=function(t){var n=this.iconContainer.getChildByName(t);n&&(n.active=!1),this._combatEffects.delete(t)},c.removeAllStatusDisplay=function(){var t=this;this._combatEffects.forEach((function(n,e){t.removeStatusDisplay(e)}))},s(n,[{key:"Name",set:function(t){this.NameLabel.string=t}},{key:"Image",set:function(t){var n=this.entity.getComponent(B);n&&n.setSpriteFrame(t)}},{key:"HP",set:function(t){this.hitPointsBar.defaultHp=t}},{key:"Damage",set:function(t){this.hitPointsBar.changeHp(-t);var n=this.entity.getComponent(b);n&&(n.stopAnimation(),n.startAnimation(),this.scheduleOnce((function(){return n.stopAnimation()}),.5))}},{key:"Heal",set:function(t){this.hitPointsBar.changeHp(t)}},{key:"Defense",set:function(t){this._isDefenseBroken=!1;var n=this.entity.getComponent(A);n&&n.buildDefense(t)}}]),n}(g)).prototype,"iconContainer",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(M.prototype,"displayContainer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=n(M.prototype,"entity",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=n(M.prototype,"hitPointsBar",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=n(M.prototype,"NameLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=n(M.prototype,"dice",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=n(M.prototype,"handCardTip",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=n(M.prototype,"tip",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=M))||F));c._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEffectData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,f;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy,f=t.randomRangeInt}],execute:function(){i._RF.push({},"c34e5IgS79CdJxWRMmgBF7i","CombatEffectData",void 0);t("CombatEffectData",function(){function t(t,e,i,f,u,s){this._effectId=void 0,this._effectName=void 0,this._effectType=void 0,this._value=void 0,this._difficultyAttribute=void 0,this._difficultClass=void 0,this._description=void 0,this._effectId=t,this._effectName=e,this._effectType=i,this._value=f;var c=u.split("_");c.length<2?(this._difficultyAttribute="",this._difficultClass=0):(this._difficultyAttribute=c[0],this._difficultClass=Number(c[1])),this._description=s}return t.prototype.getEffectValue=function(){var t=0;if(this._value.indexOf("d")>-1){var e=this._value.split("d"),i=Number(e[0]),u=Number(e[1]);t=i*f(1,u)}else t=this._value?Number(this._value):0;return t},t.fromCSV=function(e){return new t(e.id,e.name,e.type,e.value,e.dc,e.description)},e(t,[{key:"effectId",get:function(){return this._effectId}},{key:"effectName",get:function(){return this._effectName}},{key:"effectType",get:function(){return this._effectType}},{key:"value",get:function(){return this._value}},{key:"dc",get:function(){return""===this._difficultyAttribute||0===this._difficultClass?null:{attribute:this._difficultyAttribute,class:this._difficultClass}}},{key:"description",get:function(){return this._description}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/CombatEffectManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RandomString.ts","./CombatEffect.ts","./CombatUnit.ts"],(function(t){var n,e,i,s,o,r,a,u,c,f,l;return{setters:[function(t){n=t.inheritsLoose,e=t.createClass,i=t.asyncToGenerator,s=t.regeneratorRuntime},function(t){o=t.cclegacy,r=t._decorator,a=t.randomRangeInt,u=t.Component},function(t){c=t.RandomString},function(t){f=t.CombatEffect},function(t){l=t.CombatUnit}],execute:function(){var h,v;o._RF.push({},"0999bVerhlP2bt4/tuii+28","CombatEffectManager",void 0);var d=r.ccclass;t("CombatEffectManager",d("CombatEffectManager")(((v=function(t){function o(){for(var n,e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return(n=t.call.apply(t,[this].concat(i))||this).units={},n}n(o,t);var r=o.prototype;return r.onLoad=function(){o._instance||(o._instance=this)},r.join=function(t,n,e,i,s,o,r,a,u){var f=c.generate();return this.units[f]=new l(t,n,e,i,s,o,r,a,u),f},r.quit=function(t){return this.units[t]?(this.units[t].status.death(),this.units[t].remove(),delete this.units[t],console.log("CombatUnit quit",t,this.units),!0):(console.warn("CombatUnit not found",t),!1)},r.getCombatEffect=function(t){return new f(t.effectId,t.effectName,t.effectType,t.getEffectValue(),t.value,t.dc,t.description)},r.hitRoll=function(){var t=i(s().mark((function t(n,e){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.units[n],t.next=3,i.hitRoll(e);case 3:case"end":return t.stop()}}),t,this)})));return function(n,e){return t.apply(this,arguments)}}(),r.onAttackAnimation=function(t,n){t.includes("bite")&&this.units[n].status.bite()},r.onCardPlayed=function(t,n,e){var i=this;void 0===e&&(e=[]);var s=this.units[n];if(s){var o=s.healthTest();t.forEach((function(t){o&&s.positive(t)}));var r=s.HitCheck,a=s.isRollDouble||s.isSkillDouble,u=s.isPenetrate;console.log("casterUnit.isRollDouble:",s.isRollDouble,"casterUnit.isSkillDouble:",s.isSkillDouble,"casterUnit.isPenetrate:",s.isPenetrate),o&&e.forEach((function(n){var e=i.units[n];e?(t.forEach((function(t){e.negative(t,r,a,u),e.Defense<=r&&e.status.breakDefense(e.Defense),"damage"!==t.effectType&&"cleave"!==t.effectType||(e.onSquelch(),e.onMind()),e.onRepel()})),e.squelch>0&&(s.damage+=e.squelch,e.squelch=0)):console.warn("CombatUnit not found",n)})),s.isPenetrate=!1,console.log("----caster----",this.units[n]),console.log("----receivers----",e.map((function(t){return i.units[t]}))),s.onBurning(),s.onPanic();var c=s.cleave;s.cleave=0,console.log("觸及傷害:",c),e.forEach((function(t){var n=i.units[t];n?(n.Defense<=r?n.damage+=c:(n.Defense-=c,n.status.Defense=n.Defense),n.executeDamage()?(s.isSkillDouble=!1,s.onCombatReflex(),n.isHurt=!0):(s.isCombatReflex=!1,n.isUnscathed=!0)):console.warn("CombatUnit not found",t)})),s.executeDamage()}},r.onBeginBattle=function(t,n){for(var e in this.units)if(this.units[e].reset(),t&&n){var i=a(t,n);this.hitRoll(e,i)}else this.hitRoll(e)},r.onEndBattle=function(){var t=this;Object.keys(this.units).forEach((function(n){var e=t.units[n];e.status.onTurnEnd(),e.remove()})),this.units={}},r.onTurnBegin=function(t,n){var e=this;void 0===n&&(n=[]),console.log("onTurnBegin",t,n);var i=this.units[t];i.reset(),i.onInaccurate();var s=i.HitCheck;n.forEach((function(n){if(n!=t){var i=e.units[n];i.Defense<=s?i.status.breakDefense(i.Defense):i.status.Defense=i.Defense}})),i.onFear()},r.onTurnEnd=function(t){this.units[t].status.onTurnEnd()},r.onRoundBegin=function(t,n){for(var e in console.log("onRoundBegin"),this.units){var i=this.units[e];if(t&&n){var s=a(t,n);i.hitRoll(s)}else i.hitRoll()}},r.onRoundEnd=function(){for(var t in this.units){var n=this.units[t];n.onBleed(),n.executeDamage(),n.resetDraw()}},r.intentionHandsTip=function(t,n){return this.units[t].status.handCount(n)},r.takeDiscardCount=function(t){var n=this.units[t],e=n.discardCount;return n.discardCount=0,e},r.getDrawCount=function(t){return this.units[t].draw},r.getCountdown=function(t){return this.units[t].cuntdown},r.getEnergy=function(t){return Object.values(this.units[t].energy).map((function(t,n){return["行動","反應","備戰"][n]+": "+t})).join("\n")},r.getExtraDraw=function(t){var n=this,e={};return Object.keys(this.units[t].extraDraw).forEach((function(i){var s=n.units[t].extraDraw[i];s&&(e[i]=s)})),e},r.tryExtraDraw=function(t,n){if(null==this.units[t].extraDraw[n])return!1;var e=this.units[t].extraDraw[n]>0;return this.units[t].extraDraw[n]=0,e},r.tryCostFee=function(t,n){var e=this.units[t],i=n.FeeType,s=n.Fee;if(0===s)return!0;if(void 0===e.energy[i])return console.error("無此類別能量:",i),!1;if(e.energy[i]<s){var o="";switch(i){case"action":o="行動";break;case"reaction":o="反應";break;case"bonus":o="備戰";break;default:return console.error("無此類別能量:",i),!1}return this.units[t].status.showTip(o+"\n點數不足"),!1}return e.energy[i]-=s,!0},r.isStun=function(t){var n=this.units[t];return n?(n.isStuned&&n.onStun(),this.units[t].isStuned):(console.warn("CombatUnit not found",t),!0)},r.isAlive=function(t){return this.units[t].HP>0},e(o,null,[{key:"instance",get:function(){return this._instance}}]),o}(u))._instance=null,h=v))||h);o._RF.pop()}}}));

System.register("chunks:///_virtual/CombatTeachTool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(t){var n,e,o,i,a,s,h,c,l,r,d,u;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,a=t.createClass},function(t){s=t.cclegacy,h=t._decorator,c=t.Label,l=t.tween,r=t.v3,d=t.Component},function(t){u=t.GameManager}],execute:function(){var C,g,f,_,v;s._RF.push({},"cc7dcHuVfxFGbS24BB5iNk2","CombatTeachTool",void 0);var B=h.ccclass,b=h.property;t("CombatTeachTool",(C=B("CombatTeachTool"),g=b(c),C((v=n((_=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a))||this,o(n,"conversationLabel",v,i(n)),n._teachConversation=null,n._conversationList=[],n._battleEndCallback=null,n._teachBattleEndContent=[],n._teachBattleEscapeContent=[],n._teachUnderdamageContent=[],n._teachRoundBeginContent=[],n._teachUnderattackContent=[],n._conversationId="",n}e(n,t);var s=n.prototype;return s.onLoad=function(){this.node.on("teachBegin",this.onTeachBegin,this)},s.onDestroy=function(){this.node.off("teachBegin",this.onTeachBegin,this),this.removeListeners()},s.clear=function(){this._teachRoundBeginContent.length=0,this._teachUnderdamageContent.length=0,this._teachUnderattackContent.length=0,this._teachBattleEscapeContent.length=0,this._teachBattleEndContent.length=0},s.onTeachBegin=function(t){var n=t.detail.id;this._teachConversation=u.instance.database.teachConversationDatabase.find((function(t){return t.id===n})),this._teachConversation&&(this._conversationId=n,this._teachRoundBeginContent=this._teachConversation.roundBeginContent.flat(),this._teachUnderdamageContent=this._teachConversation.underdamageContent.flat(),this._teachUnderattackContent=this._teachConversation.underattackContent.flat(),this._teachBattleEscapeContent=this._teachConversation.battleEscapeContent.flat(),this._teachBattleEndContent=this._teachConversation.battleEndContent.flat(),this._teachConversation.battleBeginContent.length>0&&(this._conversationList=this._teachConversation.battleBeginContent.flat(),this.onConversationClicked()),this.setTutorialsEnabled(t.detail.enabled))},s.setTutorialsEnabled=function(t){void 0===t&&(t=!0),t?this.setupListeners():this.removeListeners()},s.setupListeners=function(){this.node.on("battleBegin",this.onBattleBegin,this),this.node.on("battleEnd",this.onBattleEnd,this),this.node.on("battleEscape",this.onBattleEscape,this),this.node.on("roundBegin",this.onRoundBegin,this),this.node.on("roundEnd",this.onRoundEnd,this),this.node.on("turnBegin",this.onTurnBegin,this),this.node.on("turnEnd",this.onTurnEnd,this),this.node.on("enemyAttacked",this.onEnemyAttacked,this),this.node.on("allyAttacked",this.onAllyAttacked,this)},s.removeListeners=function(){this.node.off("battleBegin",this.onBattleBegin,this),this.node.off("battleEnd",this.onBattleEnd,this),this.node.off("battleEscape",this.onBattleEscape,this),this.node.off("roundBegin",this.onRoundBegin,this),this.node.off("roundEnd",this.onRoundEnd,this),this.node.off("turnBegin",this.onTurnBegin,this),this.node.off("turnEnd",this.onTurnEnd,this),this.node.off("enemyAttacked",this.onEnemyAttacked,this),this.node.off("allyAttacked",this.onAllyAttacked,this)},s.onBattleBegin=function(t){console.log("Battle begins. Tutorial here.")},s.onBattleEnd=function(t){console.log("this._teachConversation:",this._teachConversation),this._teachConversation?this._teachBattleEndContent.length>0&&(this._battleEndCallback=t.detail.callback,this._conversationList=this._teachBattleEndContent,this.onConversationClicked()):t.detail.callback()},s.onBattleEscape=function(t){this._battleEndCallback=t.detail.callback,this._teachBattleEscapeContent.length>0&&(this._conversationList=this._teachBattleEscapeContent,this.onConversationClicked())},s.onRoundBegin=function(t){this._teachRoundBeginContent.length>0&&(this._conversationList=[this._teachRoundBeginContent.shift()],this.onConversationClicked())},s.onRoundEnd=function(t){console.log("Round ends. Tutorial here.")},s.onTurnBegin=function(t){console.log("Turn begins. Tutorial here.")},s.onTurnEnd=function(t){console.log("Turn ends. Tutorial here.")},s.onEnemyAttacked=function(t){t.detail.injured?this._teachUnderdamageContent.length>0&&(this._conversationList=[this._teachUnderdamageContent.shift()]):this._teachUnderattackContent.length>0&&(this._conversationList=[this._teachUnderattackContent.shift()]),this._conversationList.length>0&&this.onConversationClicked()},s.onAllyAttacked=function(t){t.detail.injured?console.log("Ally is attacked and injured. Tutorial here."):console.log("Ally is attacked but not injured. Tutorial here.")},s.onConversationClicked=function(){this.conversationLabel.node.parent.active=this._conversationList.length>0,this.conversationLabel.string=this._conversationList.shift(),this.conversationLabel.node.parent.active||this._battleEndCallback&&(this._battleEndCallback(),this._battleEndCallback=null,this.clear())},s.onBlockClicked=function(){l(this.conversationLabel.node).to(.15,{scale:r(1.1,1.1,1.1)}).to(.15,{scale:r(1,1,1)}).start()},a(n,[{key:"conversationId",get:function(){return this._conversationId}},{key:"BattleRoundMax",get:function(){var t;return(null==(t=this._teachConversation)?void 0:t.round)||999999}}]),n}(d)).prototype,"conversationLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=_))||f));s._RF.pop()}}}));

System.register("chunks:///_virtual/CombatUnit.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var s,e,i,a,c;return{setters:[function(t){s=t.createClass,e=t.asyncToGenerator,i=t.regeneratorRuntime},function(t){a=t.cclegacy,c=t.randomRangeInt}],execute:function(){a._RF.push({},"e24c4KJ1EJM8rW8CxG0wdKj","CombatUnit",void 0);t("CombatUnit",function(){function t(t,s,e,i,a,c,h,n,u){this.status=null,this._hitPoint=0,this._armorClass=0,this._defense=0,this.damage=0,this.squelch=0,this.draw=0,this.extraDraw={},this._handCount=0,this.discardCount=0,this.energy={},this._hitBonus=0,this.strength=0,this.dexterity=0,this.wisdom=0,this.resilience=0,this.cuntdown=0,this.isStuned=!1,this.isRollDouble=!1,this.isSkillDouble=!1,this.isHiding=!1,this.isCombatReflex=!1,this.isMindDodge=!1,this.isPenetrate=!1,this.isHurt=!1,this.isUnscathed=!1,this.cleave=0,this.posionDamage=0,this.hitStatus="normal",this._effectDC=[],this._effectAcc=[],this._castedCount=0,this._hitRoll=0,this._maxHP=0,this.status=t,this.status.Name=s,this.status.HP=this._maxHP=e[1],this._hitPoint=e[0],this._armorClass=i,this.draw=this._handCount=a,this.strength=c,this.dexterity=h,this.wisdom=n,this.resilience=u,this.status.refreshHP(e[0],e[1])}var a=t.prototype;return a.hitRoll=function(){var t=e(i().mark((function t(s){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._hitBonus=0,this.isRollDouble=!1,console.log("u預設值: defaultValue:",s),t.next=5,this.status.rollHitDice(this.hitStatus,s);case 5:return this._hitRoll=t.sent,20!==this._hitRoll&&30!==this._hitRoll||(this.isRollDouble=!0),t.next=9,this.status.rollHitCheck(this.HitCheck);case 9:this.hitStatus="normal";case 10:case"end":return t.stop()}}),t,this)})));return function(s){return t.apply(this,arguments)}}(),a.executeDamage=function(){var t;return this.posionDamage>0&&(this.damage+=this.posionDamage),this.damage>0&&(this._hitPoint-=this.damage,this.status.Damage=this.damage,this.damage=0,(null==(t=this._effectDC.hide)?void 0:t.stack)>0&&(this._effectDC.hide.stack=0,this.status.removeStatusDisplay("hide"),this.status.hiding(!1)),!0)},a.reset=function(){var t;this._defense=this._armorClass,this.status.Defense=this.Defense,this.isHurt=!1,this.isUnscathed=!1,this.isPenetrate=!1,this.isSkillDouble=!1,this._castedCount=0,this.energy={action:1,reaction:1,bonus:1},this.extraDraw={atk:0,def:0,ran:0,steal:0},(null==(t=this._effectDC.mind)?void 0:t.stack)>0&&(this._effectDC.mind.stack=0,this.status.removeStatusDisplay("mind"),this.isMindDodge=!1,this.status.showTip("解除\n心眼狀態")),this.onSquelch(),this.squelch=0},a.remove=function(){var t,s;(null==(t=this._effectDC.hide)?void 0:t.stack)>0&&this.status.hiding(!1),(null==(s=this._effectDC.stun)?void 0:s.stack)>0&&this.status.stun(!1),this.posionDamage=0,this.status.removeAllStatusDisplay(),this.status=null},a.resetDraw=function(){this.draw=this._handCount},a.onBleed=function(){var t="bleed";if(this._effectAcc.bleed){var s=this._effectAcc.bleed;s>0&&(this._effectAcc.bleed--,this._hitPoint-=s,this.status.Damage=s,this.status.updateStatusDisplay(t,-1),this.status.showTip("流血傷害"+s+"點"))}},a.onBurning=function(){var t="burning";if(this._effectAcc.burning){var s=this._effectAcc.burning;s>0&&(this._effectAcc.burning--,this._hitPoint-=s,this.status.Damage=s,this.status.updateStatusDisplay(t,-1),this.status.showTip("灼燒傷害"+s+"點"))}},a.onVigilant=function(){var t="vigilant";this._effectAcc.vigilant&&this._effectAcc.vigilant>0&&(this._effectAcc.vigilant--,this.status.updateStatusDisplay(t,-1),this.status.showTip("警戒"))},a.onInaccurate=function(){var t="inaccurate",s=this._effectAcc.inaccurate;s&&s>0&&(this._hitBonus-=s,this.status.hitBonus(-s,this.HitCheck),this._effectAcc.inaccurate=0,this.status.removeStatusDisplay(t),this.status.showTip("命中下降"+s))},a.onStun=function(){var t,s="stun";(null==(t=this._effectDC.stun)?void 0:t.stack)>0?(this._checkDifficultClass(s,0)?(console.log("韌性檢定成功，解除眩暈"),this._effectDC.stun.stack--,this.status.updateStatusDisplay(s,-1),this.isStuned=this._effectDC.stun.stack>0):this.isStuned=!0,this.status.stun(this.isStuned)):this.isStuned=!1},a.onFear=function(){var t,s="fear";(null==(t=this._effectDC.fear)?void 0:t.stack)>0&&(this._checkDifficultClass(s)?(this.status.showTip("解除恐懼"),this._effectDC.fear.stack=0,this.status.removeStatusDisplay(s),this.cuntdown=0):(console.log("恐懼效果持續"),this.status.showTip("恐懼"),this.cuntdown=6))},a.onPanic=function(){var t,s="panic";(null==(t=this._effectDC.panic)?void 0:t.stack)>0&&(this._checkDifficultClass(s)?(console.log("韌性檢定成功，解除慌亂"),this._effectDC.panic.stack=0,this.status.removeStatusDisplay(s)):(console.log("慌亂效果持續"),this.discardCount++,this.status.showTip("慌亂棄牌")))},a.onSquelch=function(){var t="squelch";this._effectAcc.squelch>0&&(this.squelch+=this._effectAcc.squelch,this._effectAcc.squelch=0,this.status.removeStatusDisplay(t))},a.onCombatReflex=function(){this.isCombatReflex&&(this.status.showTip("行動恢復"),this.energy.action=1)},a.onStolen=function(){var t="steal";this._effectAcc.steal>0&&(this.draw-=this._effectAcc.steal,this._effectAcc.steal=0,this.status.removeStatusDisplay(t))},a.onMind=function(){var t,s="mind";(null==(t=this._effectDC.mind)?void 0:t.stack)>0&&(this._checkDifficultClass(s,0)?this.isMindDodge=!1:(this.squelch+=this._effectDC.mind.stack,this.status.showTip("心眼反擊"),this.isMindDodge=!0))},a.onRepel=function(){var t,s="repel";(null==(t=this._effectDC.repel)?void 0:t.stack)>0&&(this._checkDifficultClass(s)?this.status.showTip("擊退抵抗"):(this.discardCount+=this._effectDC.repel.stack,this.status.showTip("擊退棄牌")),this._effectDC.repel.stack=0,this.status.removeStatusDisplay(s))},a.healthTest=function(){var t;if((null==(t=this._effectDC.paralysis)?void 0:t.stack)>0){if(!this._checkDifficultClass("paralysis"))return console.log("麻痺效果持續，攻擊失敗"),this.status.showTip("麻痺"),!1;console.log("韌性檢定成功，麻痺不影響出招"),this.status.showTip("延緩麻痺")}return!0},a.onPosion=function(){this._effectAcc.posion>0?(this.posionDamage++,this._hitPoint-=this.posionDamage):this.posionDamage=0},a.onResistance=function(){this._effectAcc.paralysisResistance&&this._effectDC.paralysis&&(this._effectDC.paralysis.stack-=this._effectAcc.paralysisResistance),this._effectAcc.coldResistance&&this._effectDC.frigid&&(this._effectDC.frigid.stack-=this._effectAcc.coldResistance),this._effectAcc.fireResistance&&this._effectDC.burning&&(this._effectDC.burning.stack-=this._effectAcc.fireResistance),this._effectAcc.toxinResistance&&this._effectDC.poison&&(this._effectDC.poison.stack-=this._effectAcc.toxinResistance)},a.attackAnimation=function(t){"bite"===t&&this.status.bite()},a.onEquiped=function(){this._effectAcc.Bludgeoning,this._effectAcc.Piercing,this._effectAcc.Slashing},a.equiped=function(t){var s=t.effectType;this._addEffectAcc(s,1),this.status.setEffectStatus(t)},a.positive=function(t){var s,e=t.effectType,i=t.value;switch(console.log("positive effect:",e,i),this._castedCount++,e){case"cleave":this.cleave=t.value;break;case"damage":this._effectAcc.internalInjury>0&&(this._effectAcc.internalInjury--,this.status.updateStatusDisplay("internalInjury",-1),console.log("內傷造成傷害減半"),t.adjustmentValue=-Math.floor(t.value/2)),(null==(s=this._effectDC.hide)?void 0:s.stack)>0&&(this._effectDC.hide.stack=0,this.status.removeStatusDisplay("hide"),this.status.hiding(!1));break;case"defense":var a=i;if(this._effectAcc.frigid>0){var c=Math.min(this._effectAcc.frigid,a);this._effectAcc.frigid-=c,this.status.updateStatusDisplay("frigid",-c),a=Math.round(a/2)}this.Defense+=a,this.status.changeArmor(a,this.Defense);break;case"attackQuickly":1===this._castedCount?t.adjustmentValue=t.value:t.adjustmentValue=1;break;case"detoxify":this._effectAcc.posion-=i,this.status.updateStatusDisplay("posion",-i),this._effectAcc.posion?this.status.showTip("毒素效果下降"):this.status.showTip("毒素效果消失");break;case"heal":this._hitPoint=Math.min(this._maxHP,this._hitPoint+i),console.log("補血:",this._hitPoint,"+",i),this.status.Heal=i;break;case"squelch":this._addEffectAcc(e,i),this.status.setEffectStatus(t);break;case"hit":this._hitBonus+=i,this.status.hitBonus(i,this.HitCheck),this.status.showTip("命中上升");break;case"tourniquet":this._addEffectAcc("bleed",-i),this.status.updateStatusDisplay("bleed",-i),this.status.showTip("止血");break;case"vigilant":this._addEffectAcc(e,i),this.status.setEffectStatus(t);break;case"drawAtkCard":this.extraDraw.atk+=i;break;case"drawDefCard":this.extraDraw.def+=i;break;case"drawRanCard":this.extraDraw.ran+=i;break;case"steal":this.extraDraw.steal+=i;break;case"restoreAct":this.energy.action+=i;break;case"combatReflex":this.isCombatReflex=!0,this.status.showTip("戰鬥反射");break;case"paralysisResistance":case"coldResistance":case"fireResistance":case"toxinResistance":this._addEffectAcc(e,i),this.status.setEffectStatus(t);break;case"dodge":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t);break;case"prejudgment":this._stackDifficultClass(t,!1),this.status.setEffectStatus(t);break;case"hide":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t),this.status.hiding();break;case"mind":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t),this.status.showTip("開啟心眼");break;case"penetrate":this.isPenetrate=!0,this.status.showTip("穿透攻擊");break;case"powerStrike":this.isSkillDouble=!0,this.status.showTip("蓄力");break;case"vow":var h=this.HitCheck;this._hitBonus/=2,this._hitRoll/=2,this.isRollDouble=!0;var n=this.HitCheck;this.status.hitBonus(-(h-n),n),this.status.showTip("宣示"),this.status.showTip("命中下降"+(h-n)),this.status.showTip("傷害雙倍")}},a.negative=function(t,s,e,i){var a,c,h,n,u,f,o;void 0===e&&(e=!1);var l=t.effectType,r=t.value+t.adjustmentValue;if(i?console.log("受到的攻擊皆會穿透",t.effectName,t.value):console.log("非穿透攻擊",t.effectName,t.value),(null==(a=this._effectDC.prejudgment)?void 0:a.stack)>0){if(this._checkDifficultClass("prejudgment"))return void this.status.showTip("預判攻擊");this.status.showTip("誤判攻擊")}if((null==(c=this._effectDC.hide)?void 0:c.stack)>0&&("damage"===l||"bleed"===l||"cleave"===l)){if(!this._checkDifficultClass("hide",0))return console.log("敵人未通過偵察檢定，隱匿免疫攻擊成功"),void this.status.hiding();console.log("受到攻擊，隱匿失敗"),this._effectDC.hide.stack=0,this.status.removeStatusDisplay("hide"),this.status.hiding(!1)}var d=this.isMindDodge;switch((null==(h=this._effectDC.dodge)?void 0:h.stack)>0&&(this._checkDifficultClass("dodge",0)?(console.log("閃避攻擊"),d=!0):console.log("閃避失敗")),console.log("negative effect:",l,r),l){case"cleave":case"damage":if(this.onVigilant(),(null==(n=this._effectDC.dodge)?void 0:n.stack)>0&&(this._effectDC.dodge.stack--,this.status.updateStatusDisplay("dodge",-1),this.status.dodge(d)),d)return;console.log("this.defense:",this.Defense,s,"isHitDouble:",e),this.Defense<=s||i?(e&&(console.log("this.爆擊:",this.isRollDouble),this.damage+=r,this.status.showTip("爆擊")),this.damage+=r):(this.Defense-=e?2*r:r,this.status.changeArmor(-r,this.Defense));break;case"attackQuickly":var _=t.adjustmentValue;this.Defense<=s||i?this.damage+=_:(this.Defense-=_,this.status.changeArmor(-r,this.Defense));break;case"detection":this._effectAcc.hide>0&&(this._effectAcc.hide=0,console.log("偵察效果解除隱匿"),this.status.removeStatusDisplay("hide"),this.status.hiding(!1),this.status.showTip("偵察識破"));break;case"bleed":if((null==(u=this._effectDC.dodge)?void 0:u.stack)>0&&(this._effectDC.dodge.stack--,this.status.updateStatusDisplay("dodge",-1),this.status.dodge(d)),d)return;this._addEffectAcc(l,r),this.status.setEffectStatus(t);break;case"internalInjury":if((null==(f=this._effectDC.dodge)?void 0:f.stack)>0&&(this._effectDC.dodge.stack--,this.status.updateStatusDisplay("dodge",-1),this.status.dodge(d)),d)return;this._addEffectAcc(l,r),this.status.setEffectStatus(t);break;case"burning":this._effectAcc.fireVulnerable?this._addEffectAcc(l,2*r):this._addEffectAcc(l,r),this.status.setEffectStatus(t);break;case"frigid":this._effectAcc.coldVulnerable?this._addEffectAcc(l,2*r):this._addEffectAcc(l,r),this.status.setEffectStatus(t);break;case"posion":this._effectAcc.toxinsVulnerable?this._addEffectAcc(l,2*r):this._addEffectAcc(l,r),this.status.setEffectStatus(t);break;case"coldVulnerable":case"fireVulnerable":case"toxinsVulnerable":case"inaccurate":this._addEffectAcc(l,r),this.status.setEffectStatus(t);break;case"disarm":this.discardCount+=r;break;case"panic":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t);break;case"laziness":this.draw=Math.max(this.draw-r,0),this.status.showTip("怠惰");break;case"stun":if((null==(o=this._effectDC.dodge)?void 0:o.stack)>0&&(this._effectDC.dodge.stack--,this.status.updateStatusDisplay("dodge",-1),this.status.dodge(d)),d)return void console.log("閃避暈眩攻擊");var D;if(this._stackDifficultClass(t,!0),this.status.setEffectStatus(t),this.isStuned||this.onStun(),this.isStuned)this.status.showTip("暈眩中"),(null==(D=this._effectDC.dodge)?void 0:D.stack)>0&&(this._effectDC.dodge.stack=0,this.status.removeStatusDisplay("dodge"),console.log("暈眩中，解除掉閃避效果"),this.status.showTip("失去閃避"));break;case"fear":case"paralysis":case"repel":this._stackDifficultClass(t,!0),this.status.setEffectStatus(t)}},a._addEffectAcc=function(t,s){this._effectAcc[t]||(this._effectAcc[t]=0),this._effectAcc[t]+=s},a._stackDifficultClass=function(t,s){var e=t.effectType,i=t.dc,a=t.value,c=this._effectDC[e];c||(this._effectDC[e]=c={attriube:i.attribute,class:0,stack:0}),0===c.stack?c.class=i.class:c.class=s?Math.max(c.class,i.class):Math.min(c.class,i.class),c.stack+=a,console.log("檢定attribute:",i.attribute,this[i.attribute])},a._checkDifficultClass=function(t,s){void 0===s&&(s=1);var e=this._effectDC[t];if(console.log("檢定effectDc:",e),!e)return!1;console.log("檢定消費:",s),e.stack-=s,s>0&&(this.status.showTip(e.attriube+"檢定"+e.class),this.status.updateStatusDisplay(t,-1));var i={class:c(1,20)},a=this[e.attriube];return console.log("檢定dc:",i.class,e.class,"骰出"+(i.class+a)+"點"),s&&this.status.showTip("骰出"+(i.class+a)+"點"),i.class+a>=e.class},s(t,[{key:"HP",get:function(){return this._hitPoint}},{key:"HitCheck",get:function(){return console.log("命中值",this._hitRoll,"+",this._hitBonus),Math.round(this._hitRoll+this._hitBonus)}},{key:"Defense",get:function(){return this._defense},set:function(t){this._defense=Math.max(t,0)}}]),t}());a._RF.pop()}}}));

System.register("chunks:///_virtual/ComboSkillItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./ToolTipManager.ts","./TooltipComponent.ts"],(function(i){var t,n,e,o,r,a,c,l,s,u,f,p,b,d;return{setters:[function(i){t=i.applyDecoratedDescriptor,n=i.inheritsLoose,e=i.initializerDefineProperty,o=i.assertThisInitialized},function(i){r=i.cclegacy,a=i._decorator,c=i.Sprite,l=i.Label,s=i.Color,u=i.Component},function(i){f=i.GameManager},function(i){p=i.ToolTipManager},function(i){b=i.ToolTipStyle,d=i.ToolTipSize}],execute:function(){var h,g,m,y,T,v,k,_,w,z,S,C,E,I,M;r._RF.push({},"93e52tkgb1IJ7J8nWHfhMq9","ComboSkillItem",void 0);var D=a.ccclass,j=a.property;i("ComboSkillItem",(h=D("ComboSkillItem"),g=j(c),m=j(c),y=j(l),T=j(l),v=j(l),k=j(l),h((z=t((w=function(i){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=i.call.apply(i,[this].concat(r))||this,e(t,"background",z,o(t)),e(t,"icon",S,o(t)),e(t,"title",C,o(t)),e(t,"description",E,o(t)),e(t,"conditions",I,o(t)),e(t,"effectTitle",M,o(t)),t._conditions=[],t._isEnabled=!1,t}n(t,i);var r=t.prototype;return r.refresh=function(i,t,n){this.title.string=i,this.description.string=t.join("\n"),this._conditions=n,this.conditions.string=""},r.trigger=function(i){if(i){this.background.color=new s(255,255,255);var t=[];this._conditions.forEach((function(i){t.push(f.instance.database.combatEffectDatabase.find((function(t){return t.effectType===i})).effectName)})),this.conditions.string=t.join("\n"),this.description.node.active=!1,this.effectTitle.string="連攜條件"}else this.background.color=new s(128,128,128),this.description.node.active=!0,this.effectTitle.string="發動效果";this._isEnabled=i},r.onClicked=function(){if(this._isEnabled){var i=[];this._conditions.forEach((function(t){i.push(f.instance.database.combatEffectDatabase.find((function(i){return i.effectType===t})).effectName)}));var t=[];t.push("額外效果:\n"+this.description.string),t.push("連攜條件:\n"+i.join("\n")),p.instance.show(t,this.node,b.FromRight,d.Small)}},t}(u)).prototype,"background",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(w.prototype,"icon",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(w.prototype,"title",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(w.prototype,"description",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(w.prototype,"conditions",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(w.prototype,"effectTitle",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=w))||_));r._RF.pop()}}}));

System.register("chunks:///_virtual/ComboSkillListPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ComboSkillItem.ts","./GameManager.ts","./ToolTipManager.ts"],(function(e){var t,n,o,i,r,a,c,l,u,s,f,m,p,h,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized,r=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){c=e.cclegacy,l=e._decorator,u=e.Layout,s=e.Component,f=e.instantiate,m=e.ScrollView},function(e){p=e.ComboSkillItem},function(e){h=e.GameManager},function(e){d=e.ToolTipManager}],execute:function(){var b,v,g,y,C,k,S;c._RF.push({},"ae8d8rIOPtCUqOd+ikHF0rE","ComboSkillListPanel",void 0);var I=l.ccclass,L=l.property;e("ComboSkillListPanel",(b=I("ComboSkillListPanel"),v=L(p),g=L(u),b((k=t((C=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"comboSkillItem",k,i(t)),o(t,"layout",S,i(t)),t}n(t,e);var c=t.prototype;return c.onLoad=function(){},c.list=function(){var e=r(a().mark((function e(t){var n,o,i,r,c,l,u=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return u.scheduleOnce(e,t)}));case 2:if(o=h.instance.database.combatCardDatabase){e.next=6;break}return this.list(t+.1),e.abrupt("return");case 6:i=o.filter((function(e){return e.evolutions.length>0})),r={},i.forEach((function(e){e.evolutions.forEach((function(e){r[e.name]||(r[e.name]=[]),r[e.name].push(e)}))})),(c=this.layout.node.children).forEach((function(e){return e.active=!1})),l=0,Object.values(r).forEach((function(e){var t=c[l++];t||((t=f(u.comboSkillItem.node)).parent=u.layout.node),t.active=!0;var n=h.instance.characterCombatData.getComboListByCardName(e[0].name),o=t.getComponent(p);o.refresh(e[0].name,e.map((function(e){return e.effectName})),e[0].conditions.split(" ")),n.length>0?o.trigger(n.every((function(t){return e[0].conditions.indexOf(t)>-1}))):o.trigger(!1)})),null==(n=this.node.getComponentInChildren(m))||n.scrollToTop();case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.onShowUIClicked=function(){this.node.active=!this.node.active,this.node.active?this.list(.2):d.instance.hide()},t}(s)).prototype,"comboSkillItem",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(C.prototype,"layout",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=C))||y));c._RF.pop()}}}));

System.register("chunks:///_virtual/CounterComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,o,r,i,u,a,c,s,l,p,f,d;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized,i=t.createClass},function(t){u=t.cclegacy,a=t._decorator,c=t.Label,s=t.Node,l=t.Vec3,p=t.tween,f=t.UIOpacity,d=t.Component}],execute:function(){var C,h,b,v,m;u._RF.push({},"a4592V7k85I6Y4OVwBiWMQr","CounterComponent",void 0);var y=a.ccclass,g=a.property;t("CounterComponent",(C=y("CounterComponent"),h=g(c),C((m=n((v=function(t){function n(){for(var n,e=arguments.length,i=new Array(e),u=0;u<e;u++)i[u]=arguments[u];return n=t.call.apply(t,[this].concat(i))||this,o(n,"counterLabel",m,r(n)),n.minCount=1,n.currentCount=0,n.deprecatedCount=0,n}e(n,t);var u=n.prototype;return u.start=function(){this.count=this.currentCount},u.updateLabel=function(){this.counterLabel.string=this.currentCount.toString()},u.addCount=function(t,n,e){var o=this;void 0===n&&(n=""),void 0===e&&(e=30),this.currentCount=Math.max(this.currentCount+t,this.minCount);var r=new s;r.parent=this.node;var i=r.addComponent(c);t>0?(r.position=new l(0,-80,0),i.string="+"+t+"\n"+n,i.fontSize=e,p(r).to(.5,{position:new l(0,0,0)},{easing:"cubicOut"}).call((function(){o.updateLabel(),o.counterEffect()})).removeSelf().start()):(r.position=new l(0,0,0),i.string=t+"\n"+n,i.fontSize=e,this.counterEffect(),p(r).to(.5,{position:new l(0,-80,0)},{easing:"cubicOut"}).call((function(){o.updateLabel()})).removeSelf().start());var u=r.addComponent(f);p(u).to(.7,{opacity:120},{easing:"cubicOut"}).to(.1,{opacity:0}).start()},u.counterEffect=function(){p(this.counterLabel.node).to(.01,{scale:new l(1.5,1.5,1)}).to(.2,{scale:new l(1,1,1)}).start()},i(n,[{key:"count",set:function(t){this.currentCount=t,this.updateLabel()}}]),n}(d)).prototype,"counterLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=v))||b));u._RF.pop()}}}));

System.register("chunks:///_virtual/CSVLoader.ts",["cc"],(function(r){var t,e,n;return{setters:[function(r){t=r.cclegacy,e=r._decorator,n=r.resources}],execute:function(){var o;t._RF.push({},"c4720GIVLlAOLtbrOZf7kjr","CSVLoader",void 0);var c=e.ccclass;r("CSVLoader",c("CSVLoader")(o=function(){function r(){}return r.loadCSV=function(r,t){var e=this;n.load(r,(function(r,n){if(r)console.error("Failed to load CSV:",r);else{var o=n.text,c=e.parseCSV(o);t(c)}}))},r.parseCSV=function(r){var t=r.split("\n"),e=t[0].split(",");return t.slice(1).map((function(r){var t=r.split(","),n={};return e.forEach((function(r,e){n[r.trim()]=t[e].trim()})),n}))},r}())||o);t._RF.pop()}}}));

System.register("chunks:///_virtual/debug-view-runtime-control.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,n,s,l,r,a,g,h,p,c,C,d,m,u,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,a=t.Color,g=t.Canvas,h=t.UITransform,p=t.instantiate,c=t.Label,C=t.RichText,d=t.Toggle,m=t.Button,u=t.director,L=t.Component}],execute:function(){var f,M,b,v,T,S,x,E,I;s._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var A=l.ccclass,y=l.property;t("DebugViewRuntimeControl",(f=A("internal.DebugViewRuntimeControl"),M=y(r),b=y(r),v=y(r),f((x=e((S=function(t){function e(){for(var e,o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"compositeModeToggle",x,n(e)),i(e,"singleModeToggle",E,n(e)),i(e,"EnableAllCompositeModeButton",I,n(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e.hideButtonLabel=void 0,e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[a.WHITE,a.BLACK,a.RED,a.GREEN,a.BLUE],e}o(e,t);var s=e.prototype;return s.start=function(){if(this.node.parent.getComponent(g)){var t=this.node.parent.getComponent(h),e=.5*t.width,o=.5*t.height,i=.1*e-e,n=o-.1*o,s=this.node.getChildByName("MiscMode"),l=p(s);l.parent=this.node,l.name="Buttons";var r=p(s);r.parent=this.node,r.name="Titles";for(var u=0;u<2;u++){var L=p(this.EnableAllCompositeModeButton.getChildByName("Label"));L.setPosition(i+(u>0?450:150),n,0),L.setScale(.75,.75,.75),L.parent=r;var f=L.getComponent(c);f.string=u?"----------Composite Mode----------":"----------Single Mode----------",f.color=a.WHITE,f.overflow=0,this.labelComponentList[this.labelComponentList.length]=f}n-=20;for(var M=0,b=0;b<this.strSingle.length;b++,M++){b===this.strSingle.length>>1&&(i+=200,M=0);var v=b?p(this.singleModeToggle):this.singleModeToggle;v.setPosition(i,n-20*M,0),v.setScale(.5,.5,.5),v.parent=this.singleModeToggle.parent;var T=v.getComponentInChildren(C);T.string=this.strSingle[b],this.textComponentList[this.textComponentList.length]=T,this.textContentList[this.textContentList.length]=T.string,v.on(d.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[b]=v}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,n,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(m.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=l;var S=this.EnableAllCompositeModeButton.getComponentInChildren(c);this.labelComponentList[this.labelComponentList.length]=S;var x=p(this.EnableAllCompositeModeButton);x.setPosition(i+90,n,0),x.setScale(.5,.5,.5),x.on(m.EventType.CLICK,this.changeTextColor,this),x.parent=l,(S=x.getComponentInChildren(c)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=S;var E=p(this.EnableAllCompositeModeButton);E.setPosition(i+200,n,0),E.setScale(.5,.5,.5),E.on(m.EventType.CLICK,this.hideUI,this),E.parent=this.node.parent,(S=E.getComponentInChildren(c)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=S,this.hideButtonLabel=S,n-=40;for(var I=0;I<this.strMisc.length;I++){var A=p(this.compositeModeToggle);A.setPosition(i,n-20*I,0),A.setScale(.5,.5,.5),A.parent=s;var y=A.getComponentInChildren(C);y.string=this.strMisc[I],this.textComponentList[this.textComponentList.length]=y,this.textContentList[this.textContentList.length]=y.string,A.getComponent(d).isChecked=!!I,A.on(d.EventType.TOGGLE,I?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[I]=A}n-=150;for(var D=0;D<this.strComposite.length;D++){var B=D?p(this.compositeModeToggle):this.compositeModeToggle;B.setPosition(i,n-20*D,0),B.setScale(.5,.5,.5),B.parent=this.compositeModeToggle.parent;var w=B.getComponentInChildren(C);w.string=this.strComposite[D],this.textComponentList[this.textComponentList.length]=w,this.textContentList[this.textContentList.length]=w.string,B.on(d.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[D]=B}}else console.error("debug-view-runtime-control should be child of Canvas")},s.isTextMatched=function(t,e){var o=new String(t),i=o.search(">");return-1===i?t===e:(o=(o=o.substr(i+1)).substr(0,o.search("<")))===e},s.toggleSingleMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strSingle.length;i++)this.isTextMatched(o.string,this.strSingle[i])&&(e.singleMode=i)},s.toggleCompositeMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strComposite.length;i++)this.isTextMatched(o.string,this.strComposite[i])&&e.enableCompositeMode(i,t.isChecked)},s.toggleLightingWithAlbedo=function(t){u.root.debugView.lightingWithAlbedo=t.isChecked},s.toggleCSMColoration=function(t){u.root.debugView.csmLayerColoration=t.isChecked},s.enableAllCompositeMode=function(t){var e=u.root.debugView;e.enableAllCompositeMode(!0);for(var o=0;o<this.compositeModeToggleList.length;o++){this.compositeModeToggleList[o].getComponent(d).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(d);i.isChecked=!1,e.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(d)).isChecked=!0,e.lightingWithAlbedo=!0},s.hideUI=function(t){var e=this.node.getChildByName("Titles"),o=!e.active;this.singleModeToggleList[0].parent.active=o,this.miscModeToggleList[0].parent.active=o,this.compositeModeToggleList[0].parent.active=o,this.EnableAllCompositeModeButton.parent.active=o,e.active=o,this.hideButtonLabel.string=o?"Hide UI":"Show UI"},s.changeTextColor=function(t){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(var o=0;o<this.labelComponentList.length;o++)this.labelComponentList[o].color=this.color[this._currentColorIndex]},s.onLoad=function(){},s.update=function(t){},e}(L)).prototype,"compositeModeToggle",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(S.prototype,"singleModeToggle",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(S.prototype,"EnableAllCompositeModeButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=S))||T));s._RF.pop()}}}));

System.register("chunks:///_virtual/Debug.ts",["cc"],(function(n){var t;return{setters:[function(n){t=n.cclegacy}],execute:function(){t._RF.push({},"3be68SRSMpPiZNXsEMpSxZI","Debug",void 0),n("Debug",function(){function n(){this.records=[]}return n.getInstance=function(){return this.instance||(this.instance=new n),this.instance},n.Log=function(){for(var t,e="[LOG] ",c=arguments.length,s=new Array(c),o=0;o<c;o++)s[o]=arguments[o];[].concat(s).forEach((function(n){e+="string"==typeof n?n:"object"==typeof n?JSON.stringify(n):n.toString()})),n.getInstance().records.push(e),n.getInstance().records.splice(0,n.getInstance().records.length-20),(t=console).log.apply(t,["[DEBUG.LOG]"].concat(s))},n}()).instance=void 0,t._RF.pop()}}}));

System.register("chunks:///_virtual/DefenseAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,o,n,r,a,s,c,d,l,u,p,f,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized,r=e.createClass},function(e){a=e.cclegacy,s=e._decorator,c=e.Node,d=e.Label,l=e.Vec3,u=e.UIOpacity,p=e.tween,f=e.v3,h=e.Component}],execute:function(){var b,y,m,g,N,v,L,O,_,w,D,C,P,z;a._RF.push({},"bf79d8GvnFMRL0TfWPWT1dq","DefenseAnimation",void 0);var A=s.ccclass,k=s.property;e("DefenseAnimation",(b=A("DefenseAnimation"),y=k(c),m=k(d),g=k(d),N=k(c),v=k(c),b((_=t((O=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"defenseNode",_,n(t)),o(t,"defenseLabel",w,n(t)),o(t,"armoredLabel",D,n(t)),o(t,"armoredNode",C,n(t)),o(t,"eyeNode",P,n(t)),o(t,"distance",z,n(t)),t._defenseOpacity=null,t._oriPosition=new l,t}i(t,e);var a=t.prototype;return a.onLoad=function(){this.defenseNode.active=!1,this._oriPosition=this.armoredLabel.node.position,this._defenseOpacity=this.defenseNode.getComponent(u),this._defenseOpacity||console.error("DefenseAnimation: _defenseOpacity is null")},a.buildDefense=function(e){var t=this.armoredLabel.getComponent(u);t&&(t.opacity=255),this.armor=e;var i=.5,o=this.armoredLabel.node.position.clone();this.armoredNode.forEach((function(e){return e.active=!0})),this.armoredNode[0].position=o.clone().subtract(new l(40,0,0)),this.armoredNode[1].position=o.clone().add(new l(40,0,0)),p(this.armoredNode[0]).to(i,{position:o},{easing:"cubicOut"}).start(),p(this.armoredNode[1]).to(i,{position:o},{easing:"cubicOut"}).start(),this.armoredNode[0].getComponent(u).opacity=0,this.armoredNode[1].getComponent(u).opacity=0,p(this.armoredNode[0].getComponent(u)).to(.25,{opacity:160},{easing:"cubicOut"}).delay(.25).start(),p(this.armoredNode[1].getComponent(u)).to(.125,{opacity:160},{easing:"cubicOut"}).delay(.25).start()},a.increaseDefense=function(e,t){var i=this;this.defenseNode.active=!0,this._defenseOpacity.opacity=0,this.defenseNode.position=this._oriPosition.clone().subtract(new l(0,this.distance,0)),this.defenseLabel.string="+"+e;p(this.defenseNode).to(1,{position:this._oriPosition},{easing:"cubicOut"}).call((function(){return i.armor=t})).start(),p(this._defenseOpacity).to(1/4,{opacity:255}).delay(.5).to(1/4,{opacity:0}).start()},a.decreaseDefense=function(e,t){var i=this;this.defenseNode.active=!0,this._defenseOpacity.opacity=0,this.defenseNode.position=this._oriPosition.clone().add(new l(0,this.distance,0)),this.defenseLabel.string="-"+e;p(this.defenseNode).to(.5,{position:this._oriPosition},{easing:"cubicOut"}).call((function(){return i.armor=t})).start(),p(this._defenseOpacity).to(.125,{opacity:255}).delay(.25).to(.125,{opacity:0}).start()},a.defenseBroken=function(e){var t=this,i=.5,o=this.armoredLabel.node.position.clone(),n=p(this.armoredNode[1]).to(i,{position:o.subtract3f(0,40,0)},{easing:"cubicOut"}).call((function(){t.armoredLabel.string=e+"\n(破碇)",t.armoredLabel.getComponent(u).opacity=180})),r=p(this.armoredNode[1].getComponent(u)).delay(.25).to(.125,{opacity:0},{easing:"cubicOut"});this.eyeNode.active=!0,this.eyeNode.position=o,p(this.eyeNode).to(.25,{scale:f(1.5,1.5,1)},{easing:"cubicOut"}).to(.25,{scale:f(1,1,1)},{easing:"cubicIn"}).call((function(){n.start(),r.start(),t.eyeNode.active=!1})).start()},r(t,[{key:"armor",set:function(e){this.armoredLabel.string=e.toString()}}]),t}(h)).prototype,"defenseNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(O.prototype,"defenseLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(O.prototype,"armoredLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(O.prototype,"armoredNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),P=t(O.prototype,"eyeNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(O.prototype,"distance",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),L=O))||L));a._RF.pop()}}}));

System.register("chunks:///_virtual/DiceAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,n,o,r,a,l,c,s,u,p,h,d,f;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,o=i.assertThisInitialized},function(i){r=i.cclegacy,a=i._decorator,l=i.CCInteger,c=i.CCFloat,s=i.Node,u=i.Label,p=i.Vec3,h=i.UIOpacity,d=i.tween,f=i.Component}],execute:function(){var g,b,y,_,m,V,v,w,D,z,L,O,T,x,C,M,P,I,Z,A,N;r._RF.push({},"df852/bswtF3blmL0rIX8iv","DiceAnimation",void 0);var E=a.ccclass,F=a.property;i("default",(g=E("DiceAnimation"),b=F({tooltip:"起點位置"}),y=F({type:l,tooltip:"移動方向的X軸力度"}),_=F({type:l,tooltip:"移動X軸的左極限"}),m=F({type:l,tooltip:"移動X軸的右極限"}),V=F({type:c,tooltip:"衰減值"}),v=F({type:c,tooltip:"力度極限值"}),w=F({type:s,tooltip:"骰子"}),D=F({type:u,tooltip:"骰子的值"}),z=F({type:u,tooltip:"骰子的文字提示"}),g((T=t((O=function(i){function t(){for(var t,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return t=i.call.apply(i,[this].concat(r))||this,n(t,"startPosition",T,o(t)),n(t,"force",x,o(t)),t._force=0,n(t,"leftLimit",C,o(t)),n(t,"rightLimit",M,o(t)),n(t,"decay",P,o(t)),n(t,"forceThreshold",I,o(t)),n(t,"diceNode",Z,o(t)),n(t,"diceValue",A,o(t)),n(t,"diceText",N,o(t)),t._isMoving=!1,t._diceValues=[],t._dropDiceValues=[],t._diceEndCallback=null,t._originalZOrder=p.ZERO,t}e(t,i);var r=t.prototype;return r.onLoad=function(){this._originalZOrder=this.node.position.clone(),this.startPosition=this.node.position.clone().add(this._originalZOrder)},r.update=function(i){var t;this._isMoving&&(this.node.position=this.node.position.add3f(this._force*i,0,0),(this.node.position.x<=this.leftLimit||this.node.position.x>=this.rightLimit)&&(this._force=-this._force,this.changeDiceValue()),this._force*=1-this.decay,Math.abs(this._force)<this.forceThreshold&&(this._isMoving=!1,null==(t=this._diceEndCallback)||t.call(this,parseInt(this.diceValue.string))))},r.starAnimation=function(i,t,e){var n=this;this._force=this.force,this.node.position=new p(this.startPosition.x,this._originalZOrder.y,0),this._isMoving=!0,this._diceValues=t,this.changeDiceValue();var o=this.diceNode.getComponent(h);return o.opacity=255,new Promise((function(t){d(n.diceNode).to(i/4,{position:new p(0,n.startPosition.y,0)},{easing:"cubicOut"}).parallel(d().to(i,{position:p.ZERO},{easing:"bounceOut"}),d().delay(i/3).call((function(){n.changeDiceValue()})).delay(i/3).call((function(){n.changeDiceValue()})).delay(i/4).call((function(){console.log("骰:",e),e?n.diceValue.string=e.toString():n.changeDiceValue()}))).call((function(){n._isMoving=!1,t(parseInt(n.diceValue.string))})).delay(1).call((function(){o&&d(o).to(.25,{opacity:0},{easing:"cubicOut"}).start()})).start()}))},r.changeDiceValue=function(){0===this._diceValues.length&&(this._diceValues=this._dropDiceValues.sort((function(){return Math.random()-.5})).slice(),this._dropDiceValues.length=0);var i=this._diceValues.shift();this.diceValue.string=i.toString(),this._dropDiceValues.push(i)},r.setTipText=function(i){this.diceText.string=i},t}(f)).prototype,"startPosition",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p(0,0,0)}}),x=t(O.prototype,"force",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),C=t(O.prototype,"leftLimit",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-100}}),M=t(O.prototype,"rightLimit",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),P=t(O.prototype,"decay",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),I=t(O.prototype,"forceThreshold",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Z=t(O.prototype,"diceNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(O.prototype,"diceValue",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(O.prototype,"diceText",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=O))||L));r._RF.pop()}}}));

System.register("chunks:///_virtual/DiscardDropZone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DropZone.ts","./Draggable.ts"],(function(r){var e,o,n,t,i,c,a,s,l;return{setters:[function(r){e=r.applyDecoratedDescriptor,o=r.inheritsLoose,n=r.initializerDefineProperty,t=r.assertThisInitialized},function(r){i=r.cclegacy,c=r._decorator,a=r.EventHandler},function(r){s=r.DropZone},function(r){l=r.Draggable}],execute:function(){var u,p,d,f,D;i._RF.push({},"ace6bWQFNlBupgd81sJv07+","DiscardDropZone",void 0);var g=c.ccclass,h=c.property;r("DiscardDropZone",(u=g("DiscardDropZone"),p=h(a),u((D=e((f=function(r){function e(){for(var e,o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];return e=r.call.apply(r,[this].concat(i))||this,n(e,"discared",D,t(e)),e}o(e,r);var i=e.prototype;return i.onDrop=function(r){var e=r.draggableItem,o=r.dropZone,n=this.slot.children[0];if(n){n.getComponent(l);var t=function(){n.destroy(),console.log("棄物欄的東西刪除!")};this.discared.forEach((function(r){return r.emit([t])}))}e.setParent(this),console.log("道具已放置"),o.dropOut(e)},i.onDiscarded=function(r){r()},i.tooltip=function(){return"待丟棄的物品，可暫時放置於此。請注意，如果再疊放物品並不會讓兩者位置互換，而是將棄物區的物品直接刪除掉。"},e}(s)).prototype,"discared",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),d=f))||d));i._RF.pop()}}}));

System.register("chunks:///_virtual/DodgeAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,o,e,n,r,a,s,c,u,l,p;return{setters:[function(t){i=t.applyDecoratedDescriptor,o=t.inheritsLoose,e=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,s=t.Node,c=t.Vec3,u=t.tween,l=t.Tween,p=t.Component}],execute:function(){var g,d,m,h,f,v,b;r._RF.push({},"bbbad5Z7GlHLY/sdj0z7DaP","DodgeAnimation",void 0);var D=a.ccclass,y=a.property;t("DodgeAnimation",(g=D("DodgeAnimation"),d=y(s),g((f=i((h=function(t){function i(){for(var i,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return i=t.call.apply(t,[this].concat(r))||this,e(i,"targetNode",f,n(i)),e(i,"moveDistance",v,n(i)),e(i,"moveDuration",b,n(i)),i._originalPosition=void 0,i}o(i,t);var r=i.prototype;return r.start=function(){},r.startAnimation=function(){var t=this._originalPosition=this.node.position.clone(),i=Math.random()>.5?1:-1,o=new c(t.x+i*this.moveDistance,t.y,t.z);u(this.targetNode).to(this.moveDuration/2,{position:o},{easing:"cubicInOut"}).to(this.moveDuration,{position:t},{easing:"bounceOut"}).start()},r.stopAnimation=function(){l.stopAllByTarget(this.targetNode),this._originalPosition&&this.targetNode.setPosition(this._originalPosition)},i}(p)).prototype,"targetNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(h.prototype,"moveDistance",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),b=i(h.prototype,"moveDuration",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),m=h))||m));r._RF.pop()}}}));

System.register("chunks:///_virtual/Draggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DropZone.ts","./ToolTipManager.ts","./TooltipComponent.ts"],(function(t){var e,n,o,i,s,r,h,c,a,l,d,u,p,T;return{setters:[function(t){e=t.inheritsLoose,n=t.createForOfIteratorHelperLoose,o=t.createClass},function(t){i=t.cclegacy,s=t._decorator,r=t.director,h=t.Node,c=t.UITransform,a=t.Vec3,l=t.Component},function(t){d=t.DropZone},function(t){u=t.ToolTipManager},function(t){p=t.ToolTipStyle,T=t.ToolTipSize}],execute:function(){var f;i._RF.push({},"4ac5eCcK6dH/KZhaSJWSFMd","Draggable",void 0);var g=s.ccclass;s.property,t("Draggable",g("Draggable")(f=function(t){function i(){for(var e,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))||this).zone=null,e.isLocked=!1,e._isPressing=!1,e._droppingArea=null,e}e(i,t);var s=i.prototype;return s.onEnable=function(){this._droppingArea=r.getScene().children[0].getChildByName("Manager"),this.node.on(h.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(h.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(h.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(h.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},s.onDisable=function(){this.node.off(h.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(h.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(h.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(h.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},s.onTouchStart=function(t){var e=this;if(this._isPressing=!0,this.unscheduleAllCallbacks(),this.scheduleOnce((function(){e._isPressing&&(e._isPressing=!1,console.log("Item:",e.Item.description),u.instance.show([e.Item.tooltip,e.Item.description],e.node,p.FromTop,T.Normal))}),.5),u.instance.hide(),!this.isLocked){var n=this.node.parent.getComponent(c).convertToWorldSpaceAR(this.node.position),o=n.x,i=n.y;this.node.parent=this._droppingArea,this.node.setWorldPosition(new a(o,i,0))}},s.onTouchMove=function(t){if(!this.isLocked){var e=t.getUIDelta();this.node.setPosition(this.node.position.x+e.x,this.node.position.y+e.y),this._isPressing=!1}},s.onTouchEnd=function(t){if(!this.isLocked){for(var e,o=this.node.parent.getComponentsInChildren(d).filter((function(t){return t.node.active})),i=!1,s=this.node.getWorldPosition(),r=s.x,h=s.y,c=n(o);!(e=c()).done;){var l=e.value;if(a.len(l.node.getWorldPosition().clone().subtract3f(r,h,0))<50){i=!0,l.node.emit("drop",{draggableItem:this,dropZone:this.zone});break}}i||(this.node.parent=this.zone.slot,this.node.setPosition(a.ZERO))}},s.onTouchCancel=function(t){this.resetPosition()},s.setParent=function(t){return this.zone=t,this.resetPosition(),this.node.getComponent(c).contentSize=t.getComponent(c).contentSize,!0},s.resetPosition=function(){this.node.parent=this.zone.slot,this.node.setPosition(a.ZERO)},s.mergeItems=function(t){},s.isSameItem=function(t){return!1},o(i,[{key:"deactivated",set:function(t){t?this.onDisable():this.onEnable()}},{key:"Item",get:function(){return null}},{key:"Amount",get:function(){return this.Item.amount}}]),i}(l))||f);i._RF.pop()}}}));

System.register("chunks:///_virtual/DraggableDetail.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,a,n,l,o,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,o=e.Label,u=e.Component}],execute:function(){var c,s,p,b,g,f,D,L,h;n._RF.push({},"f373fQz0RFDUIEkpIlclFTV","DraggableDetail",void 0);var m=l.ccclass,y=l.property;e("DraggableDetail",(c=m("DraggableDetail"),s=y(o),p=y(o),b=y(o),c((D=t((f=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,r(t,"nameLabel",D,a(t)),r(t,"amountLabel",L,a(t)),r(t,"tipLabel",h,a(t)),t}i(t,e);var n=t.prototype;return n.setDetail=function(e,t){this.nameLabel.string=e,this.amountLabel.string=t>1?"x"+t:"",this.tipLabel.string=""},n.setTip=function(e){this.tipLabel.string=e},t}(u)).prototype,"nameLabel",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(f.prototype,"amountLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=t(f.prototype,"tipLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=f))||g));n._RF.pop()}}}));

System.register("chunks:///_virtual/DropZone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Draggable.ts"],(function(e){var o,t,n,r,i,s,l,a,c,p;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,i=e.createClass},function(e){s=e.cclegacy,l=e._decorator,a=e.Node,c=e.Component},function(e){p=e.Draggable}],execute:function(){var u,f,m,d,g;s._RF.push({},"ae71cnkrp1Nopo6XFRtfKkQ","DropZone",void 0);var h=l.ccclass,D=l.property;e("DropZone",(u=h("DropZone"),f=D(a),u((g=o((d=function(e){function o(){for(var o,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return o=e.call.apply(e,[this].concat(i))||this,n(o,"slot",g,r(o)),o}t(o,e);var s=o.prototype;return s.onEnable=function(){this.node.on("drop",this.onDrop,this)},s.onDisable=function(){this.node.off("drop",this.onDrop,this)},s.onDrop=function(e){var o=e.draggableItem,t=e.dropZone,n=this.slot.getComponentInChildren(p);if(n)if(o.isSameItem(n.Item)&&o.Amount+n.Amount<=o.Item.stackLimit)o.mergeItems(n.node),console.log("合併道具數量");else{if(!n.setParent(t))return o.resetPosition();console.log("道具已存在，交换位置",o.Item.name,"取代",n.Item.name)}o.setParent(this),t.dropOut(o),console.log("道具已放置")},s.init=function(){},s.dropOut=function(e){console.log("drop out")},i(o,[{key:"item",get:function(){var e;return null==(e=this.slot.getComponentInChildren(p))?void 0:e.Item}}]),o}(c)).prototype,"slot",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=d))||m));s._RF.pop()}}}));

System.register("chunks:///_virtual/DynamicWidthScrollView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,e,o,r,l,c,s,a,h,d,u,p,f,g;return{setters:[function(t){i=t.inheritsLoose,n=t.applyDecoratedDescriptor,e=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose,l=t.createClass},function(t){c=t.cclegacy,s=t._decorator,a=t.ScrollView,h=t.Event,d=t.Vec3,u=t.UITransform,p=t.Layout,f=t.v3,g=t.Component}],execute:function(){var m,w,v,y,S,V,b,E,W,L;c._RF.push({},"97f47FpcPJIjKbS1g4ndve0","DynamicWidthScrollView",void 0);var C=s.ccclass,_=s.property,T=t("DynamicWidthScrollEvent",function(t){function n(i,n,e){var o;return(o=t.call(this,i,n)||this).detail=null,o.detail=e,o}return i(n,t),n}(h));T.DYNAMIC_WIDTH_SCROLL_EVENT="dynamic-width-scroll-event";t("DynamicWidthScrollView",(m=C("DynamicWidthScrollView"),w=_(a),m((S=n((y=function(t){function n(){for(var i,n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return i=t.call.apply(t,[this].concat(r))||this,e(i,"scrollView",S,o(i)),e(i,"maxWidth",V,o(i)),e(i,"minWidth",b,o(i)),e(i,"spacingX",E,o(i)),e(i,"paddingLeft",W,o(i)),e(i,"paddingRight",L,o(i)),i._centerPosition=d.ZERO,i._scrollContentTrans=null,i}i(n,t);var c=n.prototype;return c.onLoad=function(){if(this.scrollView){this._centerPosition=this.scrollView.getComponent(u).convertToWorldSpaceAR(d.ZERO),this._scrollContentTrans=this.scrollView.content.getComponent(u);var t=this.scrollView.content.getComponent(p);t.spacingX=this.spacingX,t.paddingLeft=this.paddingLeft,t.paddingRight=this.paddingRight,this.scrollView.cancelInnerEvents=!1,this.scrollView.enabled=!1}else console.error("ScrollView component is not assigned.")},c.onEnable=function(){this.scrollView.node.on(a.EventType.SCROLLING,this.onScrolling,this),this.scrollView.node.on(a.EventType.SCROLL_ENDED,this.onScrollEnded,this)},c.onDisable=function(){this.scrollView.node.off(a.EventType.SCROLLING,this.onScrolling,this),this.scrollView.node.off(a.EventType.SCROLL_ENDED,this.onScrollEnded,this)},c.onScrolling=function(){for(var t,i=this._scrollContentTrans.node.children,n=r(i);!(t=n()).done;){var e=t.value,o=this._scrollContentTrans.convertToWorldSpaceAR(e.position),l=d.distance(o,this._centerPosition),c=this.calculateWidth(l);e.getComponent(u).width=c;var s=1+c/this.maxWidth;e.scale=f(s,s,1)}},c.onScrollEnded=function(){var t=this,i=[];this.scrollView.content.children.forEach((function(n){i.push(t._scrollContentTrans.convertToWorldSpaceAR(n.position))})),this.node.dispatchEvent(new T(T.DYNAMIC_WIDTH_SCROLL_EVENT,!0,{positions:i}))},c.calculateWidth=function(t){var i=this.scrollView.node.getComponent(u).width/2,n=this.minWidth+(this.maxWidth-this.minWidth)*(1-t/i);return n=Math.max(this.minWidth,Math.min(this.maxWidth,n))},l(n,[{key:"content",get:function(){return this.scrollView.content}}]),n}(g)).prototype,"scrollView",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=n(y.prototype,"maxWidth",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),b=n(y.prototype,"minWidth",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),E=n(y.prototype,"spacingX",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),W=n(y.prototype,"paddingLeft",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),L=n(y.prototype,"paddingRight",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v=y))||v));c._RF.pop()}}}));

System.register("chunks:///_virtual/EllipseMotion.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,r,o,a,l,s,u,c,p,f,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,l=t.CCBoolean,s=t.CCInteger,u=t.v3,c=t.randomRange,p=t.Vec3,f=t.tween,h=t.Component}],execute:function(){var b,y,d,w,g,m,v,z,M,_,E,C,P,D,S;o._RF.push({},"0e8032UdZJLa4XG6z7508qi","EllipseMotion",void 0);var x=a.ccclass,F=a.property;t("EllipseMotion",(b=x("EllipseMotion"),y=F(l),d=F({type:s,tooltip:"椭圆的半长轴长度"}),w=F({type:s,tooltip:"椭圆的半短轴长度"}),g=F({type:u,tooltip:"椭圆的中心点位置"}),m=F({type:s,tooltip:"运动方向，1为顺时针，-1为逆时针"}),v=F({type:s,tooltip:"完成一圈的时间，单位为秒"}),b((_=e((M=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,n(e,"autoStart",_,r(e)),n(e,"a",E,r(e)),n(e,"b",C,r(e)),n(e,"center",P,r(e)),n(e,"direction",D,r(e)),n(e,"duration",S,r(e)),e._tween=null,e}i(e,t);var o=e.prototype;return o.start=function(){this.autoStart&&this.startEllipseMotion()},o.startEllipseMotion=function(){var t=this,e={num:c(0,1)},i=new p(this.center.x+this.a,this.center.y,this.center.z);this.node.setPosition(i),this._tween=f(e).to(this.duration,{num:1},{progress:function(e,i,n,r){var o=2*Math.PI*(r+n)*t.direction,a=t.center.x+t.a*Math.cos(o),l=t.center.y+t.b*Math.sin(o);return t.node.setPosition(a,l,t.center.z),r},easing:"linear"}).repeatForever(),this._tween.start()},o.onDestroy=function(){this._tween&&this._tween.stop()},e}(h)).prototype,"autoStart",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),E=e(M.prototype,"a",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),C=e(M.prototype,"b",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),P=e(M.prototype,"center",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p(0,0,0)}}),D=e(M.prototype,"direction",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),S=e(M.prototype,"duration",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),z=M))||z));o._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerCardData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n;return{setters:[function(t){e=t.createClass},function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"ccd0ezjodZFI5/H0FYjbduc","EmpowerCardData",void 0);t("EmpowerCardData",function(){function t(t,e,n,i,r,o){this._regimentation=void 0,this._regimentationRank=void 0,this._empowerId=void 0,this._empowerName=void 0,this._combatCards=[],this._cost=void 0,this._regimentation=t,this._regimentationRank=i,this._empowerId=e,this._empowerName=n,this._combatCards=r,this._cost=o}return t.fromCSV=function(e){var n=parseInt(e.cost);return new t(e.regimentation,e.id,e.name,e.rank,e.cards,n)},e(t,[{key:"regimentation",get:function(){return this._regimentation}},{key:"regimentationRank",get:function(){return this._regimentationRank}},{key:"empowerId",get:function(){return this._empowerId}},{key:"empowerName",get:function(){return this._empowerName}},{key:"combatCards",get:function(){return this._combatCards}},{key:"cost",get:function(){return this._cost}}]),t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerCardSelection.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./ToolTipManager.ts","./TooltipComponent.ts"],(function(t){var e,i,o,n,a,r,c,s,p,l,f,u,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,r=t._decorator,c=t.UIOpacity,s=t.Vec3,p=t.Component},function(t){l=t.GameManager},function(t){f=t.ToolTipManager},function(t){u=t.ToolTipStyle,d=t.ToolTipSize}],execute:function(){var h,y,b,m,g,T;a._RF.push({},"fe6928ROQNBKrJTa8YLnJ9Q","EmpowerCardSelection",void 0);var v=r.ccclass,w=r.property;t("EmpowerCardSelection",(h=v("EmpowerCardSelection"),y=w(c),h((g=e((m=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,o(e,"offsetY",g,n(e)),o(e,"opacity",T,n(e)),e._oriPos=new s(0,0),e.cardId="",e.isSelected=!1,e}i(e,t);var a=e.prototype;return a.init=function(){this._oriPos=this.node.position.clone(),this.opacity.opacity=122},a.select=function(t){void 0===t&&(t=!0),t?(this.node.position=this._oriPos.clone().add3f(0,this.offsetY,0),this.opacity.opacity=255):(this.node.position=this._oriPos.clone(),this.opacity.opacity=122,f.instance.hide()),this.isSelected=t},a.tip=function(){var t=this,e=l.instance.database.combatCardDatabase.find((function(e){return e.cardId===t.cardId})),i=["卡牌 - "+e.cardName+":<br/>\t\t\t\t"+e.getDescription("<br/>\t\t\t\t")];e.combatEffects.forEach((function(t){var e=l.instance.database.combatEffectDatabase.find((function(e){return e.effectId===t.id}));i.push("效果 - "+e.effectName+":<br/>\t\t\t\t"+e.description)})),f.instance.show(i,this.node,u.FromRight,d.Normal)},a.onTipClicked=function(){this.tip(),f.instance.enableBlock()},e}(p)).prototype,"offsetY",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),T=e(m.prototype,"opacity",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=m))||b));a._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerCardsListItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EmpowerCardSelection.ts","./CheckBoxComponent.ts","./GameManager.ts"],(function(e){var t,n,r,o,i,a,c,l,u,s,d,p,m,h,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,i=e.createClass},function(e){a=e.cclegacy,c=e._decorator,l=e.Layout,u=e.Label,s=e.Node,d=e.instantiate,p=e.Component},function(e){m=e.EmpowerCardSelection},function(e){h=e.CheckBoxComponent},function(e){f=e.GameManager}],execute:function(){var C,g,y,b,w,v,I,k,_,E,B;a._RF.push({},"15e66JpM99KFaMCBD5ZXhE3","EmpowerCardsListItem",void 0);var x=c.ccclass,L=c.property;e("EmpowerCardsListItem",(C=x("EmpowerCardsListItem"),g=L(l),y=L(u),b=L(s),w=L(h),C((k=t((I=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,r(t,"layout",k,o(t)),r(t,"label",_,o(t)),r(t,"cardPrefab",E,o(t)),r(t,"checkBox",B,o(t)),t._regimentation="",t._empowerId="",t._empowerCard=null,t}n(t,e);var a=t.prototype;return a.onLoad=function(){this.cardPrefab.active=!1},a.list=function(e){var t=this;this._regimentation=e.regimentation,this._empowerId=e.empowerId,this.label.string=e.empowerName,this.layout.node.removeAllChildren(),e.combatCards.forEach((function(e){for(var n=e.num,r=0;r<n;r++){var o=d(t.cardPrefab);o.active=!0,o.parent=t.layout.node,o.getComponent(m).cardId=e.id,o.getComponentInChildren(u).string=e.name}})),this._empowerCard=e,this.layout.updateLayout(),this.layout.node.children.forEach((function(e){e.getComponent(m).init()}))},a.updateCombatCards=function(e){var t=this,n=this.layout.node.children,r=!1;e.forEach((function(e){n.some((function(t){var n=t.getComponent(m);return!((null==n?void 0:n.cardId)!==e||null!=n&&n.isSelected)&&(n.select(),r=!0,!0)}))})),r&&this.scheduleOnce((function(){t.checkBox.check()}),.1)},a.updateCombatCardsSelection=function(){var e=this._empowerCard.regimentation,t=this.layout.node.getComponentsInChildren(m).filter((function(e){return e.isSelected})).map((function(e){return e.cardId}));f.instance.characterCombatData.updateEmpowerCombatCardIds(e,t)},a.onCardClicked=function(e){var t=e.currentTarget.getComponent(m);t.select(!t.isSelected),t.isSelected?(this.checkBox.check(),t.tip()):this.layout.node.getComponentsInChildren(m).every((function(e){return!e.isSelected}))&&this.checkBox.cancel()},a.onCheckBoxClicked=function(e){var t=this;this.layout.node.getComponentsInChildren(m).forEach((function(e){return e.select(t.checkBox.isChecked)}))},i(t,[{key:"regimentation",get:function(){return this._regimentation}},{key:"empowerId",get:function(){return this._empowerId}}]),t}(p)).prototype,"layout",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(I.prototype,"label",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(I.prototype,"cardPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(I.prototype,"checkBox",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=I))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerCombatCardList.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CheckBoxComponent.ts","./PopupWindowComponent.ts","./EmpowerCardsListItem.ts","./GameManager.ts","./ToolTipManager.ts"],(function(e){var t,a,n,r,o,i,s,c,m,d,p,u,C,l,w,f,h,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.createClass,i=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){c=e.cclegacy,m=e._decorator,d=e.Node,p=e.Layout,u=e.Component,C=e.instantiate},function(e){l=e.CheckBoxComponent},function(e){w=e.PopupWindowComponent},function(e){f=e.EmpowerCardsListItem},function(e){h=e.GameManager},function(e){b=e.ToolTipManager}],execute:function(){var g,L,y,v,E,I,k,D,_,S,B,R;c._RF.push({},"f7b72lDm39O2b0VSTgjN98U","EmpowerCombatCardList",void 0);var T=m.ccclass,x=m.property;e("EmpowerCombatCardList",(g=T("EmpowerCombatCardList"),L=x(d),y=x(p),v=x(f),E=x(w),g(((R=function(e){function t(){for(var t,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,n(t,"empowerCardsListView",D,r(t)),n(t,"empowerCardsListLayout",_,r(t)),n(t,"empowerCardsListItem",S,r(t)),n(t,"popupWindow",B,r(t)),t._empowerCombatCards={},t}a(t,e);var c=t.prototype;return c.onLoad=function(){t._instance?this.destroy():t._instance=this,this.empowerCardsListItem.node.active=!1},c.list=function(){var e=i(s().mark((function e(t){var a,n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=.1),this.empowerCardsListView.active=!0,e.next=4,new Promise((function(e){return r.scheduleOnce(e,t)}));case 4:if(a=this.getEmpoweredCardDataListBySelfRank(),0!==Object.keys(a).length){e.next=8;break}return t<.5&&this.list(t+.1),e.abrupt("return");case 8:(n=this.empowerCardsListLayout.node.children).forEach((function(e){return e.active=!1})),a.forEach((function(e,t){var a=n[t];a||((a=C(r.empowerCardsListItem.node)).parent=r.empowerCardsListLayout.node),a.active=!0;var o,i,s=h.instance.characterCombatData.getEmpowerCombatCardIds(e.regimentation),c=a.getComponent(f);(c.list(e),c.updateCombatCards(s),c.empowerId===e.empowerId)&&(s[e.empowerId]?null==(o=c.getComponentInChildren(l))||o.check():null==(i=c.getComponentInChildren(l))||i.cancel())}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.hide=function(){this.empowerCardsListView.active=!1,b.instance.hide()},c.enableEmpowerCards=function(e,t){this.empowerCardsListLayout.node.children.forEach((function(a){var n,r,o=a.getComponent(f);o.regimentation===e&&(o.empowerId===t?(console.log("觸發賦能:",t),null==(n=o.getComponentInChildren(l))||n.check()):(console.log("取消觸發賦能:",o.empowerId),null==(r=o.getComponentInChildren(l))||r.cancel()))}));var a=[];this.empowerCardsListLayout.getComponentsInChildren(f).forEach((function(e){var t;null!=(t=e.getComponentInChildren(l))&&t.isChecked&&a.push(e.empowerId)})),this.updateEmpowerCombatCardsByEmpowerSelected(a)},c.saveData=function(){this.empowerCardsListLayout.getComponentsInChildren(f).forEach((function(e){e.updateCombatCardsSelection()})),h.instance.characterCombatData.write()},c.updateEmpowerCombatCardsByCardSelected=function(){var e=this;this.getEmpoweredCardDataListBySelfRank().some((function(t){var a=t.empowerId,n=h.instance.database.combatCardDatabase,r=h.instance.characterCombatData.getEmpowerCombatCardIds(t.regimentation);a===t.empowerId&&(e._empowerCombatCards[a]={name:t.empowerName,cards:[]},r.forEach((function(t){var r=n.find((function(e){return e.cardId===t}));e._empowerCombatCards[a].cards.push(r)})))}))},c.updateEmpowerCombatCardsByEmpowerSelected=function(e){var t=this,a={},n=h.instance.database.combatCardDatabase;h.instance.database.empowerCardDatabase.forEach((function(r){e.includes(r.empowerId)&&t.fillEmpowerCombatCards(r,a,n)})),this._empowerCombatCards=a},c.getEmpoweredCardDataListBySelfRank=function(){return h.instance.database.empowerCardDatabase.filter((function(e){var t=e.regimentation;return h.instance.characterCombatData.getEmpowerCardRank(t)===e.regimentationRank}))},c.updateEmpowerCombatCardsFromSelfRank=function(){var e=this,t=h.instance.database.combatCardDatabase,a={};this.getEmpoweredCardDataListBySelfRank().forEach((function(n){e.fillEmpowerCombatCards(n,a,t)})),this._empowerCombatCards=a},c.fillEmpowerCombatCards=function(e,t,a){var n=e.empowerId;t[n]={name:e.empowerName,cards:[]},e.combatCards.forEach((function(r){var o=r.num,i=a.find((function(e){return e.cardId===r.id}));if(i){console.log(e.empowerName+" 抽 "+o+" 張 "+r.name);for(var s=0;s<o;s++)t[n].cards.push(i)}}))},o(t,[{key:"empowerCombatCards",get:function(){return this._empowerCombatCards}},{key:"IsActive",get:function(){return this.empowerCardsListView.active}},{key:"IsSelected",get:function(){return this.empowerCardsListLayout.getComponentsInChildren(f).some((function(e){var t;return null==(t=e.getComponentInChildren(l))?void 0:t.isChecked}))}}],[{key:"instance",get:function(){return this._instance}}]),t}(u))._instance=null,D=t((k=R).prototype,"empowerCardsListView",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(k.prototype,"empowerCardsListLayout",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(k.prototype,"empowerCardsListItem",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(k.prototype,"popupWindow",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=k))||I));c._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"29c0cmZm51PGI1hR+HUjJiK","EmpowerData",void 0);t("EmpowerData",function(){function t(t,e,i){this._id=void 0,this._name=void 0,this._triggers=[],this._id=t,this._name=e,this._triggers=i}return t.fromCSV=function(e){return new t(e.id,e.name,e.triggers)},e(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"triggers",get:function(){return this._triggers}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(e){var r,a,t,n;return{setters:[function(e){r=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,t=e._decorator},function(e){n=e.GameManager}],execute:function(){var o,s;a._RF.push({},"a7abbEaJMtIgb6pw2B6UKeL","EmpowerManager",void 0);var u=t.ccclass;e("EmpowerManager",u("EmpowerManager")(((s=function(){function e(){}return e.loadEmpowerData=function(){this.empowers=n.instance.database.empowerDatabase},e.triggerEmpower=function(e){for(var a,t=r(this.empowers);!(a=t()).done;){var n=a.value;n.triggers.every((function(r){return e.some((function(e){if(r.type===e.type){var a=r.key===e.key;switch(r.type){case"equip":return a&&r.value.indexOf(e.value)>=0;case"ability_score":return a&&Number(r.value)<=Number(e.value);case"skill":return a&&r.value===e.value;default:return!1}}}))}))&&(this.empowerIds.has(n.id)||this.empowerIds.add(n.id))}},e.getEmpoweredIds=function(){return Array.from(this.empowerIds)},e.getEmpoweredCardDataList=function(){var e=this;return n.instance.database.empowerCardDatabase.filter((function(r){return Array.from(e.empowerIds).includes(r.empowerId)}))},e}()).empowers=[],s.empowerIds=new Set,o=s))||o);a._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerRankItem.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,r,i,o,a,p,s,l,c,u,m,h;return{setters:[function(e){n=e.inheritsLoose,t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,p=e.Node,s=e.Event,l=e.Label,c=e.Sprite,u=e.Color,m=e.instantiate,h=e.Component}],execute:function(){var k,w,R,d,g,f,_,v,E;o._RF.push({},"2ec07k7r69DEqHFSlQU9CZr","EmpowerRankItem",void 0);var b=a.ccclass,C=a.property,I=e("EmpowerRankupEvent",function(e){function t(n,t,r){var i;return(i=e.call(this,n,t)||this).detail=null,i.detail=r,i}return n(t,e),t}(s));I.EMPOWER_RANKUP_EVENT="empower-rankup-event";e("EmpowerRankItem",(k=b("EmpowerRankItem"),w=C(p),R=C(p),d=C(p),k((_=t((f=function(e){function t(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,r(n,"empowerRankMark",_,i(n)),r(n,"rankupArrow",v,i(n)),r(n,"empowerRankPrefab",E,i(n)),n._points=0,n._empowerCardRank=0,n._empowerRegimentation="",n._cost=0,n}n(t,e);var o=t.prototype;return o.setPoints=function(e){this._points=e},o.list=function(e,n){this._empowerCardRank=n,this.node.children.forEach((function(e){return e.active=!1}));var t=this.node.children.slice(0,this.node.children.length-2),r=e.shift();this._empowerRegimentation=r.regimentation,this._cost=r.cost,this.empowerRankMark.active=!0,this.empowerRankMark.getComponentInChildren(l).string=r.empowerName,r.regimentationRank===n?this.empowerRankMark.getComponentInChildren(c).color=new u(255,255,255):this.empowerRankMark.getComponentInChildren(c).color=new u(155,155,155),this.rankupArrow.active=this._points>0&&r.regimentationRank===n&&e.length>0;for(var i=0;e.length>0;){var o=e.pop(),a=t[i];a||((a=m(this.empowerRankPrefab)).parent=this.node),a.active=!0,a.getComponentInChildren(l).string=o.empowerName,i++}this.empowerRankMark.setSiblingIndex(999),this.rankupArrow.setSiblingIndex(this.empowerRankMark.getSiblingIndex()-1)},o.onRankupClicked=function(){console.log("Rankup clicked",this._points,"/",this._cost),this.node.dispatchEvent(new I(I.EMPOWER_RANKUP_EVENT,!0,{regimentation:this._empowerRegimentation,rank:this._empowerCardRank,cost:this._cost}))},t}(h)).prototype,"empowerRankMark",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(f.prototype,"rankupArrow",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(f.prototype,"empowerRankPrefab",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=f))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/EmpowerRankPnael.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./EmpowerRankItem.ts","./EmpowerCardsListItem.ts","./EmpowerCombatCardList.ts","./PopupWindowComponent.ts","./ToolTipManager.ts"],(function(e){var t,n,a,r,o,i,p,c,u,s,l,m,w,b,d,f,h,C,k,R;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){p=e.cclegacy,c=e._decorator,u=e.Layout,s=e.Node,l=e.Label,m=e.Component,w=e.instantiate},function(e){b=e.GameManager},function(e){d=e.EmpowerRankItem,f=e.EmpowerRankupEvent},function(e){h=e.EmpowerCardsListItem},function(e){C=e.EmpowerCombatCardList},function(e){k=e.PopupWindowComponent},function(e){R=e.ToolTipManager}],execute:function(){var v,g,E,P,y,I,D,L,_,x,z,M,B,T,W,A,O,j,F,G,N;p._RF.push({},"22883m6yxpKMJdfg8lkvJFQ","EmpowerRankPnael",void 0);var S=c.ccclass,J=c.property;e("EmpowerRankPnael",(v=S("EmpowerRankPnael"),g=J(u),E=J(d),P=J(s),y=J(s),I=J(h),D=J(h),L=J(s),_=J(l),x=J(k),v((B=t((M=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,a(t,"empowerRankRoot",B,r(t)),a(t,"empowerRankItem",T,r(t)),a(t,"rankupCombatCardPanel",W,r(t)),a(t,"rankupButtonRoot",A,r(t)),a(t,"currEmpowerCardItem",O,r(t)),a(t,"nextEmpowerCardItem",j,r(t)),a(t,"rankupArrow",F,r(t)),a(t,"pointsLabel",G,r(t)),a(t,"popupWindow",N,r(t)),t._empowerRegimentation="",t._empowerRankupCost=0,t}n(t,e);var p=t.prototype;return p.onLoad=function(){var e=this;this.node.on(f.EMPOWER_RANKUP_EVENT,(function(t){t.propagationStopped=!0,e.rankupCombatCardPanel.active=!0,e.rankupButtonRoot.active=!0;var n=t.detail,a=n.regimentation,r=n.rank,o=n.cost;e._empowerRegimentation=a,e._empowerRankupCost=o,e.currEmpowerCardItem.node.active=!1,e.nextEmpowerCardItem.node.active=!1,e.rankupArrow.active=!1,b.instance.database.empowerCardDatabase.some((function(t){a===t.regimentation&&(r===t.regimentationRank?(e.currEmpowerCardItem.node.active=!0,e.currEmpowerCardItem.list(t)):r+1===t.regimentationRank&&(e.nextEmpowerCardItem.node.active=!0,e.rankupArrow.active=!0,e.nextEmpowerCardItem.list(t)),e.pointsLabel.string="(需花費"+e._empowerRankupCost+"升級)\n可用升級: "+b.instance.characterCombatData.empowerPoints+" 點")}))})),this.rankupCombatCardPanel.active=!1,this.rankupButtonRoot.active=!1},p.list=function(){var e=o(i().mark((function e(t){var n,a,r,o,p,c=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=.1),e.next=3,new Promise((function(e){return c.scheduleOnce(e,t)}));case 3:if(n=b.instance.database.empowerCardDatabase,0!==Object.keys(n).length){e.next=7;break}return t<.5&&this.list(t+.1),e.abrupt("return");case 7:a=b.instance.characterCombatData.getEmpowerCardRanks(),r=n.filter((function(e){var t=a[e.regimentation];return!t||t<=e.regimentationRank})),o={},r.forEach((function(e){var t=e.regimentation;o[t]||(o[t]=[]),o[t].push(e)})),(p=this.empowerRankRoot.node.children).forEach((function(e){return e.active=!1})),Object.values(o).forEach((function(e,t){var n=p[t];n||((n=w(c.empowerRankItem.node)).parent=c.empowerRankRoot.node),n.active=!0;var r=a[e[0].regimentation]||Math.max(0,e[0].regimentationRank-1),o=n.getComponent(d);o.setPoints(b.instance.characterCombatData.empowerPoints),o.list(e.flat(),r)}));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),p.onUIShowClicked=function(){this.node.active=!this.node.active,this.node.active?(this.list(),this.pointsLabel.string="可用升級: "+b.instance.characterCombatData.empowerPoints+" 點"):(C.instance.list(),R.instance.hide())},p.onRankupComfirmClicked=function(){var e=b.instance.characterCombatData.empowerPoints;e>0?(b.instance.characterCombatData.tryIncreaseEmpowerCardRank(this._empowerRegimentation,1,this._empowerRankupCost)?(b.instance.characterCombatData.empowerPoints-=this._empowerRankupCost,b.instance.characterCombatData.write(),e=b.instance.characterCombatData.empowerPoints,this.list()):this.popupWindow.openPopup("升級失敗","升級所需的點數不足",[{label:"知道了",callback:null}]),this.pointsLabel.string="可用升級: "+e+" 點",this.rankupCombatCardPanel.active=!1,this.rankupButtonRoot.active=!1):this.popupWindow.openPopup("您沒有點數","可進行爬塔攻略或打怪升級獲得點數",[{label:"知道了",callback:null}]),R.instance.hide()},p.onRankupCancelClicked=function(){this.rankupCombatCardPanel.active=!1,this.rankupButtonRoot.active=!1;var e=b.instance.characterCombatData.empowerPoints;this.pointsLabel.string="可用升級: "+e+" 點",R.instance.hide()},t}(m)).prototype,"empowerRankRoot",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(M.prototype,"empowerRankItem",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(M.prototype,"rankupCombatCardPanel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(M.prototype,"rankupButtonRoot",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(M.prototype,"currEmpowerCardItem",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(M.prototype,"nextEmpowerCardItem",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(M.prototype,"rankupArrow",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(M.prototype,"pointsLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(M.prototype,"popupWindow",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=M))||z));p._RF.pop()}}}));

System.register("chunks:///_virtual/Enemy.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StorageTool.ts","./Character.ts"],(function(t){var e,n,r,o,i;return{setters:[function(t){e=t.inheritsLoose,n=t.assertThisInitialized},function(t){r=t.cclegacy},function(t){o=t.StorageTool},function(t){i=t.Character}],execute:function(){r._RF.push({},"a89beDtwgdJ5KZrBZwJL80d","Enemy",void 0);t("Enemy",function(t){function r(e){var r,i=o.loadFromFile(e+"_character_data");return i&&(r=t.call(this,i)||this),n(r)}return e(r,t),r}(i));r._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e;return{setters:[function(t){i=t.createClass},function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"28b50fCDddFEoSFzDbmRP9j","EnemyData",void 0);t("EnemyData",function(){function t(t,i,e,n,s,r,o,c){this._id=void 0,this._name=void 0,this._hp=void 0,this._ac=void 0,this._wisdom=void 0,this._resilience=void 0,this._dexterity=void 0,this._img=void 0,this._id=t,this._name=i,this._hp=e,this._ac=n,this._wisdom=s,this._resilience=r,this._dexterity=o,this._img=c}return t.fromCSV=function(i){var e=parseInt(i.hp,10),n=parseInt(i.ac,10),s=parseInt(i.wisdom,10),r=parseInt(i.resilience,10),o=parseInt(i.dexterity,10);return new t(i.id,i.name,e,n,s,r,o,i.img)},i(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"hp",get:function(){return this._hp}},{key:"ac",get:function(){return this._ac}},{key:"wisdom",get:function(){return this._wisdom}},{key:"resilience",get:function(){return this._resilience}},{key:"dexterity",get:function(){return this._dexterity}},{key:"img",get:function(){return this._img}}]),t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyTeamData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t;return{setters:[function(e){n=e.createClass},function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"2779ecWOjNL5IJSqyNH68qJ","EnemyTeamData",void 0);e("EnemyTeamData",function(){function e(e,n,t,i,r){this._id=void 0,this._challengeRank=void 0,this._enemies=void 0,this._escapeReward=void 0,this._endReward=void 0,this._id=e,this._challengeRank=n,this._escapeReward=this.parseReward(t),this._endReward=this.parseReward(i),this._enemies=r}return e.prototype.parseReward=function(e){var n=e.split(" | "),t={};return n.forEach((function(e){var n=e.split(" x"),i=n[0],r=n[1];t[i]=parseInt(r)})),t},e.fromCSV=function(n){var t=parseInt(n.challengeRank),i=n.escapeReward,r=n.endReward;return new e(n.id,t,i,r,n.enemies)},n(e,[{key:"id",get:function(){return this._id}},{key:"cr",get:function(){return this._challengeRank}},{key:"enemies",get:function(){return this._enemies}},{key:"escapeReward",get:function(){return this._escapeReward}},{key:"endReward",get:function(){return this._endReward}}]),e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/EquipmentDropZone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./WeaponDraggable.ts","./ArmorDraggable.ts","./ShieldDraggable.ts","./DropZone.ts"],(function(e){var n,t,i,r,o,p,a,u,l,c,m,s;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,p=e._decorator,a=e.Enum,u=e.EventHandler},function(e){l=e.WeaponDraggable},function(e){c=e.ArmorDraggable},function(e){m=e.ShieldDraggable},function(e){s=e.DropZone}],execute:function(){var f,E,h,g,v,b,q,d,y,D,T,Z;o._RF.push({},"a3adfkKUFhPtb2tHmzEtFBZ","EquipmentDropZone",void 0);var z=p.ccclass,S=p.property,I=e("EquipmentDropZoneType",function(e){return e[e.None=0]="None",e[e.WeaponOrShield=1]="WeaponOrShield",e[e.Armor=2]="Armor",e}({}));a(I);e("EquipmentDropZone",(f=z("EquipmentDropZone"),E=S(u),h=S(u),g=S(u),v=S({type:I}),f((d=n((q=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),p=0;p<t;p++)o[p]=arguments[p];return n=e.call.apply(e,[this].concat(o))||this,i(n,"equipmentEvent",d,r(n)),i(n,"unequipmentEvent",y,r(n)),i(n,"inappropriateEqipmentEvent",D,r(n)),i(n,"equipmentType",T,r(n)),i(n,"serialIndex",Z,r(n)),n}t(n,e);var o=n.prototype;return o.onDrop=function(n){var t=this,i=n.draggableItem;n.dropZone;return this.equipmentType===I.WeaponOrShield&&i instanceof l||this.equipmentType===I.Armor&&i instanceof c||this.equipmentType===I.WeaponOrShield&&i instanceof m?(e.prototype.onDrop.call(this,n),i.equipmentType=this.equipmentType,void this.equipmentEvent.forEach((function(e){return e.emit([t.item])}))):(i.resetPosition(),void this.inappropriateEqipmentEvent.forEach((function(e){return e.emit([i.Item])})))},o.onEquipmentEvent=function(e){console.log("穿戴裝備:",e.name)},o.onUnequipmentEvent=function(e){console.log("脫下裝備:",null==e?void 0:e.name)},o.onInappropriateEqipmentEvent=function(e){console.log("不適合裝備:",null==e?void 0:e.name)},o.dropOut=function(e){this.unequipmentEvent.forEach((function(n){return n.emit([e.Item])}))},n}(s)).prototype,"equipmentEvent",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),y=n(q.prototype,"unequipmentEvent",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),D=n(q.prototype,"inappropriateEqipmentEvent",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),T=n(q.prototype,"equipmentType",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return I.WeaponOrShield}}),Z=n(q.prototype,"serialIndex",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b=q))||b));o._RF.pop()}}}));

System.register("chunks:///_virtual/FloatingTextComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,o,r,a,l,s,u,c,p,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.Color,s=t.Vec3,u=t.Label,c=t.instantiate,p=t.tween,f=t.Component}],execute:function(){var h,g,b,m,v,d,y,C,P,w,_,x,B;r._RF.push({},"6e930lNmNxI/bj5j7OKSnzK","FloatingTextComponent",void 0);var L=a.ccclass,z=a.property;t("FloatingTextComponent",(h=L("FloatingTextComponent"),g=z(l),b=z(l),m=z(s),v=z(s),d=z(u),h((P=e((C=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"positiveColor",P,o(e)),i(e,"negativeColor",w,o(e)),i(e,"startPoint",_,o(e)),i(e,"endPoint",x,o(e)),i(e,"templateLabel",B,o(e)),e._numBuffer=[],e._textBuffer=[],e}n(e,t);var r=e.prototype;return r.onLoad=function(){this.templateLabel.node.active=!1},r.showNumber=function(t,e,n,i){var o=this;void 0===n&&(n=.5),void 0===i&&(i="");var r=c(this.templateLabel.node);r.setParent(this.node),this._numBuffer.push(t),p(r).delay(n*(this._numBuffer.length-1)).call((function(){r.active=!0;var e=r.getComponent(u);e.string=(t>0?"+":"")+t.toString()+(i?" "+i:""),e.color=t>0?o.positiveColor:o.negativeColor,r.setPosition(o.startPoint)})).to(1.5,{position:this.endPoint},{easing:"elasticOut"}).call((function(){o._numBuffer.shift(),r.destroy(),null==e||e()})).start()},r.showText=function(t,e,n){var i=this;void 0===n&&(n=.5);var o=c(this.templateLabel.node);o.setParent(this.node),this._textBuffer.push(t),p(o).delay(n*(this._textBuffer.length-1)).call((function(){o.active=!0,o.getComponent(u).string=t,o.setPosition(i.startPoint)})).to(1.5,{position:this.endPoint},{easing:"elasticOut"}).call((function(){i._textBuffer.shift(),o.destroy(),null==e||e()})).start()},e}(f)).prototype,"positiveColor",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(0,255,0)}}),w=e(C.prototype,"negativeColor",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(255,0,0)}}),_=e(C.prototype,"startPoint",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new s(0,0,0)}}),x=e(C.prototype,"endPoint",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new s(0,100,0)}}),B=e(C.prototype,"templateLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=C))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/GameDatabase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CSVLoader.ts","./EmpowerCardData.ts","./CombatCardData.ts","./CombatEffectData.ts","./EnemyData.ts","./EnemyTeamData.ts","./AiIntentData.ts","./TeachConversationData.ts","./TowerData.ts"],(function(a){var t,e,n,o,r,i,s,c,u,d,m;return{setters:[function(a){t=a.createClass},function(a){e=a.cclegacy},function(a){n=a.CSVLoader},function(a){o=a.EmpowerCardData},function(a){r=a.CombatCardData},function(a){i=a.CombatEffectData},function(a){s=a.EnemyData},function(a){c=a.EnemyTeamData},function(a){u=a.AiIntentData},function(a){d=a.TeachConversationData},function(a){m=a.TowerData}],execute:function(){e._RF.push({},"814245g0y1A567rYQuvik/O","GameDatabase",void 0);a("GameDatabase",function(){function a(){this._weaponDatabase=void 0,this._armorDatabase=void 0,this._empowerDatabase=[],this._empowerCardDatabase=[],this._combatCardDatabase=[],this._combatEffectDatabase=[],this._enemyTeamDatabase=[],this._enemyDatabase=[],this._aiIntentDatabase=[],this._teachConversationDatabase=[],this._towerDatabase=[],this._itemDatabase=[],this.loadWeaponData(),this.loadArmorData(),this.loadEmpowerCardData(),this.loadCombatCardData(),this.loadCombatEffectData(),this.loadEnemyTeamData(),this.loadEnemyData(),this.loadeAiIntentData(),this.loadTeachConversationData(),this.loadTowerData(),this.loadItemData()}var e=a.prototype;return e.loadWeaponData=function(){var a=this;n.loadCSV("data/weapons",(function(t){a._weaponDatabase=t}))},e.loadArmorData=function(){var a=this;n.loadCSV("data/armors",(function(t){a._armorDatabase=t}))},e.loadEmpowerData=function(){var a=this;n.loadCSV("data/empower",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,name:a.name,trigger:[]}),n[t].trigger.push({type:a.trigger_type,key:a.trigger_key,value:a.trigger_value,description:a.description})})),(e=a._empowerDatabase).push.apply(e,Object.values(n))}))},e.loadEmpowerCardData=function(){var a=this;n.loadCSV("data/empower_card",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={regimentation:a.regimentation,rank:parseInt(a.rank,10),id:a.id,name:a.name,cost:a.cost,cards:[]}),n[t].cards.push({id:a.card_id,name:a.card_name,num:parseInt(a.card_num,10)})})),(e=a._empowerCardDatabase).push.apply(e,Object.values(n).map((function(a){return o.fromCSV(a)})))}))},e.loadCombatCardData=function(){var a=this;n.loadCSV("data/combat_card",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,name:a.name,range:a.range,feeType:a.fee_type,fee:a.fee,effects:[],description:[],evolutions:[]}),a.evolution_conditions?n[t].evolutions.push({conditions:a.evolution_conditions,name:a.name,range:a.range,feeType:a.fee_type,fee:a.fee,effectId:a.effect_id,effectName:a.effect_name}):(n[t].effects.push({id:a.effect_id,name:a.effect_name}),n[t].description.push(a.description))})),(e=a._combatCardDatabase).push.apply(e,Object.values(n).map((function(a){return r.fromCSV(a)})))}))},e.loadCombatEffectData=function(){var a=this;n.loadCSV("data/combat_effect",(function(t){a._combatEffectDatabase=t.map((function(a){return i.fromCSV(a)}))}))},e.loadEnemyTeamData=function(){var a=this;n.loadCSV("data/enemy_team",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,challengeRank:a.challenge_rank,escapeReward:a.escape_reward,endReward:a.end_reward,enemies:[]}),n[t].enemies.push(a.enemy_id)})),(e=a._enemyTeamDatabase).push.apply(e,Object.values(n).map((function(a){return c.fromCSV(a)})))}))},e.loadEnemyData=function(){var a=this;n.loadCSV("data/enemy",(function(t){a._enemyDatabase=t.map((function(a){return s.fromCSV(a)}))}))},e.loadeAiIntentData=function(){var a=this;n.loadCSV("data/ai_intent",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,intents:[]}),n[t].intents.push(a.intent)})),(e=a._aiIntentDatabase).push.apply(e,Object.values(n).map((function(a){return u.fromCSV(a)})))}))},e.loadTeachConversationData=function(){var a=this;n.loadCSV("data/teach_conversation",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,name:a.name,round:a.round,battleBeginContent:[],battleEndContent:[],battleEscapeContent:[],roundBeginContent:[],underattackContent:[],underdamageContent:[]}),a.battle_begin&&n[t].battleBeginContent.push(a.battle_begin),a.battle_end&&n[t].battleEndContent.push(a.battle_end),a.escape&&n[t].battleEscapeContent.push(a.escape),a.round_begin&&n[t].roundBeginContent.push(a.round_begin),a.underattack&&n[t].underattackContent.push(a.underattack),a.damage&&n[t].underdamageContent.push(a.damage)})),(e=a._teachConversationDatabase).push.apply(e,Object.values(n).map((function(a){return d.fromCSV(a)})))}))},e.loadTowerData=function(){var a=this;n.loadCSV("data/tower",(function(t){var e,n={};t.forEach((function(a){var t=a.id;n[t]||(n[t]={id:a.id,name:a.name,challengeRank:a.challenge_rank,rewards:a.rewards,icon:a.icon,enemyTeams:[],events:[],chests:[]}),a.enemy_team&&n[t].enemyTeams.push(a.enemy_team),a.event&&n[t].events.push(a.event),a.chest&&n[t].chests.push(a.chest)})),(e=a._towerDatabase).push.apply(e,Object.values(n).map((function(a){return m.fromCSV(a)})))}))},e.loadItemData=function(){var a=this;n.loadCSV("data/item",(function(t){a._itemDatabase=t}))},t(a,[{key:"weaponDatabase",get:function(){return this._weaponDatabase}},{key:"armorDatabase",get:function(){return this._armorDatabase}},{key:"empowerDatabase",get:function(){return this._empowerDatabase}},{key:"empowerCardDatabase",get:function(){return this._empowerCardDatabase}},{key:"combatCardDatabase",get:function(){return this._combatCardDatabase}},{key:"combatEffectDatabase",get:function(){return this._combatEffectDatabase}},{key:"enemyTeamDatabase",get:function(){return this._enemyTeamDatabase}},{key:"enemyDatabase",get:function(){return this._enemyDatabase}},{key:"aiIntentDatabase",get:function(){return this._aiIntentDatabase}},{key:"teachConversationDatabase",get:function(){return this._teachConversationDatabase}},{key:"towerDatabase",get:function(){return this._towerDatabase}},{key:"itemDatabase",get:function(){return this._itemDatabase}}]),a}());e._RF.pop()}}}));

System.register("chunks:///_virtual/GameLobby.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./Tower.ts","./StorageTool.ts","./InventoryCollection.ts","./StoreDropZone.ts","./CharacterInfo.ts","./BackpackDropZone.ts","./BeltDropZone.ts","./PixelImage.ts","./Inventory.ts"],(function(e){var t,n,o,r,i,a,c,l,s,u,p,g,h,f,d,v,y,C,b,I,m,k,w,D;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,c=e.Layout,l=e.instantiate,s=e.Label,u=e.Sprite,p=e.Color,g=e.ScrollView,h=e.randomRangeInt,f=e.Component},function(e){d=e.GameManager},function(e){v=e.Tower},function(e){y=e.StorageTool},function(e){C=e.InventoryCollection},function(e){b=e.StoreDropZone},function(e){I=e.CharacterInfo},function(e){m=e.BackpackDropZone},function(e){k=e.BeltDropZone},function(e){w=e.PixelImage},function(e){D=e.Inventory}],execute:function(){var S,L,T,R,_,B,z,E,P,q,x,H,M,G,Z;i._RF.push({},"56de1sCWexHh5PQ9xkHW6lp","GameLobby",void 0);var F=a.ccclass,U=a.property;e("GameLobby",(S=F("GameLobby"),L=U(c),T=U(v),R=U(C),_=U(C),B=U(C),z=U(I),S((q=t((P=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,o(t,"towerCardLayout",q,r(t)),o(t,"tower",x,r(t)),o(t,"storeInventoryCollection",H,r(t)),o(t,"backpackInventoryCollection",M,r(t)),o(t,"beltInventoryCollection",G,r(t)),o(t,"characterInfo",Z,r(t)),t._towerDatabase=[],t}n(t,e);var i=t.prototype;return i.onLoad=function(){},i.start=function(){this._towerDatabase=d.instance.database.towerDatabase,this.updateTowerCards(),this.store()},i.updateTowerCards=function(){var e,t=this,n=this.towerCardLayout.node.children;n.forEach((function(e){return e.active=!1}));var o=-1,r=l(n[0]);this._towerDatabase.forEach((function(e,i){var a=n[i];a||((a=l(r)).parent=t.towerCardLayout.node),a.active=!0,a.getComponentInChildren(s).string=e.name+"\n 挑戰難度:"+e.challengeRank,a.getComponentInChildren(w).setSpriteFrame(e.icon),a.off("click"),a.on("click",(function(){t.tower.build(e.id,e.icon),t.tower.show(),t.node.active=!1}));var c=y.loadFromFile(e.id+"_tower_data");c&&c.index===c.stage.length?a.getComponent(u).color=new p(255,255,255,128):-1===o&&(o=i),t.tower.towerId===e.id&&(o=i)})),r.destroy();var i=0,a=n.filter((function(e){return e.active})).length;a>0&&(i=o/a),null==(e=this.node.getComponentInChildren(g))||e.scrollToPercentHorizontal(i,.25,!0),console.log("percent:",i)},i.store=function(){var e=this;this.storeInventoryCollection.getComponent(D).clear(),this.storeInventoryCollection.getComponentsInChildren(b).forEach((function(e){e.clear()}));var t=h(1,4);this.getStoreTestData().sort((function(){return.5-Math.random()})).slice(0,t).forEach((function(t){t&&e.storeInventoryCollection.collect(t)}))},i.getStoreTestData=function(){return[{string:"斧",type:"weapon",coping:"Handaxe"},{string:"匕首",type:"weapon",coping:"Dagger"},{string:"輕錘",type:"weapon",coping:"LightHammer"},{string:"皮甲",type:"armor",coping:"Rawhide"},{string:"綿甲",type:"armor",coping:"Padded"},{string:"鎖子甲",type:"armor",coping:"ChainMail"},{string:"血瓶",type:"groceries",coping:"hp_potion",value:"1"},{string:"血瓶",type:"groceries",coping:"hp_potion",value:"1"},{string:"血瓶",type:"groceries",coping:"hp_potion",value:"1"},{string:"止血帶",type:"groceries",coping:"tourniquet",value:"5"},{string:"止血帶",type:"groceries",coping:"tourniquet",value:"5"},{string:"止血帶",type:"groceries",coping:"tourniquet",value:"5"},{string:"止血帶",type:"groceries",coping:"tourniquet",value:"5"},{string:"止血帶",type:"groceries",coping:"tourniquet",value:"5"},{string:"止血帶",type:"groceries",coping:"tourniquet",value:"5"},{string:"止血帶",type:"groceries",coping:"tourniquet",value:"5"}]},i.updateStorePurchases=function(){var e=d.instance.CharacterRaidData.Money;this.characterInfo.updateMoney(),this.storeInventoryCollection.getComponentsInChildren(b).forEach((function(t){t.checkValue(e)}))},i.saveBackpack=function(){var e=this;this.scheduleOnce((function(){var t=[];e.backpackInventoryCollection.getComponentsInChildren(m).forEach((function(e){var n=e.ItemTipCard;console.log("backpack tipCard:",n),n&&t.push(n)}));var n=[];e.beltInventoryCollection.getComponentsInChildren(k).forEach((function(e){var t=e.ItemTipCard;console.log("belt tipCard:",t),t&&n.push(t)})),d.instance.CharacterRaidData.updateBackpack(t),d.instance.CharacterRaidData.updateBelt(n),d.instance.CharacterRaidData.write()}),.5)},i.loadBackpack=function(){var e=this,t=d.instance.CharacterRaidData.getBackpack();console.log("load backpackTipCards:",t),t.forEach((function(t){e.backpackInventoryCollection.collect(t)})),d.instance.CharacterRaidData.getBelt().forEach((function(t){e.beltInventoryCollection.collect(t)}))},i.onShowStoreUI=function(){this.storeInventoryCollection.node.active?(this.backpackInventoryCollection.node.active=!1,this.storeInventoryCollection.node.active=!1):(this.backpackInventoryCollection.node.active=!0,this.storeInventoryCollection.node.active=!0),this.beltInventoryCollection.node.active=!1},i.onHideStoreUI=function(){this.storeInventoryCollection.node.active=!1},i.onRefreshStoreClicked=function(){this.store()},t}(f)).prototype,"towerCardLayout",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(P.prototype,"tower",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(P.prototype,"storeInventoryCollection",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(P.prototype,"backpackInventoryCollection",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(P.prototype,"beltInventoryCollection",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(P.prototype,"characterInfo",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=P))||E));i._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameDatabase.ts","./CharacterCombatData.ts","./CharacterRaidData.ts","./GameLobby.ts"],(function(a){var t,e,r,n,i,c,o,s,h,u,b,l,d;return{setters:[function(a){t=a.applyDecoratedDescriptor,e=a.inheritsLoose,r=a.initializerDefineProperty,n=a.assertThisInitialized,i=a.createClass},function(a){c=a.cclegacy,o=a._decorator,s=a.Node,h=a.Component},function(a){u=a.GameDatabase},function(a){b=a.CharacterCombatData},function(a){l=a.CharacterRaidData},function(a){d=a.GameLobby}],execute:function(){var p,m,D,y,f,C;c._RF.push({},"6dcbd1szwBNRLtMHywedW9x","GameManager",void 0);var _=o.ccclass,g=o.property;a("GameManager",(p=_("GameManager"),m=g(s),p(((C=function(a){function t(){for(var t,e=arguments.length,i=new Array(e),c=0;c<e;c++)i[c]=arguments[c];return t=a.call.apply(a,[this].concat(i))||this,r(t,"lobby",f,n(t)),t._characterCombatData=null,t._characterRaidData=null,t.database=void 0,t}e(t,a);var c=t.prototype;return c.onLoad=function(){t._instance?this.destroy():(t._instance=this,this.database=new u)},c.showLobbyUI=function(a){void 0===a&&(a=!0),this.lobby.active=a;var t=this.lobby.getComponent(d);t&&(t.updateTowerCards(),t.updateStorePurchases())},i(t,[{key:"characterCombatData",get:function(){return this._characterCombatData||(this._characterCombatData=new b,this.characterCombatData.empowerCardDatabase=this.database.empowerCardDatabase),this._characterCombatData}},{key:"CharacterRaidData",get:function(){return this._characterRaidData||(this._characterRaidData=new l),this._characterRaidData}}],[{key:"instance",get:function(){return this._instance}}]),t}(h))._instance=null,f=t((y=C).prototype,"lobby",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=y))||D));c._RF.pop()}}}));

System.register("chunks:///_virtual/GameSetup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./PopupWindowComponent.ts","./AudioManager.ts","./CardPreview.ts","./RewardInteraction.ts","./CardComponent.ts","./CharacterInfo.ts","./EmpowerCombatCardList.ts","./Tower.ts","./GameLobby.ts","./Debug.ts"],(function(e){var n,t,a,i,o,r,c,l,s,u,d,m,p,b,h,f,w,C,g,v,y,I,P;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,a=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,r=e._decorator,c=e.Button,l=e.Node,s=e.randomRangeInt,u=e.instantiate,d=e.Label,m=e.Component},function(e){p=e.GameManager},function(e){b=e.PopupWindowComponent},function(e){h=e.AudioManager},function(e){f=e.CardPreview},function(e){w=e.RewardInteraction},function(e){C=e.CardComponent},function(e){g=e.CharacterInfo},function(e){v=e.EmpowerCombatCardList},function(e){y=e.Tower},function(e){I=e.GameLobby},function(e){P=e.Debug}],execute:function(){var _,R,D,E,k,G,z,L,M,S,B,A,T,W,x,N,U,j,F,H,J,K,O;o._RF.push({},"bb2ffInL51HnKcJWJ6pe0DS","GameSetup",void 0);var q=r.ccclass,Q=r.property;e("GameSetup",(_=q("GameSetup"),R=Q(f),D=Q(g),E=Q(b),k=Q(w),G=Q(C),z=Q(c),L=Q(l),M=Q(y),S=Q(I),B=Q(l),_((W=n((T=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return n=e.call.apply(e,[this].concat(o))||this,a(n,"cardPreview",W,i(n)),a(n,"characterInfo",x,i(n)),a(n,"popupWindow",N,i(n)),a(n,"rewardInteraction",U,i(n)),a(n,"cardComponent",j,i(n)),a(n,"resumeGameButton",F,i(n)),a(n,"mainPanel",H,i(n)),a(n,"tower",J,i(n)),a(n,"lobby",K,i(n)),a(n,"logReviewPanel",O,i(n)),n._empowerCombatCards={},n._teach=[],n._teachCount=0,n._musicEnabled=!0,n._soundEnabled=!0,n}t(n,e);var o=n.prototype;return o.start=function(){var e=this;this.resumeGameButton.node.active=!1,p.instance.characterCombatData.read(),this.characterInfo.updateMoney(),this.scheduleOnce((function(){var n=p.instance.CharacterRaidData.CombatParam.maxExp+p.instance.CharacterRaidData.CombatParam.curExp;console.log(n),(e.tower.tryReadChallengeTower()||n>2)&&(e.resumeGameButton.node.active=!0,e.characterInfo.avaliableAbilityPoints=p.instance.CharacterRaidData.AvaliableAbilityPoints,e.lobby.loadBackpack())}),.5),this.mainPanel.active=!0,p.instance.showLobbyUI(!1)},o.onInteractionClick=function(){var e=this.rewardInteraction.data,n=e[s(0,e.length)],t=u(this.cardComponent.node),a=t.getComponent(C);a._cardId=n.id,a._cardName=n.name,a._cardIcon=n.img,a.description=n.dialogue,this.cardPreview.refresh(t),this.cardPreview.listReward(n.rewards,{money_1:p.instance.CharacterRaidData.Money})},o.onInteractionClick2=function(){var e=u(this.cardComponent.node),n=e.getComponent(C);n._cardId="chest_1",n._cardName="寶箱",n.setIcon("chest"),n.description="寶箱裡總會有好東西";this.cardPreview.refresh(e),this.cardPreview.listReward([{id:"money_1",name:"金幣",img:"money",amount:20}],{money_1:p.instance.CharacterRaidData.Money})},o.onDeckIconClick=function(){if(!v.instance.IsActive)v.instance.list();else{if(!v.instance.IsSelected)return void this.popupWindow.openPopup("提醒您","請至少選一項賦能",[{label:"確定",callback:null}]);v.instance.hide(),v.instance.updateEmpowerCombatCardsByCardSelected(),v.instance.saveData()}},o.onMusicToggleClick=function(){this._musicEnabled=!this._musicEnabled,h.instance.setMusicEnabled(this._musicEnabled)},o.onSoundToggleClick=function(){this._soundEnabled=!this._soundEnabled,h.instance.setSoundEffectsEnabled(this._soundEnabled)},o.onNewGameClicked=function(){var e=this;this.mainPanel.active=!1,p.instance.characterCombatData.reset(),p.instance.CharacterRaidData.reset(),this.characterInfo.updateMoney(),this.characterInfo.updateStatus(),p.instance.database.towerDatabase.forEach((function(n){e.tower.delData(n.id)})),p.instance.showLobbyUI(),p.instance.characterCombatData.notifyEmpowerPoints()},o.onResumeGameClicked=function(){""!=this.tower.towerId?(this.mainPanel.active=!1,this.tower.show()):(this.mainPanel.active=!1,p.instance.showLobbyUI()),p.instance.characterCombatData.notifyEmpowerPoints()},o.onTeachRestartClicked=function(){},o.onLogReviewClicked=function(){this.logReviewPanel.active=!this.logReviewPanel.active,this.logReviewPanel.active&&(this.logReviewPanel.getComponentInChildren(d).string=P.getInstance().records.join("\n"))},n}(m)).prototype,"cardPreview",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(T.prototype,"characterInfo",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(T.prototype,"popupWindow",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=n(T.prototype,"rewardInteraction",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=n(T.prototype,"cardComponent",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(T.prototype,"resumeGameButton",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=n(T.prototype,"mainPanel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=n(T.prototype,"tower",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=n(T.prototype,"lobby",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=n(T.prototype,"logReviewPanel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=T))||A));o._RF.pop()}}}));

System.register("chunks:///_virtual/GraphicsLineDrawer.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,r,n,t,a,o,l,c,s,h,p;return{setters:[function(e){i=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Node,c=e.Graphics,s=e.Vec3,h=e.randomRangeInt,p=e.Component}],execute:function(){var u,f,g,d,w,y,_,v;a._RF.push({},"e0e0fhzL69JuKnuWTCWLWHY","GraphicsLineDrawer",void 0);var L=o.ccclass,b=o.property;e("GraphicsLineDrawer",(u=L("GraphicsLineDrawer"),f=b(l),u((w=i((d=function(e){function i(){for(var i,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return i=e.call.apply(e,[this].concat(a))||this,n(i,"arror",w,t(i)),n(i,"lineLength",y,t(i)),n(i,"lineSpacing",_,t(i)),n(i,"lineWidth",v,t(i)),i._fromNode=null,i._graphics=null,i}r(i,e);var a=i.prototype;return a.onLoad=function(){this._graphics=this.getComponent(c)},a.drawDashedLine=function(e){this._fromNode=e,this._graphics.clear();var i=this.arror.worldPosition,r=this._fromNode.worldPosition,n=s.distance(i,r),t=0;this._graphics.lineWidth=this.lineWidth,this._graphics.moveTo(i.x,i.y);for(var a=new s(h(-3,3),h(-3,3),0);t<n;){var o=t+this.lineLength;o>n&&(o=n);var l=t/n,c=o/n,p=s.lerp(new s,i,r,l);s.lerp(new s,i,r,c);if(this._graphics.lineTo(p.x+a.x,p.y+a.y),this._graphics.stroke(),(t=o+this.lineSpacing)<n){var u=s.lerp(new s,i,r,t/n);this._graphics.moveTo(u.x,u.y)}}},a.clearDashedLine=function(){this._graphics.clear()},i}(p)).prototype,"arror",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=i(d.prototype,"lineLength",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),_=i(d.prototype,"lineSpacing",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),v=i(d.prototype,"lineWidth",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),g=d))||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/Groceries.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Item.ts"],(function(t){var e,i,o,r;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){o=t.cclegacy},function(t){r=t.Item}],execute:function(){o._RF.push({},"805bbhGv6BOmaS05dFPo5bZ","Groceries",void 0);t("Groceries",function(t){function o(e,i,o,r,c,n,s,u,a){var l;return(l=t.call(this,e,i,o,r,n)||this).icon=void 0,l.icon=c,l.stackLimit=s,l.effectId=u,l.description=a,l}return e(o,t),i(o,[{key:"tooltip",get:function(){var e=t.prototype.tooltip;return this.stackLimit>1&&(e+="<br/>可堆疊 ("+this.stackLimit+"/格)"),e}}]),o}(r));o._RF.pop()}}}));

System.register("chunks:///_virtual/GroceriesDraggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PixelImage.ts","./EquipmentDropZone.ts","./Draggable.ts","./DraggableDetail.ts","./Groceries.ts"],(function(e){var t,n,i,r,o,a,s,c,l;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){i=e.cclegacy,r=e._decorator},function(e){o=e.PixelImage},function(e){a=e.EquipmentDropZone},function(e){s=e.Draggable},function(e){c=e.DraggableDetail},function(e){l=e.Groceries}],execute:function(){var u;i._RF.push({},"306aa57815KLK9iKZWYj0pL","GroceriesDraggable",void 0);var m=r.ccclass;r.property,e("GroceriesDraggable",m("GroceriesDraggable")(u=function(e){function i(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._item=null,t}t(i,e);var r=i.prototype;return r.updateDisplay=function(){var e;null==(e=this.node.getComponent(c))||e.setDetail(this._item.name,this._item.amount)},r.setParent=function(t){return!(t instanceof a)&&(e.prototype.setParent.call(this,t),this.updateDisplay(),!0)},r.isSameItem=function(e){return e instanceof l&&e.id===this.Item.id},r.mergeItems=function(e){var t=e.getComponent(i);t&&(this._item.amount+=t.Amount,e.destroy())},n(i,[{key:"Item",get:function(){return this._item},set:function(e){var t,n;console.log("Groceries = ",e),this._item=e,null==(t=this.node.getComponent(o))||t.setSpriteFrame(e.icon),null==(n=this.node.getComponent(c))||n.setDetail(this._item.name,this._item.amount)}}]),i}(s))||u);i._RF.pop()}}}));

System.register("chunks:///_virtual/HandCards.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DynamicWidthScrollView.ts","./CardMover.ts","./HitBox.ts","./GraphicsLineDrawer.ts","./ToolTipManager.ts"],(function(t){var e,i,n,o,r,a,c,s,l,h,u,d,p,f,v,T,w,_,C,b,g,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){a=t.cclegacy,c=t._decorator,s=t.Node,l=t.Color,h=t.EventHandler,u=t.Label,d=t.Vec3,p=t.UIOpacity,f=t.UITransform,v=t.Button,T=t.instantiate,w=t.Component},function(t){_=t.DynamicWidthScrollView},function(t){C=t.CardMover},function(t){b=t.HitBox},function(t){g=t.GraphicsLineDrawer},function(t){m=t.ToolTipManager}],execute:function(){var y,E,S,P,V,L,x,D,H,O,U,z,M,B,I,k,A,R,N,W,F,G,j;a._RF.push({},"880f34hHldLa4t21nW2dLUl","HandCards",void 0);var Y=c.ccclass,Z=c.property;t("HandCards",(y=Y("HandCards"),E=Z(s),S=Z(_),P=Z(l),V=Z(s),L=Z(b),x=Z(h),D=Z(h),H=Z(h),O=Z(g),U=Z(u),y((B=e((M=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"cardPrefab",B,o(e)),n(e,"dwScrollView",I,o(e)),n(e,"selectedColor",k,o(e)),n(e,"arrowTip",A,o(e)),n(e,"hitBox",R,o(e)),n(e,"touchedCardEvent",N,o(e)),n(e,"playCardCheckEvent",W,o(e)),n(e,"combatCardInfoEvent",F,o(e)),n(e,"graphicsLineDrawer",G,o(e)),n(e,"tipLabel",j,o(e)),e._buttonTemps=[],e._oriColor=void 0,e._oriPositionY=void 0,e._selected=null,e._touchStartPos=null,e._oriCardPos=null,e._touchParent=null,e._selectCancel=!1,e._opacity=255,e._needTarget=!0,e._isPressing=!1,e}i(e,t);var a=e.prototype;return a.onEnable=function(){this.catchTag()},a.onDisable=function(){},a.onTouchStart=function(t){var e=this,i=t.target,n=t.getUILocation(),o=n.x,r=n.y;this._touchStartPos=new d(o,r+50,0),this._oriCardPos=i.position.clone(),this.arrowTip.setWorldPosition(this._touchStartPos),this._selectCancel=!1,this.touchedCardEvent.forEach((function(t){return t.emit([i])})),this._isPressing=!0,this.unscheduleAllCallbacks(),this.scheduleOnce((function(){e._isPressing&&(e._isPressing=!1,e.combatCardInfoEvent.forEach((function(t){return t.emit([i])})))}),1),m.instance.hide()},a.onTouchMove=function(t){if(!this._selectCancel){var e=t.target,i=t.getUIDelta();if(Math.abs(i.x)>1&&(this._isPressing=!1),!this._needTarget)return e.worldPosition.y-this._touchStartPos.y>50&&(this.dwScrollView.scrollView.enabled=!1),void e.setPosition(e.position.x,e.position.y+i.y);e.getComponent(p).opacity=120;var n=this.arrowTip;n.setPosition(n.position.x+i.x,n.position.y+i.y);var o=n.parent.getComponent(f).convertToWorldSpaceAR(n.position);n.active?this.graphicsLineDrawer.drawDashedLine(e):this.graphicsLineDrawer.clearDashedLine(),Math.abs(o.x-this._touchStartPos.x)>50?this._selectCancel=!n.active:o.y-this._touchStartPos.y>50&&(n.active=!0,this.dwScrollView.scrollView.enabled=!1,e.getComponent(p).opacity=180)}},a.onTouchEnd=function(t){var e=t.target;this.dwScrollView.scrollView.enabled=!0,this.arrowTip.active=!1,e.getComponent(p).opacity=255,!this._needTarget&&e.worldPosition.y-this._touchStartPos.y>120?(this._selected=e,this.playCardCheckEvent.forEach((function(t){return t.emit([e])}))):e.position=this._oriCardPos,this.graphicsLineDrawer.clearDashedLine(),m.instance.hide()},a.onTouchCancel=function(t){var e=t.target;if(this.dwScrollView.scrollView.enabled=!0,this.arrowTip.active=!1,e.getComponent(p).opacity=255,!this._needTarget&&e.worldPosition.y-this._touchStartPos.y>120)this._selected=e,this.playCardCheckEvent.forEach((function(t){return t.emit([e])}));else if(this._needTarget&&this.hitBox.tryHit()){var i=this.hitBox.target;this._selected=e,this.playCardCheckEvent.forEach((function(t){return t.emit([e,i])}))}else e.position=this._oriCardPos;this.graphicsLineDrawer.clearDashedLine(),m.instance.hide()},a.show=function(t){void 0===t&&(t=!0),this.node.active=t},a.lock=function(t){void 0===t&&(t=!0),this._buttonTemps.forEach((function(e){return e.interactable=!t}))},a.enableCards=function(){var t=this;this._buttonTemps.forEach((function(e){t._removeEventTouch(e.node),t._setEventTouch(e.node)})),this.dwScrollView.scrollView.enabled=!0},a.disableCards=function(){var t=this;this._buttonTemps.forEach((function(e){return t._removeEventTouch(e.node)}))},a.catchTag=function(){this.arrowTip.active=!1,this.hitBox.catchTag()},a.removeTag=function(t){this.hitBox.removeTag(t)},a.cancelSelect=function(){this._selected.position=this._oriCardPos},a.playCard=function(){if(this._selected){this._removeEventTouch(this._selected),this._buttonTemps.splice(this._buttonTemps.indexOf(this._selected.getComponent(v)),1),this._selected.parent.setSiblingIndex(999),this._selected.parent.active=!1,this.dwScrollView.scrollView.enabled=!0;var t=this.dwScrollView.content.getComponent(f).convertToWorldSpaceAR(this._selected.parent.position);this.dwScrollView.scrollView.scrollToPercentVertical(t.x/this.dwScrollView.scrollView.content.getComponent(f).width,.5)}else console.warn("HandCards: no selected card")},a.discardCard=function(t){var e=this._buttonTemps.indexOf(t.getComponent(v));-1!==e?(this._removeEventTouch(t),this._buttonTemps.splice(e,1),t.parent.setSiblingIndex(999),t.parent.active=!1):console.warn("HandCards: card not found")},a.setCount=function(t){var e=this.dwScrollView.content,i=e.children;i.forEach((function(t){return t.active=!1}));for(var n=0;n<t;n++){var o=i[n];o||((o=T(this.cardPrefab)).parent=e),o.active=!0,o.getComponentInChildren(u).string=n.toString()}this.dwScrollView.scrollView.scrollToRight(1)},a.attach=function(t){var e=this,i=this.dwScrollView.content.children;t.forEach((function(t,e){C.moveCard(t,i[e],d.ZERO),t.active=!0})),this._buttonTemps.forEach((function(t){return e._removeEventTouch(t.node)})),this._buttonTemps.length=0,t.forEach((function(t){var i=t.getComponent(v);i?(e._setEventTouch(i.node),e._buttonTemps.push(i)):console.error(i.name,"HandCards: cardButton not found")})),this.dwScrollView.scrollView.enabled=!0},a.setNeedTarget=function(t){this._needTarget=t},a.clear=function(){var t;this.dwScrollView.content.children.forEach((function(t){return t.active=!1})),this.cards.forEach((function(t){return t.destroy()})),this._buttonTemps.length=0,null==(t=this._selected)||t.destroy(),this._selected=null,this.arrowTip.active=!1,this._needTarget=!1},a._setEventTouch=function(t){t.on(s.EventType.TOUCH_START,this.onTouchStart,this),t.on(s.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(s.EventType.TOUCH_END,this.onTouchEnd,this),t.on(s.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},a._removeEventTouch=function(t){t.off(s.EventType.TOUCH_START,this.onTouchStart,this),t.off(s.EventType.TOUCH_MOVE,this.onTouchMove,this),t.off(s.EventType.TOUCH_END,this.onTouchEnd,this),t.off(s.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},a.drawCard=function(t){this.setCount(t.length),this.attach(t)},r(e,[{key:"cards",get:function(){return this._buttonTemps.map((function(t){return t.node}))}}]),e}(w)).prototype,"cardPrefab",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(M.prototype,"dwScrollView",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(M.prototype,"selectedColor",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(255,255,255,255)}}),A=e(M.prototype,"arrowTip",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(M.prototype,"hitBox",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(M.prototype,"touchedCardEvent",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W=e(M.prototype,"playCardCheckEvent",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F=e(M.prototype,"combatCardInfoEvent",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),G=e(M.prototype,"graphicsLineDrawer",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(M.prototype,"tipLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=M))||z));a._RF.pop()}}}));

System.register("chunks:///_virtual/Hero.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StorageTool.ts","./Adventure.ts","./Attribute.ts","./Character.ts"],(function(e){var t,i,n,r,a,s,l,o,u;return{setters:[function(e){t=e.inheritsLoose,i=e.createClass},function(e){n=e.cclegacy},function(e){r=e.StorageTool},function(e){a=e.AdventureSkillRank,s=e.PassiveAttribute,l=e.AdventureScore},function(e){o=e.Attribute},function(e){u=e.Character}],execute:function(){n._RF.push({},"04f16YylRZI1LkJ29jikyoE","Hero",void 0);e("Hero",function(e){t(u,e);var n=u.prototype;function u(t){var i,n,u=r.loadFromFile(t+"_character_data");((i=e.call(this,u)||this)._adventureSkillRank=new a,i._adventureScore=void 0,i._passiveAttribute=new s,i._isCreated=!1,i._avaliablePoints=0,u)?(i._isCreated=!0,u.adventureSkillRank&&(i._adventureSkillRank=u.adventureSkillRank)):(i.abilityScore=((n={})[o.Strength]=10,n[o.Dexterity]=10,n[o.Intelligence]=10,n[o.Wisdom]=10,n[o.Charisma]=10,n[o.Resilience]=10,n),i.name=t,i.level=1);var c=Object.values(i.abilityScore).reduce((function(e,t){return e+t}),0);return i._avaliablePoints=70-c,console.log(r.listFiles()),i._adventureScore=new l(i._adventureSkillRank),i}return n.levelUp=function(){this.level++,this.saveData()},n.upgradeAdventureRank=function(e){this._adventureScore.upgradeSkill(e),console.log(this._adventureScore),this._isCreated=!0},n.saveData=function(){r.saveToFile(this.name+"_character_data",{name:this.name,level:this.level,abilityScore:this.abilityScore,savingThrowProficiencies:this.savingThrowProficiencies,adventureSkillRank:this._adventureSkillRank}),this._isCreated=!0},n.delData=function(){r.deleteFile(this.name+"_character_data")},i(u,[{key:"IsCreated",get:function(){return this._isCreated}},{key:"Level",get:function(){return this.level}},{key:"AvaliablePoints",get:function(){return this._avaliablePoints}},{key:"adventureSkillRank",get:function(){return this._adventureSkillRank}},{key:"adventureScore",get:function(){return this._adventureScore}},{key:"passive",get:function(){var e=this.abilityScore,t=e.strength,i=e.dexterity,n=this._adventureScore,r=n.observation,a=n.stunts,s=n.experience;return this._passiveAttribute.calculate(t,i,r.Modifier,a.Modifier,s.Modifier),this._passiveAttribute}}]),u}(u));n._RF.pop()}}}));

System.register("chunks:///_virtual/HideAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,a,c,s,u,l,p,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,c=t.Node,s=t.tween,u=t.v3,l=t.UIOpacity,p=t.Tween,d=t.Component}],execute:function(){var g,h,f,y,m,b;r._RF.push({},"d7439ZMnRZLfp1t6juGuJcD","HideAnimation",void 0);var v=a.ccclass,N=a.property;t("HideAnimation",(g=v("HideAnimation"),h=N(c),g((m=e((y=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"targetNode",m,o(e)),n(e,"duration",b,o(e)),e}i(e,t);var r=e.prototype;return r.startAnimation=function(){this.targetNode.position=this.node.position.clone(),this.targetNode.active=!0,s(this.targetNode).to(this.duration/2,{scale:u(1.5,1.5,1)},{easing:"cubicInOut"}).to(this.duration/2,{scale:u(1,1,1)},{easing:"cubicInOut"}).start(),this.targetNode.getComponent(l).opacity=0,s(this.targetNode.getComponent(l)).to(this.duration/2,{opacity:255},{easing:"cubicInOut"}).start()},r.stopAnimation=function(){p.stopAllByTarget(this.targetNode),this.targetNode.active=!1},e}(d)).prototype,"targetNode",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=e(y.prototype,"duration",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),f=y))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/HitBox.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HitTag.ts"],(function(t){var e,n,r,i,o,a,s,c,u,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.createClass},function(t){a=t.cclegacy,s=t._decorator,c=t.Node,u=t.Component},function(t){l=t.HitTag}],execute:function(){var p,g,h,f,_;a._RF.push({},"96ff9jpamdA2bWRunCbqZnm","HitBox",void 0);var v=s.ccclass,y=s.property;t("HitBox",(p=v("HitBox"),g=y({type:c,tooltip:'包含有"HitTag"子節點组件的父節點'}),p((_=e((f=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,r(e,"catchPools",_,i(e)),e._tags=[],e._target=null,e}n(e,t);var a=e.prototype;return a.catchTag=function(){var t=this;this._tags.length=0,this.catchPools.forEach((function(e){var n,r=e.getComponentsInChildren(l);(n=t._tags).push.apply(n,r)}))},a.removeTag=function(t){var e=this;[].concat(this._tags).some((function(n){return n.tagID===t&&(e._tags.splice(e._tags.indexOf(n),1),!0)}))},a.tryHit=function(){var t=this;return this._tags.some((function(e){var n=e.onHitTest(t.node);return n&&(t._target=e.node),n}))},o(e,[{key:"target",get:function(){return this._target}}]),e}(u)).prototype,"catchPools",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h=f))||h));a._RF.pop()}}}));

System.register("chunks:///_virtual/HitCheckAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FloatingTextComponent.ts"],(function(t){var e,i,n,o,a,r,u,s,c,l,p,d,g,h,b,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){u=t.cclegacy,s=t._decorator,c=t.Node,l=t.Label,p=t.v3,d=t.Tween,g=t.tween,h=t.Component,b=t.UIOpacity},function(t){f=t.FloatingTextComponent}],execute:function(){var v,m,y,L,N,w,C,I,O,T;u._RF.push({},"b9eb2nvQ95OKbr7JRCkzMir","HitCheckAnimation",void 0);var _=s.ccclass,A=s.property;t("HitCheckAnimation",(v=_("HitCheckAnimation"),m=A(c),y=A(f),L=A(l),v((C=e((w=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,n(e,"targetNode",C,o(e)),n(e,"floatingText",I,o(e)),n(e,"valueLabel",O,o(e)),n(e,"duration",T,o(e)),e._oriPosition=p(),e}i(e,t);var u=e.prototype;return u.onLoad=function(){this.hide()},u.startAnimation=function(){var t=a(r().mark((function t(){var e=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._oriPosition=this.valueLabel.node.position.clone(),this.targetNode.active=!0,this.targetNode.position=this._oriPosition.clone().add3f(-120,0,0),this.targetNode.angle=-45,t.abrupt("return",new Promise((function(t){g(e.targetNode).parallel(g().to(e.duration,{position:e._oriPosition},{easing:"cubicInOut"}),g().to(e.duration,{angle:45},{easing:"cubicInOut"})).call((function(){t()})).start(),e.targetNode.getComponent(b).opacity=0,g(e.targetNode.getComponent(b)).to(e.duration/2,{opacity:255},{easing:"cubicInOut"}).start()})));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),u.stopAnimation=function(){d.stopAllByTarget(this.targetNode),this.targetNode.position=this._oriPosition},u.hide=function(){this.valueLabel.node.active=!1,this.targetNode.active=!1},u.setValue=function(t,e,i){void 0===e&&(e=1),this.valueLabel.string=i?""+t+i:t.toString(),this.valueLabel.node.active=!0,g(this.valueLabel.node).to(this.duration/2,{scale:p(e,e,1)},{easing:"cubicInOut"}).to(this.duration/2,{scale:p(1,1,1)},{easing:"cubicInOut"}).start()},u.addBonus=function(t,e,i){var n=this;void 0===i&&(i=""),this.floatingText.showNumber(t,(function(){n.valueLabel.string=e.toString(),g(n.valueLabel.node).to(n.duration/2,{scale:p(1.5,1.5,1)},{easing:"cubicInOut"}).to(n.duration/2,{scale:p(1,1,1)},{easing:"cubicInOut"}).start()}),0,i)},e}(h)).prototype,"targetNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(w.prototype,"floatingText",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(w.prototype,"valueLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(w.prototype,"duration",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),N=w))||N));u._RF.pop()}}}));

System.register("chunks:///_virtual/HitPointsBarComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FloatingTextComponent.ts"],(function(t){var e,n,i,o,r,a,p,s,u,l,h,c,m,H,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){a=t.cclegacy,p=t._decorator,s=t.ProgressBar,u=t.Node,l=t.Label,h=t.Vec3,c=t.tween,m=t.UITransform,H=t.Component},function(t){f=t.FloatingTextComponent}],execute:function(){var b,g,d,x,B,P,y,C,w,L,_;a._RF.push({},"975d2k7B9dAQ7imcn3+VIGb","HitPointsBarComponent",void 0);var v=p.ccclass,T=p.property;t("HitPointsBarComponent",(b=v("HitPointsBarComponent"),g=T(s),d=T(f),x=T(u),B=T(l),b((C=e((y=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"hpBar",C,o(e)),i(e,"floatingTextComponent",w,o(e)),i(e,"textSpawnPoint",L,o(e)),i(e,"hpLabel",_,o(e)),e.curHp=100,e.maxHp=100,e._tempHp=0,e}n(e,t);var a=e.prototype;return a.setHP=function(t,e){this.curHp=t,this.maxHp=e,this.updateBar(),this.updateHpLabel()},a.changeHp=function(t){var e=this,n=Math.min(Math.max(this.curHp+t,0),this.maxHp),i=this.textSpawnPoint.position.clone(),o=new h(0,40,0),r=t<=0?i.add(o):i.subtract(o);this.floatingTextComponent.startPoint=r,this.floatingTextComponent.endPoint=this.textSpawnPoint.position,this.curHp=n,this.floatingTextComponent.showNumber(t,(function(){e.updateBar(),e.updateHpLabel()}))},a.updateBar=function(){this.hpBar.progress;var t=(this.curHp+this._tempHp)/this.maxHp;c(this.hpBar).to(.25,{progress:t}).start()},a.updateHpLabel=function(){this._tempHp?this.hpLabel.string="HP: "+(this.curHp+this._tempHp)+" (+"+this._tempHp+") / "+this.maxHp:this.hpLabel.string="HP: "+this.curHp+" / "+this.maxHp},r(e,[{key:"defaultHp",set:function(t){this.hpBar.totalLength=this.getComponent(m).width,this.maxHp=t,this.curHp=t,this.updateBar(),this.updateHpLabel()}},{key:"tempHp",get:function(){return this._tempHp},set:function(t){this._tempHp=t,this.updateHpLabel()}}]),e}(H)).prototype,"hpBar",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(y.prototype,"floatingTextComponent",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(y.prototype,"textSpawnPoint",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(y.prototype,"hpLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=y))||P));a._RF.pop()}}}));

System.register("chunks:///_virtual/HitTag.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,o,r,i,c;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t._decorator,r=t.UITransform,i=t.Rect,c=t.Component}],execute:function(){var s;n._RF.push({},"c6070yqE7ZNV4279lc1aNrY","HitTag",void 0);var a=o.ccclass;o.property,t("HitTag",a("HitTag")(s=function(t){function n(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))||this).tagID="",e}e(n,t);var o=n.prototype;return o.onHitTest=function(t){var e,n=null==(e=this.node)?void 0:e.getComponent(r),o=null==t?void 0:t.getComponent(r);if(!n||!o)return console.error("UITransform component is missing on one of the nodes."),!1;var i=this.getWorldRect(this.node,n),c=this.getWorldRect(t,o);return i.intersects(c)},o.getWorldRect=function(t,e){var n=t.getWorldPosition(),o=e.width,r=e.height;return new i(n.x-o/2,n.y-r/2,o,r)},n}(c))||s);n._RF.pop()}}}));

System.register("chunks:///_virtual/Inventory.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Weapon.ts","./Armor.ts","./Shield.ts","./WeaponDraggable.ts","./ArmorDraggable.ts","./ShieldDraggable.ts","./DropZone.ts","./EquipmentDropZone.ts","./GroceriesDraggable.ts","./Groceries.ts","./Draggable.ts"],(function(t){var e,n,i,o,r,a,l,s,u,c,m,h,d,f,g,p,v,I,b,y,C,S;return{setters:[function(t){e=t.inheritsLoose,n=t.applyDecoratedDescriptor,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.Node,s=t.Label,u=t.Event,c=t.instantiate,m=t.Component},function(t){h=t.Weapon},function(t){d=t.Armor},function(t){f=t.Shield},function(t){g=t.WeaponDraggable},function(t){p=t.ArmorDraggable},function(t){v=t.ShieldDraggable},function(t){I=t.DropZone},function(t){b=t.EquipmentDropZoneType},function(t){y=t.GroceriesDraggable},function(t){C=t.Groceries},function(t){S=t.Draggable}],execute:function(){var w,W,D,L,x,z,A,G,P,Z,q,E,T;r._RF.push({},"78b630aLRxGKZeZgGyoku7u","Inventory",void 0);var k=a.ccclass,_=a.property;t("InventoryEvent",function(t){function n(e,n,i){var o;return(o=t.call(this,e,n)||this).detail=null,o.detail=i,o}return e(n,t),n}(u)),t("Inventory",(w=k("Inventory"),W=_(l),D=_(l),L=_(s),x=_(s),w((G=n((A=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"layout",G,o(e)),i(e,"itemPrefab",P,o(e)),i(e,"weightLabel",Z,o(e)),i(e,"slotsLabel",q,o(e)),i(e,"maxWeight",E,o(e)),i(e,"maxSlots",T,o(e)),e.items=[],e.currentWeight=0,e.currentSlots=0,e}e(n,t);var r=n.prototype;return r.onLoad=function(){var t=this;this.show(),this.node.on("removeItem",(function(e){console.log("removeItem:",e.detail),e.propagationStopped=!0,t.removeItem(e.detail.item,e.detail.amount)})),this.node.on("moveItem",(function(e){console.log("moveItem:",e.detail),e.propagationStopped=!0,t.moveItem(e.detail.item,e.detail.amount,e.detail.isMerge)}))},r.show=function(t){void 0===t&&(t=!0),this.node.active=t},r.create=function(t,e,n){var i=c(this.itemPrefab);i.active=!0;var o=null;if(t instanceof h){var r=i.addComponent(g);r.equipmentType=b.WeaponOrShield,r.Weapon=t,o=r}else if(t instanceof d){var a=i.addComponent(p);a.equipmentType=b.Armor,a.Item=t,o=a}else if(t instanceof f){var l=i.addComponent(v);l.equipmentType=b.WeaponOrShield,l.Item=t,o=l}else if(t instanceof C){var s=i.addComponent(y);t.amount=n,s.Item=t,o=s}return o&&(o.setParent(e),console.log("draggable.item:",o.Item),e.init()),i},r.addItem=function(t,e){if(void 0===e&&(e=1),this.currentWeight+t.weight>this.maxWeight||this.currentSlots+t.slot>this.maxSlots)return console.error("Cannot add item: exceeds weight or slot limit."),!1;var n=this.layout.getComponentsInChildren(I).find((function(t){return 0===t.slot.children.length}));if(n){this.moveItem(t,e);this.create(t,n,e);return!0}return!1},r.delItem=function(t,e){var n=this;return void 0===e&&(e=1),this.currentWeight-t.weight*e<0||this.currentSlots-t.slot<0?(console.error("Cannot remove item: exceeds weight ("+(this.currentWeight-t.weight*e)+") or slot limit ("+(this.currentSlots-t.slot)+")."),!1):(this.layout.getComponentsInChildren(I).find((function(i){var o=i.slot.getComponentInChildren(S);return(null==o?void 0:o.Item)===t&&(t.amount-=e,t.amount<=0&&(n.removeItem(t,e),o.node.destroy()),!0)})),!1)},r.addCount=function(t,e){void 0===e&&(e=1),this.layout.getComponentsInChildren(I).find((function(n){var i=n.getComponentInChildren(y);return(null==i?void 0:i.Item)===t&&(t.amount+=e,!0)}))},r.moveItem=function(t,e,n){void 0===n&&(n=!1),this.items.includes(t)&&n||this.items.push(t),this.currentWeight+=t.weight*e,n?this.addCount(t,e):this.currentSlots+=t.slot,this.updateLabels(),console.log("listItems:",this.listItems())},r.removeItem=function(t,e){console.log("removeItem:",t.name,e,this.items);var n=this.items.findIndex((function(e){return e.name===t.name&&e.id===t.id}));return-1===n?(console.error("Item not found in inventory."),!1):(this.items.splice(n,1),this.currentWeight-=t.weight*e,this.currentSlots-=t.slot,console.log(t.name+" removed from inventory."),this.updateLabels(),!0)},r.listItems=function(){return this.items},r.clear=function(){var t=this;[].concat(this.items).forEach((function(e){console.log("clear:",e.name,e.amount),t.removeItem(e,e.amount)})),this.items.length=0},r.getItemCount=function(t){if(-1===this.items.findIndex((function(e){return e.name===t.name&&e.id===t.id})))return console.error("Item not found in inventory."),0;var e=0;return this.layout.getComponentsInChildren(I).find((function(n){var i=n.getComponentInChildren(S);return(null==i?void 0:i.Item)===t&&(e=i.Amount,!0)})),e},r.updateLabels=function(){this.weightLabel.string="Weight: "+this.currentWeight+"/"+this.maxWeight,this.slotsLabel.string="Slots: "+this.currentSlots+"/"+this.maxSlots},r.onInventoryButtonClicked=function(){this.show(!this.node.active),console.log("this.node.active:",this.node.active)},r.onListItemClicked=function(){console.log(this.listItems())},n}(m)).prototype,"layout",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=n(A.prototype,"itemPrefab",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=n(A.prototype,"weightLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=n(A.prototype,"slotsLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(A.prototype,"maxWeight",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),T=n(A.prototype,"maxSlots",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),z=A))||z));r._RF.pop()}}}));

System.register("chunks:///_virtual/InventoryCollection.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Inventory.ts","./Weapon.ts","./Armor.ts","./GameManager.ts","./Groceries.ts"],(function(e){var t,n,i,r,a,o,s,c,d,u,p,l,v,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,c=e._decorator,d=e.Component},function(e){u=e.Inventory},function(e){p=e.Weapon},function(e){l=e.Armor},function(e){v=e.GameManager},function(e){h=e.Groceries}],execute:function(){var f,y,b,m,g;s._RF.push({},"00d9f3yuUpDF6XetP9Xhd00","InventoryCollection",void 0);var I=c.ccclass,w=c.property;e("InventoryCollection",(f=I("InventoryCollection"),y=w(u),f((g=t((m=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"inventory",g,r(t)),t}n(t,e);var s=t.prototype;return s.collect=function(){var e=a(o().mark((function e(t,n){var i,r,a,s,c,d,u,f,y,b=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=.1),e.next=3,new Promise((function(e){return b.scheduleOnce(e,n)}));case 3:i=parseInt(t.value),e.t0=t.type,e.next="weapon"===e.t0?7:"armor"===e.t0?15:"groceries"===e.t0?23:30;break;case 7:if(r=v.instance.database.weaponDatabase.find((function(e){return e.id===t.coping}))){e.next=10;break}return e.abrupt("break",31);case 10:return a=parseInt(r.weight.split(" lb")[0],10),s=r.weapon_property.split(" "),c=r.weapon_range.split(" "),this.inventory.addItem(new p(r.id,t.type,r.name,r.value,a,r.type,r.id,{dice:r.damage1,dice2:r.damage2,type:r.damage_type},s,c,r.description)),e.abrupt("break",31);case 15:if(d=v.instance.database.armorDatabase.find((function(e){return e.id===t.coping}))){e.next=18;break}return e.abrupt("break",31);case 18:return u=d.weight.split(" lb")[0],d.dex,f=d.str,this.inventory.addItem(new l(d.id,t.type,d.name,d.id,d.value,u,d.ac,f,d.stealth,d.armor_type,d.description)),e.abrupt("break",31);case 23:if(console.log("add:",t.coping,"x",i),!(0===v.instance.database.itemDatabase.length&&n<.5)){e.next=27;break}return this.collect(t,n+1),e.abrupt("return");case 27:y=v.instance.database.itemDatabase.find((function(e){return e.id===t.coping})),console.log("itemData:",y),this.inventory.addItem(new h(y.id,t.type,y.name,y.value,y.id,parseInt(y.weight,10),y.stack,y.effect_id,y.description),i);case 30:return e.abrupt("break",31);case 31:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),s.addCount=function(e,t){this.inventory.moveItem(e,t,!0)},s.deleteItem=function(e,t){this.inventory.delItem(e,t)},t}(d)).prototype,"inventory",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=m))||b)),e("TipCard",(function(){this.string=void 0,this.type=void 0,this.description=void 0,this.behavior=void 0,this.action=void 0,this.conditions=void 0,this.coping=void 0,this.response=void 0,this.dc=void 0,this.success=void 0,this.failure=void 0,this.link=void 0,this.value=void 0,this.pic=void 0,this.option=void 0,this.id=void 0}));s._RF.pop()}}}));

System.register("chunks:///_virtual/Item.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"416ffYg1JhNjqhpWtayJR5g","Item",void 0);t("Item",function(){function t(t,e,i,s,n){this.id="",this.type="item",this.name="",this.goldValue="",this.purchasePrice=void 0,this.weight=0,this.stackLimit=1,this.slot=1,this.effectId="",this.amount=1,this.description="",this.id=t,this.type=e,this.name=i,this.goldValue=s,this.purchasePrice=this.getPrice(s),this.weight=n}return t.prototype.getPrice=function(t){var e=t.split(" "),i=parseInt(e[0]),s=e[1];return"gold"===s?i:"silver"===s?i/10:"copper"===s?i/100:0},e(t,[{key:"tooltip",get:function(){return""+this.name}}]),t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./debug-view-runtime-control.ts","./BiteAnimation.ts","./DefenseAnimation.ts","./DiceAnimation.ts","./DodgeAnimation.ts","./EllipseMotion.ts","./HideAnimation.ts","./HitCheckAnimation.ts","./ShakeAnimation.ts","./StunAnimation.ts","./Attribute.ts","./Character.ts","./CharacterRaidData.ts","./Enemy.ts","./Hero.ts","./CharacterCombatData.ts","./CombatCard.ts","./CombatEffect.ts","./CombatEffectComponent.ts","./CombatUnit.ts","./EmpowerCardSelection.ts","./EmpowerCardsListItem.ts","./EmpowerCombatCardList.ts","./AiIntentData.ts","./CSVLoader.ts","./CombatCardData.ts","./CombatEffectData.ts","./EmpowerCardData.ts","./EmpowerData.ts","./EnemyData.ts","./EnemyTeamData.ts","./GameDatabase.ts","./TeachConversationData.ts","./TowerData.ts","./AudioHelper.ts","./ArmorDraggable.ts","./BackpackDropZone.ts","./BeltDropZone.ts","./DiscardDropZone.ts","./DraggableDetail.ts","./EquipmentDropZone.ts","./GroceriesDraggable.ts","./Inventory.ts","./InventoryCollection.ts","./ShieldDraggable.ts","./StoreDropZone.ts","./WeaponDraggable.ts","./Armor.ts","./Groceries.ts","./Item.ts","./Potion.ts","./Shield.ts","./Weapon.ts","./AudioManager.ts","./BattleManager.ts","./CombatCardManager.ts","./CombatEffectManager.ts","./EmpowerManager.ts","./GameManager.ts","./NotificationManager.ts","./ToolTipManager.ts","./StorageTool.ts","./GameLobby.ts","./GameSetup.ts","./Adventure.ts","./AdventureSkill.ts","./Skill.ts","./CombatTeachTool.ts","./AttributeComponent.ts","./CameraCenterMover.ts","./CardMover.ts","./CheckBoxComponent.ts","./CounterComponent.ts","./Debug.ts","./DynamicWidthScrollView.ts","./FloatingTextComponent.ts","./GraphicsLineDrawer.ts","./HitBox.ts","./HitPointsBarComponent.ts","./HitTag.ts","./NotificationBadge.ts","./PixelImage.ts","./RandomString.ts","./SkillComponent.ts","./Tower.ts","./TowerFloor.ts","./ComboSkillItem.ts","./Draggable.ts","./DropZone.ts","./EmpowerRankItem.ts","./CardComponent.ts","./CardPreview.ts","./CombatCardComponent.ts","./HandCards.ts","./NPCInteraction.ts","./QuestInteraction.ts","./RewardInteraction.ts","./AbilityTable.ts","./AdvenceSkillTable.ts","./AttributeAllocation.ts","./CharacterInfo.ts","./QuickTip.ts","./TooltipComponent.ts","./ComboSkillListPanel.ts","./EmpowerRankPnael.ts","./PopupWindowComponent.ts","./PopupWindowHelper.ts","./RewardPanel.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NotificationBadge.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,n,o,r,a,c,l,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,c=e.Label,l=e.Node,u=e.Component}],execute:function(){var s,p,d,f,g,b,h;r._RF.push({},"f5a9cZoN3FJgpOPveKbunUH","NotificationBadge",void 0);var v=a.ccclass,y=a.property;e("NotificationBadge",(s=v("NotificationBadge"),p=y(c),d=y(l),s((b=t((g=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"label",b,o(t)),n(t,"badgeNode",h,o(t)),t}i(t,e);var r=t.prototype;return r.onLoad=function(){this.setCount(0)},r.setCount=function(e){e>0?(this.badgeNode.active=!0,this.label.string=e.toString()):this.badgeNode.active=!1},t}(u)).prototype,"label",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=t(g.prototype,"badgeNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/NotificationManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NotificationBadge.ts"],(function(t){var n,i,e,o,a,r,c,s,u;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.inheritsLoose,e=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.createClass},function(t){r=t.cclegacy,c=t._decorator,s=t.Component},function(t){u=t.NotificationBadge}],execute:function(){var f,l,p,d,g,h;r._RF.push({},"d99f7ciGR1FOJRw9do/OO07","NotificationManager",void 0);var y=c.ccclass,b=c.property;t("NotificationManager",(f=y("NotificationManager"),l=b([u]),f(((h=function(t){function n(){for(var n,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return n=t.call.apply(t,[this].concat(a))||this,e(n,"badges",g,o(n)),n}i(n,t);var r=n.prototype;return r.onLoad=function(){n._instance?this.destroy():n._instance=this},r.updateNotificationCount=function(t,n){var i=this.badges.find((function(n){return n.node.name===t}));i&&i.setCount(n)},r.resetAllNotifications=function(){this.badges.forEach((function(t){t.setCount(0)}))},a(n,null,[{key:"instance",get:function(){return this._instance}}]),n}(s))._instance=null,g=n((d=h).prototype,"badges",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),p=d))||p));r._RF.pop()}}}));

System.register("chunks:///_virtual/NPCInteraction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PixelImage.ts"],(function(e){var t,n,i,r,a,o,u,l,c,s,d,p,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,u=e.Label,l=e.Layout,c=e.Button,s=e.instantiate,d=e.UIOpacity,p=e.Component},function(e){f=e.PixelImage}],execute:function(){var m,h,b,g,w,y,v,L,C,I,B,P,z;a._RF.push({},"a485brwkVVL0rG7SNw3352Q","NPCInteraction",void 0);var R=o.ccclass,S=o.property;e("NPCInteraction",(m=R("NPCInteraction"),h=S(u),b=S(f),g=S(u),w=S(l),y=S(c),m((C=t((L=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"nameLabel",C,r(t)),i(t,"imageSprite",I,r(t)),i(t,"dialogueLabel",B,r(t)),i(t,"rewardLayout",P,r(t)),i(t,"closeButton",z,r(t)),t.rewards=[],t.data=[{id:"",name:"",img:"",dialogue:"",rewards:[{name:"",conditions:[{id:"",amount:0}]}]}],t}n(t,e);var a=t.prototype;return a.init=function(e,t){var n=this.data.find((function(t){return t.id===e})),i=n.name,r=n.img,a=n.dialogue,o=n.rewards.forEach((function(e){return{name:e.name,claimed:!1,button:null,condition:function(){return!0}}}));this.nameLabel.string=i,this.imageSprite.setSpriteFrame(r),this.dialogueLabel.string=a,this.rewards=o,this.setupRewards(),this.updateCloseButton()},a.setupRewards=function(){var e=this,t=this.rewardLayout.node.children;t.forEach((function(e){return e.active=!1}));var n=s(t[0]);this.rewards.forEach((function(i,r){var a=t[r];a||((a=s(n)).parent=e.rewardLayout.node,a.addComponent(d)),a.active=!0;var o=a.addComponent(c),l=a.getComponent(d);a.getComponentInChildren(u).string=i.name,i.condition()?(o.interactable=!0,l.opacity=1,o.node.on("click",(function(){return e.claimReward(i)}),e)):(o.interactable=!1,l.opacity=.5)}))},a.claimReward=function(e){e.claimed=!0,e.button.node.active=!1,this.updateCloseButton()},a.updateCloseButton=function(){this.closeButton.interactable=this.rewards.every((function(e){return e.claimed}))},a.close=function(){this.rewardLayout.node.children.forEach((function(e){return e.active=!1})),this.rewards.length=0},t}(p)).prototype,"nameLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(L.prototype,"imageSprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(L.prototype,"dialogueLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(L.prototype,"rewardLayout",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(L.prototype,"closeButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=L))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/PixelImage.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,o,n,a,s,p,c,l;return{setters:[function(e){t=e.inheritsLoose},function(e){r=e.cclegacy,i=e._decorator,o=e.Sprite,n=e.Texture2D,a=e.resources,s=e.SpriteFrame,p=e.UITransform,c=e.view,l=e.Component}],execute:function(){var u;r._RF.push({},"1e6a61M7DpGTZ8ctRa3V2rU","PixelImage",void 0);var m=i.ccclass;i.property,e("PixelImage",m("PixelImage")(u=function(e){function r(){return e.apply(this,arguments)||this}t(r,e);var i=r.prototype;return i.onLoad=function(){var e,t=null==(e=this.node.getComponent(o).spriteFrame)?void 0:e.texture;t&&t.setFilters(n.Filter.NONE,n.Filter.NONE)},i.setSpriteFrame=function(e){var t=this.node.getComponent(o),r="picture/"+e+"/spriteFrame";a.load(r,s,(function(r,i){r?console.error("Failed to load image ",e,": "+r):t.spriteFrame=i}))},i.updateMertial=function(){var e=this.node.getComponent(p),t=this.node.getComponent(o).getMaterialInstance(0);if(t){var r=e.width,i=e.height,n=c.getVisibleSize(),a=n.width,s=n.height;t.setProperty("imageWidth",r),t.setProperty("imageHeight",i),t.setProperty("screenWidth",a),t.setProperty("screenHeight",s),t.reset(t)}},i.clearSpriteFrame=function(){this.node.getComponent(o).spriteFrame=null},r}(l))||u);r._RF.pop()}}}));

System.register("chunks:///_virtual/PopupWindowComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,r,i,o,a,u,c,l,s,p,f,b,h,d,v;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){u=t.cclegacy,c=t._decorator,l=t.Node,s=t.Label,p=t.Button,f=t.instantiate,b=t.EventHandler,h=t.Component,d=t.Vec3,v=t.tween}],execute:function(){var m,w,g,C,y,P,k,L,x,z,N,E,I;u._RF.push({},"ef7f9o5MSdHJIyaJ+5Y6gKE","PopupWindowComponent",void 0);var T=c.ccclass,W=c.property;t("PopupWindowComponent",(m=T("PopupWindowComponent"),w=W(l),g=W(s),C=W(s),y=W(l),P=W(p),m((x=n((L=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o))||this,r(n,"dialogNode",x,i(n)),r(n,"titleLabel",z,i(n)),r(n,"contentLabel",N,i(n)),r(n,"buttonContainer",E,i(n)),r(n,"buttonPrefab",I,i(n)),n.callbacks={},n}e(n,t);var u=n.prototype;return u.openPopup=function(){var t=o(a().mark((function t(n,e,r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.node.active=!0,t.next=3,this.animateOpen();case 3:this.setupTitle(n),this.contentLabel.string=e,this.setupButtons(r);case 6:case"end":return t.stop()}}),t,this)})));return function(n,e,r){return t.apply(this,arguments)}}(),u.setupTitle=function(t){this.titleLabel.node.active=!!t,this.titleLabel.string=t||""},u.setupButtons=function(t){var n=this;this.buttonContainer.removeAllChildren(),t.forEach((function(t,e){var r=f(n.buttonPrefab.node),i=r.getComponent(p);r.getComponentInChildren(s).string=t.label,r.parent=n.buttonContainer,r.active=!0;var o="button_"+e;n.callbacks[o]=t.callback;var a=new b;a.target=n.node,a.component="PopupWindowComponent",a.handler="buttonClicked",a.customEventData=o,i.clickEvents.push(a)}))},u.buttonClicked=function(){var t=o(a().mark((function t(n,e){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.animateClose();case 2:null==(r=this.callbacks[e])||r();case 4:case"end":return t.stop()}}),t,this)})));return function(n,e){return t.apply(this,arguments)}}(),u.animateOpen=function(){var t=o(a().mark((function t(){var n=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.dialogNode.scale=new d(0,0,0),v(n.dialogNode).to(.3,{scale:new d(1,1,1)},{easing:"cubicInOut"}).call((function(){return t()})).start()})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),u.animateClose=function(){var t=o(a().mark((function t(){var n=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.reset(),t.abrupt("return",new Promise((function(t){v(n.dialogNode).to(.3,{scale:new d(0,0,0)},{easing:"cubicInOut"}).call((function(){t(),n.node.active=!1})).start()})));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),u.reset=function(){this.setupTitle(""),this.contentLabel.string="",this.buttonContainer.removeAllChildren()},n}(h)).prototype,"dialogNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(L.prototype,"titleLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(L.prototype,"contentLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(L.prototype,"buttonContainer",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(L.prototype,"buttonPrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=L))||k));u._RF.pop()}}}));

System.register("chunks:///_virtual/PopupWindowHelper.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupWindowComponent.ts","./GameManager.ts","./StorageTool.ts","./CardComponent.ts","./CardPreview.ts","./Tower.ts"],(function(e){var a,n,t,o,r,i,c,l,p,u,s,d,w,b;return{setters:[function(e){a=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,i=e._decorator,c=e.instantiate,l=e.Component},function(e){p=e.PopupWindowComponent},function(e){u=e.GameManager},function(e){s=e.StorageTool},function(e){d=e.CardComponent},function(e){w=e.CardPreview},function(e){b=e.Tower}],execute:function(){var m,f,h,C,P,y,g,v,D,W,R;r._RF.push({},"d5945ohkv9NF5M27qPEHCP1","PopupWindowHelper",void 0);var _=i.ccclass,k=i.property;e("PopupWindowHelper",(m=_("PopupWindowHelper"),f=k(p),h=k(w),C=k(d),P=k(b),m((v=a((g=function(e){function a(){for(var a,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return a=e.call.apply(e,[this].concat(r))||this,t(a,"popupWindow",v,o(a)),t(a,"cardPreview",D,o(a)),t(a,"cardComponent",W,o(a)),t(a,"tower",R,o(a)),a}n(a,e);var r=a.prototype;return r.onInappropriateEqipment=function(e){console.log("onInappropriateEqipment",e),this.popupWindow.openPopup("無法穿戴","穿戴類型不同，請重新選擇。",[{label:"確認",callback:null}])},r.onTowerChallengeSuccess=function(){this.popupWindow.openPopup("挑戰成功","完成探索，獲得獎勵",[{label:"領取獎勵",callback:function(){u.instance.characterCombatData.addEmpowerPoints(1),u.instance.CharacterRaidData.CombatParam.refillHP(),u.instance.CharacterRaidData.CombatParam.write(),u.instance.showLobbyUI()}}])},r.onTowerChallengeFailed=function(){var e=this;this.popupWindow.openPopup("挑戰失敗","你已經失敗，再接再厲吧！",[{label:"再次挑戰",callback:function(){e.tower.show(),u.instance.CharacterRaidData.CombatParam.refillHP(),u.instance.CharacterRaidData.CombatParam.write()}},{label:"放棄離開",callback:function(){s.deleteFile("challenge_tower_data"),u.instance.showLobbyUI(),u.instance.CharacterRaidData.CombatParam.refillHP(),u.instance.CharacterRaidData.CombatParam.write()}}])},r.onTowerLeave=function(e,a){this.popupWindow.openPopup("放棄挑戰","你要放棄目前的進度嗎？",[{label:"繼續挑戰",callback:function(){return e()}},{label:"放棄離開",callback:function(){u.instance.CharacterRaidData.CombatParam.refillHP(),u.instance.CharacterRaidData.CombatParam.write(),u.instance.showLobbyUI(),a()}}])},r.onOpenChest=function(){var e=c(this.cardComponent.node),a=e.getComponent(d);a._cardId="chest_1",a._cardName="寶箱",a.setIcon("chest"),a.description="寶箱裡總會有好東西";this.cardPreview.refresh(e),this.cardPreview.listReward([{id:"money_1",name:"金幣",img:"money",amount:20}],{money_1:u.instance.CharacterRaidData.Money})},r.onBattleVictory=function(e){var a=this;this.popupWindow.openPopup("戰鬥結果","恭喜您獲得勝利",[{label:"確認",callback:function(){a.tower.show(),e()}}])},r.onBattleDefeat=function(e){this.popupWindow.openPopup("戰鬥結果","你失敗了",[{label:"確認",callback:function(){e()}}])},a}(l)).prototype,"popupWindow",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=a(g.prototype,"cardPreview",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=a(g.prototype,"cardComponent",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=a(g.prototype,"tower",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=g))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/Potion.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Item.ts"],(function(t){var n,i,e,o;return{setters:[function(t){n=t.inheritsLoose,i=t.createClass},function(t){e=t.cclegacy},function(t){o=t.Item}],execute:function(){e._RF.push({},"e1613fcz8dG1bEHKmEFzaLT","Potion",void 0);t("Potion",function(t){function e(n,i,e,o,c,s,r){var u;return(u=t.call(this,n,i,e,o,s)||this).icon=void 0,u.icon=c,u.stackLimit=r,u}return n(e,t),i(e,[{key:"tooltip",get:function(){return this.name+" ("+this.weight+" lbs)"}}]),e}(o));e._RF.pop()}}}));

System.register("chunks:///_virtual/QuestInteraction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CheckBoxComponent.ts"],(function(t){var e,n,o,i,r,c,s,u,a,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,c=t._decorator,s=t.Layout,u=t.Label,a=t.Component},function(t){l=t.CheckBoxComponent}],execute:function(){var p,f,h,y,d,b,g;r._RF.push({},"74f14pO4FZPVYbNSd8SqtFe","QuestInteraction",void 0);var I=c.ccclass,L=c.property;t("QuestInteraction",(p=I("QuestInteraction"),f=L(s),h=L(u),p((b=e((d=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r))||this,o(e,"questLayout",b,i(e)),o(e,"descriptionLabel",g,i(e)),e._taskIds=[],e}n(e,t);var r=e.prototype;return r.reset=function(){var t;null==(t=this.questLayout.getComponentsInChildren(l))||t.forEach((function(t){return t.cancel()}))},r.close=function(){this._taskIds.length=0},r.listQuest=function(t){console.log("listQuest",t)},r.onSelectQuestClicked=function(){console.log(this._taskIds)},e}(a)).prototype,"questLayout",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=e(d.prototype,"descriptionLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=d))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/QuickTip.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TooltipComponent.ts","./ToolTipManager.ts"],(function(t){var e,i,n,o,r,a,p,u,c,l,s,T;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,p=t.Node,u=t.Enum,c=t.Component},function(t){l=t.ToolTipStyle,s=t.ToolTipSize},function(t){T=t.ToolTipManager}],execute:function(){var f,y,h,b,g,S,d,m,v,z;r._RF.push({},"1ec0cXvpRtDPLsAouEI4ns1","QuickTip",void 0);var E=a.ccclass,_=a.property;t("QuickTip",(f=E("QuickTip"),y=_(p),h=_({type:u(l)}),b=_({type:u(s)}),f((d=e((S=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"tipEntry",d,o(e)),n(e,"tipTarget",m,o(e)),n(e,"tipStyle",v,o(e)),n(e,"tipSize",z,o(e)),e}i(e,t);var r=e.prototype;return r.onEnable=function(){this.node.on(p.EventType.TOUCH_START,this.onTouchStart,this)},r.onDisable=function(){this.node.off(p.EventType.TOUCH_START,this.onTouchStart,this)},r.onTouchStart=function(){T.instance.delayHide(2,this.node)},e}(c)).prototype,"tipEntry",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),m=e(S.prototype,"tipTarget",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(S.prototype,"tipStyle",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return l.FromBottom}}),z=e(S.prototype,"tipSize",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.Normal}}),g=S))||g));r._RF.pop()}}}));

System.register("chunks:///_virtual/RandomString.ts",["cc"],(function(n){var t;return{setters:[function(n){t=n.cclegacy}],execute:function(){t._RF.push({},"6d68btvCrRImoQ92N8EOOsm","RandomString",void 0);n("RandomString",function(){function n(){}return n.generate=function(n){void 0===n&&(n=10);for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",o=0;o<n;o++){r+=t[Math.floor(Math.random()*t.length)]}return r},n}());t._RF.pop()}}}));

System.register("chunks:///_virtual/RewardInteraction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./PopupWindowComponent.ts","./PixelImage.ts","./CardMover.ts","./CharacterInfo.ts","./InventoryCollection.ts"],(function(n){var e,t,o,r,i,a,u,c,s,l,p,d,m,f,h,g,y,b,_,v,w,C,P,x,I;return{setters:[function(n){e=n.applyDecoratedDescriptor,t=n.inheritsLoose,o=n.initializerDefineProperty,r=n.assertThisInitialized,i=n.asyncToGenerator,a=n.regeneratorRuntime},function(n){u=n.cclegacy,c=n._decorator,s=n.Layout,l=n.ProgressBar,p=n.Node,d=n.Label,m=n.instantiate,f=n.Button,h=n.UIOpacity,g=n.UITransform,y=n.tween,b=n.Component,_=n.Vec3},function(n){v=n.GameManager},function(n){w=n.PopupWindowComponent},function(n){C=n.PixelImage},function(n){P=n.CardMover},function(n){x=n.CharacterInfo},function(n){I=n.InventoryCollection}],execute:function(){var k,q,z,E,M,B,L,R,D,S,W,T,j,U,F,G,H,O,J,A,N,V,Z,K,Q,X,Y,$,nn;u._RF.push({},"d30d7j/bfdC8aLMnJJmkaWi","RewardInteraction",void 0);var en=c.ccclass,tn=c.property;n("RewardInteraction",(k=en("RewardInteraction"),q=tn(s),z=tn(l),E=tn(p),M=tn(p),B=tn(p),L=tn(w),R=tn(d),D=tn(p),S=tn(p),W=tn(p),T=tn(x),j=tn(p),U=tn(p),k((H=e((G=function(n){function e(){for(var e,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=n.call.apply(n,[this].concat(i))||this,o(e,"rewardLayout",H,r(e)),o(e,"expProgressBars",O,r(e)),o(e,"tourniquet",J,r(e)),o(e,"hpPotion",A,r(e)),o(e,"itemContainer",N,r(e)),o(e,"popupWindow",V,r(e)),o(e,"descriptionLabel",Z,r(e)),o(e,"rewardPanelContainer",K,r(e)),o(e,"coinPrefab",Q,r(e)),o(e,"characterInfoMoneyPos",X,r(e)),o(e,"characterInfo",Y,r(e)),o(e,"closeButton",$,r(e)),o(e,"backpackInventoryContainer",nn,r(e)),e.description="",e._tempStr=[],e._rewards=[],e.data=[{id:"npc_001",name:"迷途旅人",img:"npc_lost_traveler",dialogue:"我在這個迷宮裡待了很久了，也許剛加入迷宮的你會需要這個…",rewards:[{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1}]},{id:"npc_002",name:"迷宮商人",img:"npc_maze_merchant",dialogue:"迷宮裡存活不易，你身上有財寶的話可以跟我換點東西。",rewards:[{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:10}]},{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:10}]},{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:10}]},{id:"health_potion_1",name:"生命藥水",img:"health_potion",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]},{id:"health_potion_1",name:"生命藥水",img:"health_potion",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]}]},{id:"npc_003",name:"迷宮守護者",img:"npc_maze_guardian",dialogue:"你能夠走到這裡，顯示了你的實力。這是我最後能給你的幫助。",rewards:[{id:"health_potion_1",name:"生命藥水",img:"health_potion",amount:1}]},{id:"npc_005",name:"哪裡來的小狗",img:"npc_gatekeeper",dialogue:"(牠從嘴裡吐出一支鑰匙，一溜煙地跑掉了。)\n\n蛤？",rewards:[{id:"universal_key_1",name:"萬能鑰匙",img:"key",amount:1}]},{id:"npc_009",name:"拾荒者",img:"npc_battlefield_medic",dialogue:"戰鬥總是充滿危險，帶上這些繃帶，或許能救你一命。",rewards:[{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]},{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]},{id:"tourniquet_1",name:"止血帶",img:"tourniquet",amount:1,conditions:[{id:"money_1",name:"金幣",amount:15}]}]}],e}t(e,n);var u=e.prototype;return u.setDescription=function(n){this.description=n},u.listReward=function(n,e){var t=this,o=this.rewardLayout.node.children;o.forEach((function(n){return n.active=!1})),this._tempStr.length=0,console.log(n),this.closeButton.active=!1;var r=m(o[0]);n.forEach((function(n,i){var a,u;n.available=!0,n.condition=function(){return n.available&&(!n.conditions||n.conditions.every((function(n){return e[n.id]>=n.amount})))},n.conditions&&(t.closeButton.active=!0);var c=o[i];c||((c=m(r)).parent=t.rewardLayout.node),c.active=!0,null==(a=c.getComponentInChildren(C))||a.setSpriteFrame(n.img);c.addComponent(f),c.getComponent(h)||c.addComponent(h);var s=c.getComponentInChildren(d);s.string=n.name+"x"+n.amount,null==(u=n.conditions)||u.forEach((function(n){s.string+="\n需花費\n"+n.amount+n.name})),c.off("click"),c.once("click",(function(){if(n.condition()){var o;if("exp_1"===n.id){var r=n.amount;t.setExpProgress(r,c)}else"money_1"===n.id?t.setMoney(n.amount,c):"tourniquet_1"===n.id?t.addTourniquet(n.amount,c):"health_potion_1"===n.id?t.addHPpotion(n.amount,c):"universal_key_1"===n.id&&(t.node.active=!1);null==(o=n.conditions)||o.forEach((function(n){"money_1"===n.id&&(v.instance.CharacterRaidData.addMoney(-n.amount),t.characterInfo.updateMoney(-n.amount),t._tempStr.push("花費"+n.amount+" "+n.name),e[n.id]-=n.amount)})),t._tempStr.push(n.amount+" "+n.name),t.descriptionLabel.string=t.description+"\n\n獲得\n"+t._tempStr.join("\n"),n.available=!1}else{var i=n.conditions.map((function(n){return n.name})).join("、");t.popupWindow.openPopup("無法兌換","你得付出一點東西…\n\n("+i+"不足)",[{label:"確認",callback:function(){}}])}}),t)})),this._rewards=n.flat()},u.close=function(){this.rewardLayout.node.children.forEach((function(n){n.off("click"),n.active=!1})),this.expProgressBars[0].node.active=!1,this._rewards.length=0,this.closeButton.active=!1;var n=this.expProgressBars[1],e=v.instance.CharacterRaidData.CombatParam,t=e.curExp,o=e.maxExp;t>=o&&(v.instance.CharacterRaidData.tryLevelUp(),n.progress=t/o,this.popupWindow.openPopup("恭喜升級","生命已完全恢復!並獲得賦能點數，返回主畫面可進行消耗升級",[{label:"知道了",callback:function(){v.instance.characterCombatData.addEmpowerPoints(1)}}]))},u.isBlocked=function(){return console.log("檢查未領:",this._rewards.map((function(n){return n.condition()}))),this._rewards.some((function(n){return n.condition()}))},u.setExpProgress=function(n,e){var t=v.instance.CharacterRaidData.CombatParam,o=t.curExp,r=t.maxExp,i=o+n;t.accumulateExperience(n);var a=this.expProgressBars[0],u=this.expProgressBars[1];a.totalLength=a.getComponent(g).width,a.node.active=!0,a.progress=o/r,u.progress=t.curExp/t.maxExp,e.active=!1;var c=a.getComponentInChildren(d);c.string=o+"/"+r,y(a).to(.5,{progress:i/r},{easing:"linear",onUpdate:function(e,t){c.string=Math.floor(o+n*t)+"/"+r}}).delay(.5).start()},u.setMoney=function(){var n=i(a().mark((function n(e,t){var o,r,i,u,c,s=this;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(o=[],r=0;r<e;r++)(i=m(this.coinPrefab)).parent=t,i.active=!0,o.push(i);return n.next=4,P.scatterCards(o,t,[30,120],.25);case 4:t.active=!1,u=1/o.length;case 6:if(!(o.length>0)){n.next=14;break}return c=o.pop(),n.next=10,P.moveCard(c,this.characterInfoMoneyPos,_.ZERO,.5,u,.3);case 10:v.instance.CharacterRaidData.addMoney(1),this.characterInfo.updateMoney(),n.next=6;break;case 14:return n.next=16,new Promise((function(n){return s.scheduleOnce(n,.7-u)}));case 16:o.forEach((function(n){return n.destroy()}));case 17:case"end":return n.stop()}}),n,this)})));return function(e,t){return n.apply(this,arguments)}}(),u.addTourniquet=function(){var n=i(a().mark((function n(e,t){var o;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.active=!1,null==(o=this.backpackInventoryContainer.getComponent(I))||o.collect({string:"止血帶",type:"groceries",coping:"tourniquet",value:e.toString()});case 2:case"end":return n.stop()}}),n,this)})));return function(e,t){return n.apply(this,arguments)}}(),u.addHPpotion=function(){var n=i(a().mark((function n(e,t){var o;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.active=!1,null==(o=this.backpackInventoryContainer.getComponent(I))||o.collect({string:"生命藥水",type:"groceries",coping:"hp_potion",value:e.toString()});case 2:case"end":return n.stop()}}),n,this)})));return function(e,t){return n.apply(this,arguments)}}(),e}(b)).prototype,"rewardLayout",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(G.prototype,"expProgressBars",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),J=e(G.prototype,"tourniquet",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(G.prototype,"hpPotion",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(G.prototype,"itemContainer",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(G.prototype,"popupWindow",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(G.prototype,"descriptionLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(G.prototype,"rewardPanelContainer",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(G.prototype,"coinPrefab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(G.prototype,"characterInfoMoneyPos",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(G.prototype,"characterInfo",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(G.prototype,"closeButton",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nn=e(G.prototype,"backpackInventoryContainer",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=G))||F));u._RF.pop()}}}));

System.register("chunks:///_virtual/RewardPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CheckBoxComponent.ts","./GameManager.ts","./EmpowerCombatCardList.ts"],(function(e){var t,n,o,r,a,i,s,c,u,p,d,l;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,i=e._decorator,s=e.Node,c=e.Label,u=e.Component},function(e){p=e.CheckBoxComponent},function(e){d=e.GameManager},function(e){l=e.EmpowerCombatCardList}],execute:function(){var h,m,f,w,C;a._RF.push({},"010e05GqoZK7rWtWkZ5SoLn","RewardPanel",void 0);var L=i.ccclass,g=i.property;e("RewardPanel",(h=L("RewardPanel"),m=g(s),h((C=t((w=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return t=e.call.apply(e,[this].concat(a))||this,o(t,"rewardLayout",C,r(t)),t._optionList=[],t}n(t,e);var a=t.prototype;return a.show=function(e){var t=this;void 0===e&&(e=!0),this.node.active=e,this._optionList=d.instance.characterCombatData.getRewardOptionList(),this.rewardLayout.getComponentsInChildren(c).forEach((function(e,n){if(!t._optionList[n])return e.string="",void(e.node.active=!1);e.node.active=!0,e.string=t._optionList[n].empowerName}))},a.onRewardClicked=function(){var e=this,t="",n="";this.rewardLayout.getComponentsInChildren(p).some((function(o,r){return!!o.isChecked&&(d.instance.characterCombatData.tryIncreaseEmpowerCardRank(e._optionList[r].regimentation,1),d.instance.database.empowerCardDatabase.find((function(o){return o.empowerId===e._optionList[r].empowerId&&(t=o.empowerId,n=o.regimentation,!0)})),!0)}))&&(l.instance.list(),this.show(!1),this.rewardLayout.getComponentsInChildren(p).forEach((function(e){return e.cancel()})),this.scheduleOnce((function(){l.instance.enableEmpowerCards(n,t)}),.5))},t}(u)).prototype,"rewardLayout",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=w))||f));a._RF.pop()}}}));

System.register("chunks:///_virtual/ShakeAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,e,o,r,a,s,u,l,c,h,p;return{setters:[function(t){i=t.applyDecoratedDescriptor,n=t.inheritsLoose,e=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,s=t.Node,u=t.tween,l=t.Tween,c=t.randomRange,h=t.v3,p=t.Component}],execute:function(){var g,d,f,y,k,m;r._RF.push({},"c60d2C3PxNPN4bC4RKZtYQc","ShakeAnimation",void 0);var b=a.ccclass,v=a.property;t("default",(g=v(s),b((y=i((f=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return i=t.call.apply(t,[this].concat(r))||this,e(i,"targetNode",y,o(i)),e(i,"shakeDuration",k,o(i)),e(i,"shakeIntensity",m,o(i)),i._originalPosition=void 0,i}n(i,t);var r=i.prototype;return r.start=function(){},r.startAnimation=function(){var t=this,i=this._originalPosition=this.targetNode.position.clone();u(this.targetNode).to(this.shakeDuration/2,{position:this.getRandomShakePosition()},{easing:"bounceInOut"}).to(this.shakeDuration/2,{position:i}).call((function(){t.startAnimation()})).start()},r.stopAnimation=function(){l.stopAllByTarget(this.targetNode),this._originalPosition&&this.targetNode.setPosition(this._originalPosition)},r.getRandomShakePosition=function(){var t=c(-1,1)*this.shakeIntensity,i=c(-1,1)*this.shakeIntensity;return h(this.targetNode.position.x+t,this.targetNode.position.y+i,0)},i}(p)).prototype,"targetNode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=i(f.prototype,"shakeDuration",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),m=i(f.prototype,"shakeIntensity",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),d=f))||d));r._RF.pop()}}}));

System.register("chunks:///_virtual/Shield.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Item.ts"],(function(t){var e,n,i,o;return{setters:[function(t){e=t.inheritsLoose,n=t.createClass},function(t){i=t.cclegacy},function(t){o=t.Item}],execute:function(){i._RF.push({},"b9e88pzps9K1KP4kQQJlPKP","Shield",void 0);t("Shield",function(t){function i(e,n,i,o,s,u,c){var r;return(r=t.call(this,e,n,i,s,u)||this).bonusAC=void 0,r.icon=void 0,r.icon=o,r.bonusAC=c,r}return e(i,t),n(i,[{key:"tooltip",get:function(){return this.name+" ("+this.weight+" lbs) - Bonus AC: "+this.bonusAC}}]),i}(o));i._RF.pop()}}}));

System.register("chunks:///_virtual/ShieldDraggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PixelImage.ts","./EquipmentDropZone.ts","./Draggable.ts","./DraggableDetail.ts"],(function(e){var t,n,i,o,r,a,l,s,u;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){i=e.cclegacy,o=e._decorator},function(e){r=e.PixelImage},function(e){a=e.EquipmentDropZone,l=e.EquipmentDropZoneType},function(e){s=e.Draggable},function(e){u=e.DraggableDetail}],execute:function(){var c;i._RF.push({},"8cc60sE/3xEf4NjdFJug/NW","ShieldDraggable",void 0);var p=o.ccclass;o.property,e("ShieldDraggable",p("ShieldDraggable")(c=function(e){function i(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).equipmentType=l.None,t._item=null,t}return t(i,e),i.prototype.setParent=function(t){return!(t instanceof a&&t.equipmentType!==this.equipmentType)&&(e.prototype.setParent.call(this,t),!0)},n(i,[{key:"Item",get:function(){return this._item},set:function(e){var t,n;console.log("Shield = ",e),this._item=e,null==(t=this.node.getComponent(u))||t.setDetail(e.name,this._item.amount),null==(n=this.node.getComponent(r))||n.setSpriteFrame(e.icon)}}]),i}(s))||c);i._RF.pop()}}}));

System.register("chunks:///_virtual/Skill.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"931a9FtB2NHyoWVPzHRe1EP","Skill",void 0);e("Skill",function(){function e(e,t,n){void 0===n&&(n=i.Novice),this.name=void 0,this.displayName=void 0,this.rank=void 0,this.name=e,this.displayName=t,this.rank=n}return t(e,[{key:"Name",get:function(){return this.name}},{key:"DisplayName",get:function(){return this.displayName}},{key:"Rank",get:function(){return this.rank},set:function(e){e>i.Master?console.error("不得超出最高熟練等級"):this.rank=e}}]),e}());var i=e("SkillRank",function(e){return e[e.Known=0]="Known",e[e.Novice=1]="Novice",e[e.Adept=2]="Adept",e[e.Expert=3]="Expert",e[e.Master=4]="Master",e}({}));n._RF.pop()}}}));

System.register("chunks:///_virtual/SkillComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AttributeComponent.ts"],(function(t){var e,i,l,a,n;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){l=t.cclegacy,a=t._decorator},function(t){n=t.AttributeComponent}],execute:function(){var s;l._RF.push({},"459a0Oy/VpId4oU1ysxRHTh","SkillComponent",void 0);var o=a.ccclass;a.property,t("SkillComponent",o("SkillComponent")(s=function(t){function l(){for(var e,i=arguments.length,l=new Array(i),a=0;a<i;a++)l[a]=arguments[a];return(e=t.call.apply(t,[this].concat(l))||this)._skill=void 0,e}e(l,t);var a=l.prototype;return a.increaseValue=function(){this.attributeAllocation.checkAvailablePoints(1)&&this._skill.upgrade()&&(this.attributeAllocation.allocatePoints(1),this.Tag=!0,this.updateValueLabel()),this.enableIncreaseAllocation(this.Value<this.max),this.enableDecreaseAllocation(this.Value>this.min)},a.decreaseValue=function(){this.enableIncreaseAllocation(this.Value<this.max),this.enableDecreaseAllocation(this.Value>this.min)},a.setRankValue=function(t){this._skill.Rank=t,this.updateValueLabel()},a.updateValueLabel=function(){this.valueLabel&&(this.valueLabel.string=["已知","習得","熟練","精通","大師"][this._skill.Rank])},i(l,[{key:"Skill",get:function(){return this._skill},set:function(t){this._skill=t,this.DisplayName=t.DisplayName,this.setRankValue(t.Rank),this.updateValueLabel()}},{key:"Name",get:function(){return this._skill.Name}},{key:"Value",get:function(){return this._skill.Rank},set:function(t){console.log("請使用 skill.upgrade() 來升級技能。")}}]),l}(n))||s);l._RF.pop()}}}));

System.register("chunks:///_virtual/StorageTool.ts",["cc"],(function(e){var t,o,r;return{setters:[function(e){t=e.cclegacy,o=e._decorator,r=e.sys}],execute:function(){var s,a;t._RF.push({},"f5847AX9qJNcaISXXjtPfSJ","StorageTool",void 0);var l=o.ccclass;e("StorageTool",l("StorageTool")(((a=function(){function e(){}return e.saveToFile=function(e,t){var o=""+this.BASE_PATH+e,s=JSON.stringify(t,null,2);r.localStorage.setItem(o,s)},e.loadFromFile=function(e){var t=""+this.BASE_PATH+e,o=r.localStorage.getItem(t);return o?JSON.parse(o):(console.warn("文件未找到: "+t),null)},e.deleteFile=function(e){var t=""+this.BASE_PATH+e;r.localStorage.removeItem(t),console.log("文件已刪除: "+t)},e.listFiles=function(){for(var e=""+this.BASE_PATH,t=[],o=0,s=Object.keys(r.localStorage);o<s.length;o++){var a=s[o];a.startsWith(e)&&t.push(a.slice(e.length))}return t},e}()).BASE_PATH="assets/resources/save/",s=a))||s);t._RF.pop()}}}));

System.register("chunks:///_virtual/StoreDropZone.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DropZone.ts","./Draggable.ts","./WeaponDraggable.ts","./ShieldDraggable.ts","./ArmorDraggable.ts","./GroceriesDraggable.ts","./Inventory.ts","./DraggableDetail.ts","./GameManager.ts"],(function(e){var t,n,o,i,r,a,c,s,l,u,p,m,g,h,d,f,D,b,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,c=e.Label,s=e.EventHandler,l=e.Sprite,u=e.Color},function(e){p=e.DropZone},function(e){m=e.Draggable},function(e){g=e.WeaponDraggable},function(e){h=e.ShieldDraggable},function(e){d=e.ArmorDraggable},function(e){f=e.GroceriesDraggable},function(e){D=e.InventoryEvent},function(e){b=e.DraggableDetail},function(e){v=e.GameManager}],execute:function(){var I,P,y,C,L,S,w,E,O;r._RF.push({},"e5f3etbtNpOZZ1J9j1E5SWR","StoreDropZone",void 0);var Z=a.ccclass,z=a.property;e("StoreDropZone",(I=Z("StoreDropZone"),P=z(c),y=z(s),C=z(s),I((w=t((S=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"priceLabel",w,i(t)),o(t,"storeDropIn",E,i(t)),o(t,"storeDropOut",O,i(t)),t.pricePercentage=1,t.acquisitionPercentage=1,t}n(t,e);var r=t.prototype;return r.onLoad=function(){this.init()},r.clear=function(){this.slot.removeAllChildren(),this.priceLabel&&(this.priceLabel.string="")},r.checkValue=function(e){var t,n,o,i,r,a=this.slot.getComponentInChildren(m);a?(console.log("purchasePrice:",(null==(t=this.item)?void 0:t.purchasePrice)*this.pricePercentage),console.log("amount:",null==(n=this.item)?void 0:n.amount),(null==(o=this.item)?void 0:o.purchasePrice)*this.pricePercentage*this.item.amount>e?(a.isLocked=!0,null==(i=a.getComponent(b))||i.setTip("不足"),a.getComponent(l).color=new u(85,85,85)):(a.isLocked=!1,null==(r=a.getComponent(b))||r.setTip(""),a.getComponent(l).color=u.WHITE)):console.log("draggable未找到")},r.init=function(){this.updatePriceDisplay()},r.onDrop=function(e){var n=e.draggableItem,o=e.dropZone;if(!(o instanceof t))return n instanceof g||n instanceof h||n instanceof d||n instanceof f?(this.dropInThenDispatch(n),n.setParent(this),void o.dropOut(n)):void n.resetPosition();n.resetPosition()},r.dropInThenDispatch=function(e){var n=this,o=0,i=!1,r=this.slot.getComponentInChildren(m);r&&(e.isSameItem(r.Item)&&e.Amount+r.Amount<=e.Item.stackLimit?(e.mergeItems(r.node),o=r.Amount,i=!0,console.log("合併道具數量")):(this.node.dispatchEvent(new D("removeItem",!0,{item:r.Item,amount:r.Item.amount})),r.node.destroy(),console.log("被覆蓋的東西刪除!")));var a=e.Item;a.amount+=o,e.zone instanceof t||(this.node.dispatchEvent(new D("moveItem",!0,{item:a,amount:a.amount,isMerge:i})),this.scheduleOnce((function(){n.storeDropIn.forEach((function(e){return e.emit([a,n.acquisitionPercentage,a.amount])}))}),.1)),this.scheduleOnce((function(){n.updatePriceDisplay()}),.2)},r.updatePriceDisplay=function(){this.item?this.priceLabel.string=(this.item.purchasePrice*this.pricePercentage*this.item.amount).toString()+"G":this.priceLabel.string=""},r.onStoreDropIn=function(e,t,n){var o=e.purchasePrice*t*n;console.log("店家收購:",e.name,o,n),v.instance.CharacterRaidData.addMoney(o),v.instance.CharacterRaidData.write()},r.onStoreDropOut=function(e,t,n){var o=e.purchasePrice*t*n;console.log("店家出售:",e.name,o,n),v.instance.CharacterRaidData.spendMoney(o),v.instance.CharacterRaidData.write()},r.dropOut=function(e){var n=this,o=e.Item;o&&(console.log("draggerItem:",o.name,o.purchasePrice*this.pricePercentage*o.amount,o.amount),this.storeDropOut.forEach((function(e){return e.emit([o,n.pricePercentage,o.amount])})),e.zone instanceof t||this.node.dispatchEvent(new D("removeItem",!0,{item:e.Item,amount:o.amount})),this.updatePriceDisplay())},t}(p)).prototype,"priceLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(S.prototype,"storeDropIn",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),O=t(S.prototype,"storeDropOut",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),L=S))||L));r._RF.pop()}}}));

System.register("chunks:///_virtual/StunAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,i,e,o,r,a,c,u;return{setters:[function(n){t=n.applyDecoratedDescriptor,i=n.inheritsLoose,e=n.initializerDefineProperty,o=n.assertThisInitialized},function(n){r=n.cclegacy,a=n._decorator,c=n.Node,u=n.Component}],execute:function(){var s,l,p,f,h;r._RF.push({},"38f9fsMJLJAYJNgLAbaxm+Y","StunAnimation",void 0);var d=a.ccclass,m=a.property;n("StunAnimation",(s=d("StunAnimation"),l=m(c),s((h=t((f=function(n){function t(){for(var t,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return t=n.call.apply(n,[this].concat(r))||this,e(t,"nodes",h,o(t)),t}i(t,n);var r=t.prototype;return r.startAnimation=function(){this.nodes.forEach((function(n){return n.active=!0}))},r.stopAnimation=function(){this.nodes.forEach((function(n){return n.active=!1}))},t}(u)).prototype,"nodes",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),p=f))||p));r._RF.pop()}}}));

System.register("chunks:///_virtual/TeachConversationData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e;return{setters:[function(t){n=t.createClass},function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"03624AD+FtH9IuxPh6wClsw","TeachConversationData",void 0);t("TeachConversationData",function(){function t(t,n,e,o,i,a,r,u,s){this._id=void 0,this._name=void 0,this._round=void 0,this._battleBeginContent=void 0,this._battleEndContent=void 0,this._battleEscapeContent=void 0,this._roundBeginContent=void 0,this._underattackContent=void 0,this._underdamageContent=void 0,this._id=t,this._name=n,this._round=e,this._battleBeginContent=o,this._battleEndContent=i,this._battleEscapeContent=a,this._roundBeginContent=r,this._underattackContent=u,this._underdamageContent=s}return t.fromCSV=function(n){return new t(n.id,n.name,parseInt(n.round),n.battleBeginContent,n.battleEndContent,n.battleEscapeContent,n.roundBeginContent,n.underattackContent,n.underdamageContent)},n(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"round",get:function(){return this._round}},{key:"battleBeginContent",get:function(){return this._battleBeginContent}},{key:"battleEndContent",get:function(){return this._battleEndContent}},{key:"battleEscapeContent",get:function(){return this._battleEscapeContent}},{key:"roundBeginContent",get:function(){return this._roundBeginContent}},{key:"underattackContent",get:function(){return this._underattackContent}},{key:"underdamageContent",get:function(){return this._underdamageContent}}]),t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/TooltipComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,o,i,r,a,l,s,u,c,p,h,d,y,m,f,T;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized,r=e.createForOfIteratorHelperLoose,a=e.createClass,l=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){u=e.cclegacy,c=e._decorator,p=e.Node,h=e.UITransform,d=e.Size,y=e.Layout,m=e.instantiate,f=e.RichText,T=e.Component}],execute:function(){var g,v,C,b,_,z,S,F,w;u._RF.push({},"c1649pnV+ROzrROzz4vCh72","TooltipComponent",void 0);var D=c.ccclass,L=c.property,A=(e("ToolTipStyle",function(e){return e[e.FromBottom=0]="FromBottom",e[e.FromRight=1]="FromRight",e[e.FromTop=2]="FromTop",e[e.FromLeft=3]="FromLeft",e[e.FromTopLeft=4]="FromTopLeft",e}({})),e("ToolTipSize",function(e){return e[e.Small=0]="Small",e[e.Normal=1]="Normal",e}({})));e("TooltipComponent",(g=D("TooltipComponent"),v=L(p),C=L(p),b=L(p),g((S=t((z=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"bounds",S,i(t)),o(t,"layoutElement",F,i(t)),o(t,"layoutGroup",w,i(t)),t._senderNode=null,t._isAlreadyTipping=!1,t._tipDelaySec=0,t._currentTip=[],t}n(t,e);var u=t.prototype;return u.initialize=function(e){this._isAlreadyTipping=!1,this._tipDelaySec=e,this.layoutElement.active=!1},u.show=function(e){this.bounds.active&&this._senderNode===e||(this._senderNode=e,this._isAlreadyTipping?(this.unscheduleAllCallbacks(),this.asyncTipDelayer(this._tipDelaySec)):(this.node.active=!0,this._isAlreadyTipping=!0,this.asyncTipDelayer(this._tipDelaySec)))},u.hide=function(){this.unscheduleAllCallbacks(),this.bounds.active=!1,this.node.active=!1,this._isAlreadyTipping=!1},u.asyncTipDelayer=function(){var e=l(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bounds.active=!1,e.next=3,new Promise((function(e){return n.scheduleOnce(e,t)}));case 3:this.bounds.active=!0;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),u.updateSize=function(e){var t,n=this.node.getComponent(h);switch(e){case A.Normal:t=420,n.setContentSize(new d(t,n.height));break;case A.Small:t=280,n.setContentSize(new d(t,n.height))}this.node.getComponentInChildren(y).node.children.forEach((function(e){e.getComponent(h).setContentSize(new d(t,10))}))},u.updateTipContent=function(e){this._currentTip=e,this.layoutGroup.removeAllChildren();for(var t,n=r(e);!(t=n()).done;){var o=t.value,i=m(this.layoutElement);i.parent=this.layoutGroup,i.active=!0;var a=i.getComponentInChildren(f);a&&(a.string=o)}this.layoutGroup.getComponent(y).updateLayout()},a(t,[{key:"LayoutGroup",get:function(){return this.layoutGroup}},{key:"RectTransform",get:function(){return this.node.getComponent(h)}},{key:"senderNode",get:function(){return this._senderNode}}]),t}(T)).prototype,"bounds",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(z.prototype,"layoutElement",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(z.prototype,"layoutGroup",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=z))||_));u._RF.pop()}}}));

System.register("chunks:///_virtual/ToolTipManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TooltipComponent.ts"],(function(t){var o,e,i,n,l,r,a,s,c,p,u,h,d,T;return{setters:[function(t){o=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized,l=t.createClass},function(t){r=t.cclegacy,a=t._decorator,s=t.Node,c=t.UITransform,p=t.Vec3,u=t.view,h=t.Component},function(t){d=t.TooltipComponent,T=t.ToolTipStyle}],execute:function(){var g,f,m,y,b,C,k,v;r._RF.push({},"4ab239kFENDWJm32qrF2Jxu","ToolTipManager",void 0);var w=a.ccclass,B=a.property;t("ToolTipManager",(g=w("ToolTipManager"),f=B(s),m=B(s),g(((v=function(t){function o(){for(var o,e=arguments.length,l=new Array(e),r=0;r<e;r++)l[r]=arguments[r];return o=t.call.apply(t,[this].concat(l))||this,i(o,"tooltipBlock",C,n(o)),i(o,"toolTip",k,n(o)),o.currentTooltip=null,o}e(o,t);var r=o.prototype;return r.onLoad=function(){o._instance?this.destroy():o._instance=this},r.start=function(){o._instance.node===this.node&&this.initializeTooltip(this.toolTip,.05)},r.initializeTooltip=function(t,o){t.getComponent(d).initialize(o)},r.show=function(t,o,e,i){var n=this.toolTip.getComponent(d);n.updateTipContent(t),n.updateSize(i),n.show(o),this.setCurrentTooltip(this.toolTip),this.updateToolTip(this.toolTip,o,e)},r.hide=function(){this.currentTooltip&&(this.currentTooltip.getComponent(d).hide(),this.currentTooltip=null,this.unscheduleAllCallbacks(),o.instance.enableBlock(!1))},r.delayHide=function(t,o){var e=this;this.currentTooltip&&(this.unscheduleAllCallbacks(),this.scheduleOnce((function(){var t;(null==(t=e.currentTooltip)?void 0:t.getComponent(d).senderNode)===o&&e.hide()}),t))},r.setCurrentTooltip=function(t){null===this.currentTooltip?this.currentTooltip=t:this.currentTooltip!==t&&(this.currentTooltip.getComponent(d).hide(),this.currentTooltip=t)},r.updateToolTip=function(t,o,e){var i,n=this.toolTip.getComponent(d),l=o.getComponent(c),r=t.getComponent(c),a=o.position.clone(),s=10,h=r.getBoundingBox(),g=n.LayoutGroup.getComponent(c).getBoundingBox(),f=h.width/2,m=g.height/2,y=l.width/2,b=l.height/2;switch(e){case T.FromRight:i=a.add(new p(y+s+f,0,0));break;case T.FromBottom:i=a.add(new p(0,-b-s-m,0));break;case T.FromTop:i=a.add(new p(0,b+s+m,0));break;case T.FromLeft:i=a.add(new p(-y-s-f,0,0));break;case T.FromTopLeft:i=a.add(new p(-y-s-f,b+s+m,0));break;default:i=o.position}t.setPosition(i);var C=u.getVisibleSize().width,k=u.getVisibleSize().height,v=t.getWorldPosition();v.x-f<0?i.x+=-(v.x-f-s):v.x+f>C&&(i.x+=C-(v.x+f+s)),v.y-m<0?i.y+=-(v.y-m-s):v.y+m>k&&(i.y+=k-(v.y+m+s)),t.setPosition(i)},r.enableBlock=function(t){void 0===t&&(t=!0),this.tooltipBlock.active=t},r.onHideTipClicked=function(){this.hide(),this.enableBlock(!1)},l(o,null,[{key:"instance",get:function(){return this._instance}}]),o}(h))._instance=void 0,C=o((b=v).prototype,"tooltipBlock",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=o(b.prototype,"toolTip",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=b))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/Tower.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TowerData.ts","./TowerFloor.ts","./StorageTool.ts","./GameManager.ts","./EmpowerCombatCardList.ts","./PixelImage.ts"],(function(e){var t,o,n,r,i,a,s,l,h,c,d,u,_,w,f,g,m,v,p,T;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,i=e.createClass},function(e){a=e.cclegacy,s=e._decorator,l=e.Node,h=e.ScrollView,c=e.EventHandler,d=e.instantiate,u=e.Button,_=e.Component},function(e){w=e.TowerData},function(e){f=e.TowerDungeonEvent,g=e.TowerFloor},function(e){m=e.StorageTool},function(e){v=e.GameManager},function(e){p=e.EmpowerCombatCardList},function(e){T=e.PixelImage}],execute:function(){var C,y,I,b,E,F,D,x,k,R,S,L,O;a._RF.push({},"720cd4u+AlO75Xy6xYa4643","Tower",void 0);var V=s.ccclass,P=s.property;e("Tower",(C=V("Tower"),y=P(l),I=P(h),b=P(c),E=P(c),F=P(c),C((k=t((x=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,n(t,"block",k,r(t)),n(t,"scrollView",R,r(t)),n(t,"towerChallengeFailedEvent",S,r(t)),n(t,"towerChallengeSuccessEvent",L,r(t)),n(t,"towerLeaveEvent",O,r(t)),t._towerId="",t._towerIcon="",t._towerData=null,t._floorCount=0,t._floorIndex=0,t._stage=[],t._resolved=[],t._currTowerFloor=null,t}o(t,e);var a=t.prototype;return a.onLoad=function(){this.node.on(f.CLEAR_TOWER_FLOOR,this.onClearTowerFloor,this),this.node.on(f.SHOW_TOWER_UI,this.onShowTowerUI,this)},a.onDestroy=function(){this.node.off(f.SHOW_TOWER_UI,this.onShowTowerUI,this),this.node.off(f.CLEAR_TOWER_FLOOR,this.onClearTowerFloor,this)},a.tryReadChallengeTower=function(){var e=m.loadFromFile("challenge_tower_data");return!!e&&(this.build(e.towerId,this._towerIcon),!0)},a.build=function(e,t){void 0===t&&(t=""),this._towerId=e;var o,n=m.loadFromFile(this._towerId+"_tower_data");if(n?(this._floorIndex=n.index,this._stage=n.stage,this._resolved=n.resolved,this._floorCount=this._stage.length):(this._floorIndex=0,this._stage.length=0),this._towerId){if(this._towerData=v.instance.database.towerDatabase.find((function(t){return t.id===e})),console.log(v.instance.database.towerDatabase),!this._towerData)return void console.error("Cannot find tower data with id "+e);this._floorCount=this._towerData.enemyTeams.length,m.saveToFile("challenge_tower_data",{towerId:this._towerId,towerIcon:this._towerIcon})}(this._towerIcon=t,this._towerIcon)&&(null==(o=this.block.getComponent(T))||o.setSpriteFrame(this._towerIcon))},a.show=function(e){(void 0===e&&(e=!0),this.node.active=e,e)?(this.buildTower(),this.updateTower(),p.instance.updateEmpowerCombatCardsByCardSelected()):this.scrollView.content.children.forEach((function(e){return e.off("click")}))},a.buildTower=function(){if(this._stage.length)console.log("Tower is already built");else{for(var e=0;e<this._floorCount;e++){var t=[],o=this._towerData.enemyTeams[e],n=this._towerData.events[e],r=this._towerData.chests[e];o&&t.push({type:"enemyTeam",id:o}),n&&t.push({type:"dungeonEvent",id:n}),r&&t.push({type:"dungeonChest",id:r});var i=t.sort((function(){return Math.random()-.5})).shift();this._stage.push(i)}console.log("buildTower this._stage:",this._stage)}},a.updateTower=function(){var e=this,t=this.scrollView.content.children;t.forEach((function(e){return e.active=!1})),console.log("updateTower this._stage:",this._stage);var o=d(t[0]),n=this._floorIndex;this._stage.forEach((function(r,i){var a=t[i];a||((a=d(o)).parent=e.scrollView.content),a.active=!0;var s=e._resolved.indexOf(r.id)>-1;s&&n===i&&(n++,e._floorIndex=n);var l=i>=n||s,h=a.getComponent(g);h.refresh(r.type,r.id,i+1,l),h.block(n!==i),a.off("click"),l&&(a.on("click",(function(){h.enter(),e._currTowerFloor=h})),a.getComponent(u).enabled=!0)})),o.destroy(),this.scrollView.scrollToPercentVertical(n/this._floorCount,.25)},a.saveData=function(){m.saveToFile(this._towerId+"_tower_data",{index:this._floorIndex,stage:this._stage,resolved:this._resolved})},a.delData=function(e){e?m.deleteFile(e+"_tower_data"):this._towerId&&m.deleteFile(this._towerId+"_tower_data"),m.deleteFile("challenge_tower_data")},a.onShowTowerUI=function(e){e.propagationStopped=!0,this.show(e.detail.show)},a.onClearTowerFloor=function(e){var t=this;if(e.propagationStopped=!0,this._floorIndex>=this._floorCount)console.log("Tower floor is already cleared");else{if(!e.detail.finish)return this._floorIndex=0,this.saveData(),this.node.active=!1,void this.towerChallengeFailedEvent.forEach((function(e){return e.emit([])}));"dungeonEvent"!==e.detail.type&&"dungeonChest"!==e.detail.type||-1===this._resolved.indexOf(e.detail.id)&&this._resolved.push(e.detail.id);var o=this.scrollView.content.children;o.forEach((function(e){return e.off("click")})),o[this._floorIndex].getComponent(u).enabled=!1,this._floorIndex++,this.saveData(),console.log("this._floorIndex:",this._floorIndex,"/",this._floorCount),this._floorIndex<this._floorCount?this.updateTower():(this.scheduleOnce((function(){t.node.active=!1,t.towerChallengeSuccessEvent.forEach((function(e){return e.emit([])}))}),2),m.deleteFile("challenge_tower_data"))}},a.onLeaveClicked=function(){var e=this;this._floorIndex>0?this.towerLeaveEvent.forEach((function(t){return t.emit([e.show.bind(e),function(){e.show(!1),e.clearChallengeRecord()}])})):(v.instance.CharacterRaidData.CombatParam.refillHP(),v.instance.CharacterRaidData.CombatParam.write(),v.instance.showLobbyUI(),this.show(!1),this.clearChallengeRecord())},a.clearChallengeRecord=function(){m.deleteFile("challenge_tower_data"),this._floorIndex=0,this.saveData(),this._stage.length=0},a.setFakeTowerData=function(e){switch(e){case"tower_1":this._towerData=w.fromCSV({id:"tower_1",name:"Fake Tower",rewards:"money x100",challengeRank:"1",enemyTeams:["enemyTeam_1","enemyTeam_2","enemyTeam_3","","enemyTeam_5"],events:["","","","event_4",""],chests:["","","chest_3","",""]});break;case"tower_2":this._towerData=w.fromCSV({id:"tower_2",name:"Fake Tower 2",rewards:"money x100",challengeRank:"1",enemyTeams:["2enemyTeam_1","2enemyTeam_2","2enemyTeam_3","","2enemyTeam_5"],events:["","","","2event_4",""],chests:["","","2chest_3","",""]});break;default:return void(this._floorCount=0)}this._floorCount=this._towerData.enemyTeams.length},i(t,[{key:"towerId",get:function(){return this._towerId}}]),t}(_)).prototype,"block",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(x.prototype,"scrollView",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(x.prototype,"towerChallengeFailedEvent",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),L=t(x.prototype,"towerChallengeSuccessEvent",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),O=t(x.prototype,"towerLeaveEvent",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),D=x))||D));a._RF.pop()}}}));

System.register("chunks:///_virtual/TowerData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"aa121NCZONERLaKN4uwnrqM","TowerData",void 0);e("TowerData",function(){function e(e,t,n,i,s,r,a,c){this._id=void 0,this._name=void 0,this._reward=void 0,this._challengeRank=void 0,this._icon=void 0,this._enemyTeams=void 0,this._events=void 0,this._chests=void 0,this._id=e,this._name=t,this._reward=n,this._challengeRank=i,this._icon=s,this._enemyTeams=r,this._events=a,this._chests=c}return e.fromCSV=function(t){var n=parseInt(t.challengeRank);return new e(t.id,t.name,t.rewards.split(" | "),n,t.icon,t.enemyTeams,t.events,t.chests)},t(e,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"reward",get:function(){return this._reward}},{key:"challengeRank",get:function(){return this._challengeRank}},{key:"icon",get:function(){return this._icon}},{key:"enemyTeams",get:function(){return this._enemyTeams}},{key:"events",get:function(){return this._events}},{key:"chests",get:function(){return this._chests}}]),e}());n._RF.pop()}}}));

System.register("chunks:///_virtual/TowerFloor.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupWindowComponent.ts","./EmpowerCombatCardList.ts","./BattleManager.ts","./Debug.ts"],(function(t){var e,n,i,o,r,a,l,s,c,u,p,h,f,d,b,_;return{setters:[function(t){e=t.inheritsLoose,n=t.applyDecoratedDescriptor,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.Label,s=t.Node,c=t.Sprite,u=t.EventHandler,p=t.Event,h=t.Component},function(t){f=t.PopupWindowComponent},function(t){d=t.EmpowerCombatCardList},function(t){b=t.BattleManager},function(t){_=t.Debug}],execute:function(){var g,v,w,y,m,E,L,F,C,O,R,S,T,W,I;r._RF.push({},"1365esoVvJMzYNOBrO2RLUj","TowerFloor",void 0);var z=a.ccclass,D=a.property,B=t("TowerDungeonEvent",function(t){function n(e,n,i){var o;return(o=t.call(this,e,n)||this).detail=null,o.detail=i,o}return e(n,t),n}(p));B.SHOW_TOWER_UI="show_tower_ui",B.CLEAR_TOWER_FLOOR="clear_tower_floor";t("TowerFloor",(g=z("TowerFloor"),v=D(l),w=D(l),y=D(s),m=D(c),E=D(f),L=D(u),g((O=n((C=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"titleLabel",O,o(e)),i(e,"floorLabel",R,o(e)),i(e,"mistFront",S,o(e)),i(e,"contentSprite",T,o(e)),i(e,"popupWindow",W,o(e)),i(e,"openChestEvent",I,o(e)),e._infoId="",e._type="",e._floor=0,e}e(n,t);var r=n.prototype;return r.refresh=function(t,e,n,i){this._infoId=e,this._type=t,this._floor=n,this.titleLabel.string=e,this.floorLabel.string=n.toString(),this.contentSprite.node.active=i,i||"dungeonChest"!==this._type||(this.contentSprite.node.active=!0)},r.enter=function(){var t=this;switch(this._type){case"enemyTeam":if(!d.instance.IsSelected)return void d.instance.list();this.node.dispatchEvent(new B(B.SHOW_TOWER_UI,!0,{show:!1,infoId:this._infoId})),_.Log("進行挑戰"),b.instance.setEnemyData(this._infoId),b.instance.startBattle(),b.instance.onBattleVictoryEvent=function(){t.challengeFinish(!0)},b.instance.onBattleDefeatEvent=function(){t.challengeFinish(!1)};break;case"dungeonChest":this.openChestEvent.forEach((function(t){return t.emit([])})),this.challengeFinish(!0);break;case"dungeonEvent":this.popupWindow.openPopup("樓層","觸發事件",[{label:"解決",callback:function(){t.challengeFinish(!0)}}])}},r.block=function(t){void 0===t&&(t=!0),this.mistFront.active=t},r.challengeFinish=function(t){this.contentSprite.node.active=!1,this.node.dispatchEvent(new B(B.CLEAR_TOWER_FLOOR,!0,{finish:t,type:this._type,id:this._infoId}))},n}(h)).prototype,"titleLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=n(C.prototype,"floorLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=n(C.prototype,"mistFront",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(C.prototype,"contentSprite",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=n(C.prototype,"popupWindow",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(C.prototype,"openChestEvent",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F=C))||F));r._RF.pop()}}}));

System.register("chunks:///_virtual/Weapon.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Item.ts"],(function(e){var a,r,t,i;return{setters:[function(e){a=e.inheritsLoose,r=e.createClass},function(e){t=e.cclegacy},function(e){i=e.Item}],execute:function(){t._RF.push({},"ed784fy1SFNlou/nwbz53fp","Weapon",void 0);e("WeaponStyle",function(e){return e.Unarmed="Unarmed",e.AllSimpleWeapons="AllSimpleWeapons",e.Club="Club",e.Dagger="Dagger",e.Greatclub="Greatclub",e.Handaxe="Handaxe",e.Javelin="Javelin",e.LightHammer="LightHammer",e.Mace="Mace",e.Quarterstaff="Quarterstaff",e.Sickle="Sickle",e.Spear="Spear",e.LightCrossbow="LightCrossbow",e.Dart="Dart",e.Shortbow="Shortbow",e.Sling="Sling",e.AllMartialWeapons="AllMartialWeapons",e.Battleaxe="Battleaxe",e.Flail="Flail",e.Glaive="Glaive",e.Greataxe="Greataxe",e.Greatsword="Greatsword",e.Halberd="Halberd",e.Lance="Lance",e.Longsword="Longsword",e.Maul="Maul",e.Morningstar="Morningstar",e.Pike="Pike",e.Rapier="Rapier",e.Scimitar="Scimitar",e.ShortSword="Shortsword",e.Trident="Trident",e.WarPick="WarPick",e.Warhammer="Warhammer",e.Whip="Whip",e.Blowgun="Blowgun",e.HandCrossbow="HandCrossbow",e.HeavyCrossbow="HeavyCrossbow",e.Longbow="Longbow",e.Net="Net",e}({})),e("Weapon",function(e){function t(a,r,t,i,o,n,s,l,d,c,p){var g;return(g=e.call(this,a,r,t,i,o)||this).style=void 0,g.icon=void 0,g.damage=void 0,g.properties=void 0,g.range=void 0,g.style=n,g.icon=s,g.damage=l,g.properties=d,g.range=c,g.description=p,g}return a(t,e),r(t,[{key:"tooltip",get:function(){var a=e.prototype.tooltip;return this.damage.dice&&"-"!==this.damage.dice&&(a+="<br/>傷害骰: "+this.damage.dice),this.damage.dice2&&"-"!==this.damage.dice2&&(a+="<br/>雙手持握時傷害: "+this.damage.dice2),a+="<br/>武器傷害屬性: "+this.damage.type,a+="<br/>屬性: "+this.properties.join(", ")}}]),t}(i));t._RF.pop()}}}));

System.register("chunks:///_virtual/WeaponDraggable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PixelImage.ts","./EquipmentDropZone.ts","./Draggable.ts","./DraggableDetail.ts"],(function(e){var t,n,o,a,r,i,l,p,s;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){o=e.cclegacy,a=e._decorator},function(e){r=e.PixelImage},function(e){i=e.EquipmentDropZone,l=e.EquipmentDropZoneType},function(e){p=e.Draggable},function(e){s=e.DraggableDetail}],execute:function(){var u;o._RF.push({},"15f7a4o9/hARp+gzHtYMOx6","WeaponDraggable",void 0);var c=a.ccclass;a.property,e("WeaponDraggable",c("WeaponDraggable")(u=function(e){function o(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(t=e.call.apply(e,[this].concat(o))||this).equipmentType=l.None,t._item=null,t}return t(o,e),o.prototype.setParent=function(t){return!(t instanceof i&&t.equipmentType!==this.equipmentType)&&(e.prototype.setParent.call(this,t),!0)},n(o,[{key:"Weapon",set:function(e){var t,n;console.log("WeaponDraggable.weapon = ",e),this._item=e,null==(t=this.node.getComponent(s))||t.setDetail(e.name,this._item.amount),null==(n=this.node.getComponent(r))||n.setSpriteFrame(e.icon)}},{key:"Item",get:function(){return this._item}}]),o}(p))||u);o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});